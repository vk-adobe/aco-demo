/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as S,Fragment as R}from"@dropins/tools/preact-jsx-runtime.js";import*as B from"@dropins/tools/preact-compat.js";import{forwardRef as tn,useState as L,useEffect as W,useCallback as bt,useImperativeHandle as nn}from"@dropins/tools/preact-compat.js";import{classes as Q,VComponent as j,Slot as I}from"@dropins/tools/lib.js";import{E as en}from"./EmptyCart2.js";/* empty css                */import{Divider as Ut,Skeleton as rn,SkeletonRow as an,InLineAlert as $t,CartList as V,Icon as D,Button as M,Accordion as cn,AccordionSection as on,CartItem as sn,Price as G,Image as ln}from"@dropins/tools/components.js";import"@dropins/tools/preact-hooks.js";import{g as zt}from"./persisted-data.js";import{events as Bt}from"@dropins/tools/event-bus.js";import{s as un}from"./resetCart.js";import{a as dn}from"./createGuestCart.js";import{u as Gt}from"./updateProductsFromCart.js";import{S as Rt,a as mn}from"./WarningWithCircle.js";import{S as gn}from"./ChevronDown.js";import{useText as fn}from"@dropins/tools/i18n.js";const hn=O=>B.createElement("svg",{id:"Icon_Chevron_right_Base","data-name":"Icon \\u2013 Chevron right \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...O},B.createElement("g",{id:"Large"},B.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),B.createElement("g",{id:"Chevron_right_icon","data-name":"Chevron right icon"},B.createElement("path",{vectorEffect:"non-scaling-stroke",id:"chevron",d:"M199.75,367.5l4.255,-4.255-4.255,-4.255",transform:"translate(-189.25 -351.0)",fill:"none",stroke:"currentColor"})))),Xt=({className:O,children:H,heading:N,footer:_,emptyCart:E,products:g,outOfStockMessage:v,variant:b="primary",loading:m=!0,...o})=>r("div",{...o,className:Q(["cart-cart-summary-list",O,`cart-cart-summary-list__background--${b}`]),children:m?r(yn,{}):S(R,{children:[(N||v)&&S("div",{"data-testid":"cart-summary-list-heading-wrapper",className:Q(["cart-cart-summary-list__heading",["cart-cart-summary-list__heading--full-width",!g]]),children:[N&&S(R,{children:[r(j,{node:N,className:"cart-cart-summary-list__heading-text"}),r(Ut,{variant:"primary",className:Q(["cart-cart-summary-list__heading-divider"])})]}),v&&r(j,{node:v,className:"cart-cart-summary-list__out-of-stock-message"})]}),r("div",{className:Q(["cart-cart-summary-list__content",["cart-cart-summary-list__content--empty",!g]]),children:g||r(j,{node:E,className:"cart-cart-summary-list__empty-cart"})}),_&&S(R,{children:[r(Ut,{variant:"primary",className:Q(["cart-cart-summary-list__footer-divider"])}),r(j,{node:_,className:"cart-cart-summary-list__footer-text"})]})]})}),yn=()=>r(rn,{"data-testid":"cart-summary-list-skeleton",className:"cart-cart-summary-list__skeleton",rowGap:"medium",children:r(an,{variant:"row",size:"xlarge",fullWidth:!0,lines:3,multilineGap:"small"})}),vn=tn(({initialData:O=null,hideHeading:H,hideFooter:N,routeProduct:_,routeEmptyCartCTA:E,routeCart:g,onItemUpdate:v,onItemRemove:b,maxItems:m,slots:o,attributesToHide:d=[],enableRemoveItem:X,enableUpdateItemQuantity:J,onItemsErrorsChange:K,accordion:Ft=!1,variant:Y="primary",isLoading:qt,showMaxItems:tt,showDiscount:nt,showSavings:et,quantityType:rt,dropdownOptions:it,undo:P=!1,__testRecentlyRemovedItems:at,...ct},Tt)=>{var Lt;const[U,Wt]=L(!O),[i,jt]=L(O),[p,Vt]=L(new Set),[z,ot]=L(new Map),[w,A]=L(at||[]);W(()=>{},[at,w]);const u=(Lt=un.config)==null?void 0:Lt.shoppingCartDisplaySetting,[x,Jt]=L(tt?!0:!m&&!tt),c=fn({file:"Cart.CartItem.file",files:"Cart.CartItem.files",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",discountedPrice:"Cart.CartItem.discountedPrice",sender:"Cart.CartItem.sender",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action",notAvailableMessage:"Cart.CartItem.notAvailableMessage",viewMore:"Cart.Cart.viewMore",viewAll:"Cart.Cart.viewAll",discountPercent:"Cart.CartItem.discountPercentage",savingsAmount:"Cart.CartItem.savingsAmount",itemBeingRemoved:"Cart.CartItem.itemBeingRemoved",itemRemoved:"Cart.CartItem.itemRemoved",itemRemovedDescription:"Cart.CartItem.itemRemovedDescription",undoAction:"Cart.CartItem.undoAction",dismissAction:"Cart.CartItem.dismissAction"}),F=(t,n)=>{Vt(e=>(n?e.add(t):e.delete(t),new Set(e)))},st=(t,n)=>{ot(e=>(n?e.set(t,n):e.delete(t),new Map(e)))};function Kt(t){const n=zt(),e=n==null?void 0:n.items.find(a=>a.uid===t);e&&A(a=>{const s=n.items.findIndex(l=>l.uid===t);return s!==-1&&!a.some(l=>l.item.uid===t)?(Bt.emit("cart/product/removed",{item:e,index:s}),[...a,{item:e,index:s,error:void 0,beingRemoved:!0}]):a})}const Z=(t,n)=>{F(t.uid,!0),ot(new Map),X&&n===0?(Kt(t.uid),Gt([{uid:t.uid,quantity:n}]).then(()=>{b==null||b({item:t})}).finally(()=>{F(t.uid,!1),A(e=>e.map(a=>a.item.uid===t.uid?{...a,beingRemoved:!1}:a))}).catch(e=>{console.warn(e)})):J&&Gt([{uid:t.uid,quantity:n}]).then(()=>{v==null||v({item:t})}).finally(()=>{F(t.uid,!1)}).catch(e=>{st(t.uid,e.message)})},lt=t=>{A(n=>n.filter(e=>e.item.uid!==t))},Yt=bt(()=>{Jt(t=>!t)},[]);W(()=>{const t=Bt.on("cart/data",n=>{jt(n),Wt(!!qt)},{eager:!0});return()=>{t==null||t.off()}},[]),W(()=>{P||A([])},[P]),W(()=>{K&&K(z)},[z,K]);const ut=(t,n)=>{if(d.includes("image"))return;const e={loading:n<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}},a=r(ln,{"data-testid":"cart-list-item-image",...e});return r(I,{name:"Thumbnail",slot:o==null?void 0:o.Thumbnail,context:{item:t,defaultImageProps:e},children:_?r("a",{href:_(t),children:a}):a})},dt=t=>{if(!d.includes("name"))return r("span",{"data-testid":"cart-list-item-title",children:_?r("a",{href:_(t),children:t.name}):t.name})},mt=t=>{if(d.includes("configurations"))return;const n={...t.bundleOptions,...t.selectedOptions,...t.customizableOptions,...t.recipient?{[c.recipient]:t.recipient}:null,...t.recipientEmail&&t.recipient?{[c.recipient]:`${t.recipient} (${t.recipientEmail})`}:null,...t.sender?{[c.sender]:t.sender}:null,...t.senderEmail&&t.sender?{[c.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[c.message]:t.message}:null,...t.links&&t.links.count?t.links.count>1?{[c.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[c.file.replace("{count}",t.links.count.toString())]:t.links.result}:null};if(Object.keys(n).length!==0)return n},gt=t=>{var n,e,a,s;return(u==null?void 0:u.price)==="INCLUDING_TAX"?t.discounted?{amount:t.regularPrice.value,currency:t.regularPrice.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(n=t.taxedPrice)==null?void 0:n.value,currency:(e=t.taxedPrice)==null?void 0:e.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(a=t.regularPrice)==null?void 0:a.value,currency:(s=t.regularPrice)==null?void 0:s.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}},ft=t=>{var n,e;return{amount:(n=t.savingsAmount)==null?void 0:n.value,currency:(e=t.savingsAmount)==null?void 0:e.currency,style:{font:"inherit"},"data-testid":"item-savings-amount"}},ht=t=>(u==null?void 0:u.price)==="INCLUDING_EXCLUDING_TAX"?r(G,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":c.regularPrice}):void 0,yt=t=>{var a,s,l,f,y,C,k,$,Qt,Et;const n={"aria-label":c.regularPrice},e=t.discounted?{}:null;return["INCLUDING_TAX","INCLUDING_EXCLUDING_TAX"].includes(u==null?void 0:u.price)?(n.amount=(a=t.rowTotalIncludingTax)==null?void 0:a.value,n.currency=(s=t.rowTotalIncludingTax)==null?void 0:s.currency,n.variant=t.discounted?"strikethrough":"default",n["data-testid"]="including-tax-item-total",e&&(n.amount=(l=t.total)==null?void 0:l.value,n.currency=(f=t.total)==null?void 0:f.currency,e.amount=(y=t.rowTotalIncludingTax)==null?void 0:y.value,e.currency=(C=t.rowTotalIncludingTax)==null?void 0:C.currency,e.sale=!0,e["aria-label"]=c.discountedPrice,e["data-testid"]="discount-total")):(n.amount=(k=t.total)==null?void 0:k.value,n.currency=($=t.total)==null?void 0:$.currency,n.variant=t.discounted?"strikethrough":"default",n["data-testid"]="regular-item-total",e&&(e.amount=(Qt=t.discountedTotal)==null?void 0:Qt.value,e.currency=(Et=t.discountedTotal)==null?void 0:Et.currency,e.sale=!0,e["aria-label"]=c.regularPrice,e["data-testid"]="discount-total")),{totalProps:n,discountProps:e}},vt=t=>{var y,C,k;if(d.includes("warning"))return;const n=z.get(t.uid),e=(y=z.get(t.uid))==null?void 0:y.includes("The requested qty is not available"),a=p.has(t.uid),s=t.insufficientQuantity&&t.stockLevel?t.stockLevel==="noNumber"?c.insufficientQuantityGeneral:c.insufficientQuantity.replace("{inventory}",(C=t.stockLevel)==null?void 0:C.toString()).replace("{count}",t.quantity.toString()):"",l=t.lowInventory&&t.onlyXLeftInStock&&c.lowInventory.replace("{count}",(k=t.onlyXLeftInStock)==null?void 0:k.toString()),f=!t.outOfStock&&n&&e?c.notAvailableMessage:n;return!a&&(n||t.insufficientQuantity||t.lowInventory)?S("span",{"data-testid":"item-warning",children:[r(D,{source:mn,size:"16"}),f||s||l]}):void 0},pt=t=>d!=null&&d.includes("alert")?void 0:!p.has(t.uid)&&t.outOfStock?S("span",{"data-testid":"item-alert",children:[r(D,{source:Rt,size:"16"}),c.outOfStockAlert]}):void 0,Ct=t=>r(I,{name:"ProductAttributes",slot:o==null?void 0:o.ProductAttributes,context:{item:t}}),kt=t=>{if(!d.includes("sku"))return r("span",{"data-testid":"cart-list-item-sku",children:t.sku})},It=t=>r(I,{name:"Footer",slot:o==null?void 0:o.Footer,context:{item:t,handleItemsLoading:F,handleItemsError:st,onItemUpdate:v}}),St=t=>i!=null&&i.totalQuantity?i.items.filter(t).map((n,e)=>{var f;const{totalProps:a,discountProps:s}=yt(n),l=r(sn,{updating:p==null?void 0:p.has(n.uid),loading:U,"data-testid":`cart-list-item-entry-${n.uid}`,image:ut(n,e),title:dt(n),sku:kt(n),price:d.includes("price")?void 0:r(G,{...gt(n)}),quantity:d.includes("quantity")?void 0:n.quantity,total:S(R,{children:[d.includes("total")?void 0:r(G,{...a}),d.includes("totalDiscount")?void 0:s&&r(G,{...s})]}),attributes:Ct(n),configurations:mt(n),totalExcludingTax:d.includes("totalExcludingTax")?void 0:ht(n),taxIncluded:(u==null?void 0:u.price)==="INCLUDING_TAX",taxExcluded:!d.includes("totalExcludingTax")&&(u==null?void 0:u.price)==="INCLUDING_EXCLUDING_TAX",warning:vt(n),alert:pt(n),quantityType:rt,dropdownOptions:it,onQuantity:J&&!p.has(n.uid)?y=>{Z(n,y)}:void 0,onRemove:X&&!p.has(n.uid)?()=>Z(n,0):void 0,discount:nt&&n.discounted&&n.discountPercentage?r("div",{"data-testid":"item-discount-percent",children:c.discountPercent.replace("{discount}",((f=n.discountPercentage)==null?void 0:f.toString())??"")}):void 0,savings:et&&n.discounted&&n.savingsAmount?S("div",{children:[r("span",{children:r(G,{...ft(n)})})," ",c.savingsAmount]}):void 0,footer:It(n)},n.uid);return r(I,{name:"CartItem",slot:o==null?void 0:o.CartItem,context:{item:n,index:e,enableUpdateItemQuantity:J,enableRemoveItem:X,itemsLoading:p,loading:U,attributesToHide:d,cartTaxesConfig:u,quantityType:rt,dropdownOptions:it,showDiscount:nt,showSavings:et,dictionary:c,getImage:ut,getTitle:dt,getSku:kt,getPriceProps:gt,getTotalPriceProps:yt,getProductAttributes:Ct,getConfiguration:mt,getTotalExcludingTax:ht,getWarning:vt,getAlert:pt,getFooter:It,getSavingsAmount:ft},children:l},n.uid)}):null,_t=r(I,{name:"Heading",slot:o==null?void 0:o.Heading,context:{count:i==null?void 0:i.totalQuantity},children:r("div",{"data-testid":"default-cart-heading",children:c.heading.replace("({count})",i!=null&&i.totalQuantity?`(${i==null?void 0:i.totalQuantity.toString()})`:"")})}),Zt=_t.props.children.props.children,Dt=()=>{const t=i==null?void 0:i.items.filter(n=>n.outOfStock);t==null||t.forEach(n=>{Z(n,0)})},Mt=St(t=>t.outOfStock||t.insufficientQuantity||!1),wt=i!=null&&i.hasOutOfStockItems?r($t,{"data-testid":"cart-out-of-stock-message",icon:r(D,{source:Rt,size:"16"}),itemList:r(V,{"data-testid":"out-of-stock-cart-items",children:Mt}),type:"warning",heading:c.outOfStockHeading,description:c.outOfStockDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:i!=null&&i.hasFullyOutOfStockItems&&X?[{label:c.removeAction,onClick:Dt}]:void 0}):void 0,h=St(t=>!t.outOfStock&&!t.insufficientQuantity),At=x?Math.max(m||5,5):Math.min((i==null?void 0:i.totalQuantity)||5,5),Ot=(i==null?void 0:i.totalQuantity)>At,Ht=Ot&&!x&&At!=m,q=i!=null&&i.totalQuantity&&h?r(I,{name:"Footer",slot:o==null?void 0:o.CartSummaryFooter,context:{displayMaxItems:x,routeCart:g},"data-testid":"cart-cart-summary-footer-slot",className:"cart-cart-summary-footer",children:Ot?Ht?r(M,{className:"cart-cart-summary-list-footer__action",onClick:Yt,"data-testid":"view-more-items-button",variant:"tertiary",children:c.viewMore}):g&&r(M,{className:"cart-cart-summary-list-footer__action",href:g(),variant:"tertiary","data-testid":"view-cart-or-less-items-button",children:c.viewAll}):g&&r(M,{className:"cart-cart-summary-list-footer__action",href:g(),variant:"tertiary","data-testid":"view-cart-button",children:c.viewAll})}):null,Nt=()=>{if(!(i!=null&&i.items))return null;const t=[],n=i.items,e=o==null?void 0:o.UndoBanner,a=x?Math.max(m||(i==null?void 0:i.totalQuantity),5):Math.min(m??5,5);for(let s=0;s<=a;s++)P&&w.filter(l=>l.index===s).forEach(({item:l,error:f,beingRemoved:y})=>{var k,$;const C=r($t,{type:f?"error":"info",heading:y?(k=c.itemBeingRemoved)==null?void 0:k.replace("{product}",l.name):($=c.itemRemoved)==null?void 0:$.replace("{product}",l.name),description:f||c.itemRemovedDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:y?[]:[{label:c.undoAction,onClick:()=>T(l.uid),"aria-label":`${c.undoAction} remove ${l.name}`},{label:c.dismissAction,onClick:()=>lt(l.uid),"aria-label":`${c.dismissAction} undo for ${l.name}`}]},`undo-banner-${l.uid}`);t.push(e?r(I,{name:"UndoBanner",slot:e,context:{item:l,loading:U,error:f,onUndo:()=>T(l.uid),onDismiss:()=>lt(l.uid)},children:C},`undo-banner-${l.uid}`):C)}),s<a&&s<n.length&&t.push((h==null?void 0:h[s])||null);return r(V,{"data-testid":"cart-list",children:t})},T=bt(async t=>{A(e=>e.map(a=>a.item.uid===t?{...a,loading:!0,error:void 0}:a));const n=w.find(e=>e.item.uid===t);if(n)try{await dn([{sku:n.item.sku,parentSku:n.item.topLevelSku,quantity:n.item.quantity,optionsUIDs:n.item.bundleOptionsUIDs||(n.item.selectedOptionsUIDs?Object.values(n.item.selectedOptionsUIDs):void 0),enteredOptions:n.item.customizableOptions?Object.entries(n.item.customizableOptions).map(([e,a])=>({uid:e,value:a})):void 0}]),A(e=>e.filter(a=>a.item.uid!==t))}catch(e){A(a=>a.map(s=>s.item.uid===t?{...s,error:(e==null?void 0:e.message)||"Failed to restore item."}:s))}},[w]);nn(Tt,()=>({handleUndo:T}),[T]);const Pt=r(R,{children:P&&w.length>0?Nt():r(I,{name:"EmptyCart",slot:o==null?void 0:o.EmptyCart,context:{},children:r(en,{"data-testid":"empty-cart",ctaLinkURL:E==null?void 0:E()})})}),xt=i!=null&&i.totalQuantity||P&&w.length>0?P?w.length>0?Nt():r(V,{"data-testid":"cart-list",children:h==null?void 0:h.slice(0,x?Math.max(m||(i==null?void 0:i.totalQuantity),5):Math.min(m??5,5))}):r(V,{"data-testid":"cart-list",children:h==null?void 0:h.slice(0,x?Math.max(m||(i==null?void 0:i.totalQuantity),5):Math.min(m??5,5))}):null;return Ft?r(cn,{"data-testid":"cart-summary-list-accordion",className:Q(["cart-cart-summary-list-accordion",`cart-cart-summary-list__background--${Y}`]),iconOpen:hn,iconClose:gn,children:r(on,{title:Zt,"data-testid":"cart-summary-list-accordion__section",open:!0,renderContentWhenClosed:!0,children:r(Xt,{...ct,"aria-expanded":!0,"aria-label":"TEST",className:"cart-cart-summary-list-accordion__list",loading:U,footer:N?void 0:q||(g?q:void 0),emptyCart:Pt,products:xt,outOfStockMessage:wt,variant:Y})})}):r(Xt,{...ct,heading:H?void 0:_t,footer:N?void 0:q||(g?q:void 0),loading:U,emptyCart:Pt,products:xt,outOfStockMessage:wt,variant:Y})});vn.getInitialData=async function(){return zt()};export{vn as C};
//# sourceMappingURL=CartSummaryList.js.map
