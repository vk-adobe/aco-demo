/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as n,jsxs as y}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as T,useCallback as P,useEffect as x,useMemo as j,useState as f}from"@dropins/tools/preact-compat.js";import{Button as $,Price as q,Image as D}from"@dropins/tools/components.js";import{VComponent as v,Slot as g}from"@dropins/tools/lib.js";import{events as p}from"@dropins/tools/event-bus.js";/* empty css                   */import{useText as K}from"@dropins/tools/i18n.js";const O=({productList:a,viewAllButton:i,onClose:r,...s})=>{const o=a&&a.length>0,t=T(null),u=P(c=>{t.current&&!t.current.contains(c.target)&&(r==null||r())},[r]),l=P(c=>{c.key==="Escape"&&(r==null||r())},[r]);return x(()=>{if(o)return document.addEventListener("mousedown",u),document.addEventListener("keydown",l),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("keydown",l)}},[o,u,l]),o?n("div",{className:"product-discovery--search-bar-results",...s,children:y("div",{className:"product-discovery--search-bar-results__popover",ref:t,role:"region","aria-label":"Search results","aria-live":"polite",children:[n("div",{className:"product-discovery--search-bar-results__grid",role:"list","aria-label":`${(a==null?void 0:a.length)||0} search results`,children:a==null?void 0:a.map((c,m)=>n("div",{role:"listitem",children:c},m))}),i&&n("div",{className:"product-discovery--search-bar-results__view-all-wrapper",children:n(v,{className:"product-discovery--search-bar-results__view-all-button",node:i})})]})}):null},Q=({productItem:a,productImage:i,productName:r,productPrice:s,...o})=>{const t=j(()=>{const{name:u="",sku:l="",url:c=""}=a||{};return{tooltipText:[u,l&&`SKU: ${l}`].filter(Boolean).join(`
`),url:c}},[a]);return y("a",{className:"product-discovery--product-item",href:t.url,target:"_blank",rel:"noopener noreferrer",title:t.tooltipText,...o,children:[n("div",{className:"product-discovery--product-item__image",children:n(v,{node:i})}),y("div",{className:"product-discovery--product-item__details",children:[n(v,{node:r}),n(v,{node:s})]})]})},W=({products:a=[],routeSearch:i=()=>{},slots:r})=>{const[s,o]=f(a),[t,u]=f(""),[l,c]=f(a.length>0),m=K({viewAllButton:"Search.SearchInput.viewAllButton"});x(()=>{const e=p.on("search-input/result",B);return()=>{e==null||e.off()}},[]);const B=({result:e=[],request:d={}})=>{const{phrase:h=""}=d;o(e),u(h),c(e.length>0&&h.length>0)},w=P(()=>{i&&i(t),p.emit("search/request",{phrase:t}),p.emit("search-input/result",{result:[],request:{phrase:""}}),c(!1)},[i,t]),R=e=>{var d,h;return n(g,{name:"ProductImage",slot:r==null?void 0:r.ProductImage,context:{productItem:e},children:n(D,{src:((h=(d=e==null?void 0:e.images)==null?void 0:d[0])==null?void 0:h.url)||""})})},S=e=>n(g,{name:"ProductName",slot:r==null?void 0:r.ProductName,context:{productItem:e},children:(e==null?void 0:e.name)||""}),k=e=>{var _,N,b;const{value:d,currency:h}=((b=(N=(_=e==null?void 0:e.priceRange)==null?void 0:_.minimum)==null?void 0:N.final)==null?void 0:b.amount)||{};return n(g,{name:"ProductPrice",slot:r==null?void 0:r.ProductPrice,context:{productItem:e},children:n(q,{amount:typeof d=="number"?d:void 0,currency:h})})},E=e=>n(Q,{productItem:e,productImage:R(e),productName:S(e),productPrice:k(e)}),A=()=>n($,{variant:"tertiary",onClick:()=>{w()},children:m.viewAllButton});return n("div",{children:s.length>0&&l&&n(O,{productList:s==null?void 0:s.map(e=>E(e)),viewAllButton:A(),onClose:w})})};export{W as SearchBarResults,W as default};
//# sourceMappingURL=SearchBarResults.js.map
