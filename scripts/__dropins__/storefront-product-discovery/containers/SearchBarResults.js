/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as N}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as $,useCallback as k,useEffect as p,useMemo as q,useState as _}from"@dropins/tools/preact-compat.js";import{Button as C,Price as K,Image as O}from"@dropins/tools/components.js";import{VComponent as y,Slot as b}from"@dropins/tools/lib.js";import{events as w}from"@dropins/tools/event-bus.js";/* empty css                   */import{s as Q,S as U}from"../chunks/acdlEvents.js";import{useText as z}from"@dropins/tools/i18n.js";const H=({productList:i,viewAllButton:l,onClose:a,...n})=>{const t=i&&i.length>0,o=$(null),s=k(c=>{o.current&&!o.current.contains(c.target)&&(a==null||a())},[a]),u=k(c=>{c.key==="Escape"&&(a==null||a())},[a]);return p(()=>{if(t)return document.addEventListener("mousedown",s),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",u)}},[t,s,u]),t?r("div",{className:"product-discovery--search-bar-results",...n,children:r("div",{className:"product-discovery--search-bar-results__popover",ref:o,role:"region","aria-label":"Search results","aria-live":"polite",children:N("div",{className:"product-discovery--search-bar-results__outer-container",...n,children:[r("div",{className:"product-discovery--search-bar-results__grid",role:"list","aria-label":`${(i==null?void 0:i.length)||0} search results`,children:i==null?void 0:i.map((c,h)=>r("div",{role:"listitem",children:c},h))}),l&&r("div",{className:"product-discovery--search-bar-results__view-all-wrapper",children:r(y,{className:"product-discovery--search-bar-results__view-all-button",node:l})})]})})}):null},M=({productRouteSearch:i=s=>(s==null?void 0:s.url)||"",productItem:l,productImage:a,productName:n,productPrice:t,...o})=>{const s=q(()=>{const{name:c="",sku:h="",url:P=""}=l||{};return{tooltipText:[c,h&&`SKU: ${h}`].filter(Boolean).join(`
`),url:P}},[l]),u=c=>{Q(c.sku,U)};return N("a",{className:"product-discovery--product-item",href:i(l),target:"_blank",rel:"noopener noreferrer",title:s.tooltipText,onClick:()=>u(l),...o,children:[r("div",{className:"product-discovery--product-item__image",children:r(y,{node:a})}),N("div",{className:"product-discovery--product-item__details",children:[r(y,{node:n}),r(y,{node:t})]})]})},I=({products:i=[],productRouteSearch:l=t=>(t==null?void 0:t.url)||"",routeSearch:a=()=>{},slots:n})=>{const[t,o]=_(i),[s,u]=_(""),[c,h]=_(i.length>0),P=z({viewAllButton:"Search.SearchInput.viewAllButton"});p(()=>{const e=w.on("search-input/result",S);return()=>{e==null||e.off()}},[]);const S=({result:e=[],request:d={}})=>{const{phrase:m=""}=d;o(e),u(m),h(e.length>0&&m.length>0)},R=k(()=>{a&&a(s),w.emit("search/request",{phrase:s}),w.emit("search-input/result",{result:[],request:{phrase:""}}),h(!1)},[a,s]),E=e=>{var m,v,f,g;const d={loading:"lazy",src:((v=(m=e.images)==null?void 0:m[0])==null?void 0:v.url)||"",alt:((g=(f=e.images)==null?void 0:f[0])==null?void 0:g.label)||"",width:"165",height:"165"};return r(b,{name:"ProductImage",slot:n==null?void 0:n.ProductImage,context:{productItem:e,defaultImageProps:d},children:r(O,{...d,"aria-label":e.sku})})},A=e=>r(b,{name:"ProductName",slot:n==null?void 0:n.ProductName,context:{productItem:e},children:(e==null?void 0:e.name)||""}),T=e=>{var v,f,g,x,B;const{value:d,currency:m}=((f=(v=e==null?void 0:e.price)==null?void 0:v.final)==null?void 0:f.amount)||((B=(x=(g=e==null?void 0:e.priceRange)==null?void 0:g.minimum)==null?void 0:x.final)==null?void 0:B.amount)||{};return r(b,{name:"ProductPrice",slot:n==null?void 0:n.ProductPrice,context:{productItem:e},children:r(K,{amount:typeof d=="number"?d:void 0,currency:m})})},j=e=>r(M,{productRouteSearch:l,productItem:e,productImage:E(e),productName:A(e),productPrice:T(e)}),D=()=>r(C,{variant:"tertiary",onClick:()=>{R()},children:P.viewAllButton});return r("div",{children:t.length>0&&c&&r(H,{productList:t==null?void 0:t.map(e=>j(e)),viewAllButton:D(),onClose:R})})};export{I as SearchBarResults,I as default};
//# sourceMappingURL=SearchBarResults.js.map
