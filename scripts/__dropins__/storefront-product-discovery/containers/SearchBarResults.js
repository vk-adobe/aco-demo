/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as n,jsxs as x}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as K,useCallback as u,useEffect as j,useMemo as p,useState as S}from"@dropins/tools/preact-compat.js";import{Image as Q,Price as V,Button as z}from"@dropins/tools/components.js";import{VComponent as _,Slot as b}from"@dropins/tools/lib.js";import{events as k}from"@dropins/tools/event-bus.js";/* empty css                   */import{s as C,S as H}from"../chunks/acdlEvents.js";import{useText as M}from"@dropins/tools/i18n.js";const F=({productList:i,viewAllButton:s,onClose:c,...r})=>{const a=i&&i.length>0,d=K(null),t=u(l=>{d.current&&!d.current.contains(l.target)&&(c==null||c())},[c]),h=u(l=>{l.key==="Escape"&&(c==null||c())},[c]);return j(()=>{if(a)return document.addEventListener("mousedown",t),document.addEventListener("keydown",h),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",h)}},[a,t,h]),a?n("div",{className:"product-discovery--search-bar-results",...r,children:n("div",{className:"product-discovery--search-bar-results__popover",ref:d,role:"region","aria-label":"Search results","aria-live":"polite",children:x("div",{className:"product-discovery--search-bar-results__outer-container",...r,children:[n("div",{className:"product-discovery--search-bar-results__grid",role:"list","aria-label":`${(i==null?void 0:i.length)||0} search results`,children:i==null?void 0:i.map((l,m)=>n("div",{role:"listitem",children:l},m))}),s&&n("div",{className:"product-discovery--search-bar-results__view-all-wrapper",children:n(_,{className:"product-discovery--search-bar-results__view-all-button",node:s})})]})})}):null},G=({productRouteSearch:i=t=>(t==null?void 0:t.url)||"",productItem:s,productImage:c,productName:r,productPrice:a,...d})=>{const t=p(()=>{const{name:l="",sku:m="",url:y=""}=s||{};return{tooltipText:[l,m&&`SKU: ${m}`].filter(Boolean).join(`
`),url:y}},[s]),h=l=>{C(l.sku,H)};return x("a",{className:"product-discovery--product-item",href:i(s),rel:"noopener noreferrer",title:t.tooltipText,onClick:()=>h(s),...d,children:[n("div",{className:"product-discovery--product-item__image",children:n(_,{node:c})}),x("div",{className:"product-discovery--product-item__details",children:[n(_,{node:r}),n(_,{node:a})]})]})},re=({products:i=[],productRouteSearch:s=a=>(a==null?void 0:a.url)||"",routeSearch:c=()=>{},slots:r})=>{const[a,d]=S(i),[t,h]=S(""),[l,m]=S(i.length>0),y=M({viewAllButton:"Search.SearchInput.viewAllButton"}),N=u(({result:e=[],request:v={}})=>{const{phrase:o=""}=v;d(e),h(o),m(e.length>0&&o.length>0)},[]);j(()=>{const e=k.on("search-input/result",N);return()=>{e==null||e.off()}},[N]);const w=u(()=>{k.emit("search-input/result",{result:[],request:{phrase:""}}),m(!1)},[]),B=u(()=>{c&&c(t),k.emit("search/request",{phrase:t}),w()},[c,t,w]),R=u(e=>{var o,P,f,g;const v={loading:"lazy",src:((P=(o=e.images)==null?void 0:o[0])==null?void 0:P.url)||"",alt:((g=(f=e.images)==null?void 0:f[0])==null?void 0:g.label)||"",width:"165",height:"165"};return n(b,{name:"ProductImage",slot:r==null?void 0:r.ProductImage,context:{productItem:e,defaultImageProps:v},children:n(Q,{...v,"aria-label":e.sku})})},[r==null?void 0:r.ProductImage]),E=u(e=>n(b,{name:"ProductName",slot:r==null?void 0:r.ProductName,context:{productItem:e},children:(e==null?void 0:e.name)||""}),[r==null?void 0:r.ProductName]),A=u(e=>{var f,g,T,O,U;const{value:v,currency:o="USD"}=((g=(f=e==null?void 0:e.price)==null?void 0:f.final)==null?void 0:g.amount)||((U=(O=(T=e==null?void 0:e.priceRange)==null?void 0:T.minimum)==null?void 0:O.final)==null?void 0:U.amount)||{},P=Intl.supportedValuesOf("currency").indexOf(o||"")===-1?"USD":o;return n(b,{name:"ProductPrice",slot:r==null?void 0:r.ProductPrice,context:{productItem:e},children:n(V,{amount:typeof v=="number"?v:void 0,currency:P})})},[r==null?void 0:r.ProductPrice]),D=u(e=>n(G,{productRouteSearch:s,productItem:e,productImage:R(e),productName:E(e),productPrice:A(e)}),[s,R,E,A]),$=p(()=>n(z,{variant:"tertiary",onClick:B,children:y.viewAllButton}),[y.viewAllButton,B]),q=p(()=>a==null?void 0:a.map(e=>D(e)),[a,D]);return!a.length||!l?null:n(F,{productList:q,viewAllButton:$,onClose:w})};export{re as SearchBarResults,re as default};
//# sourceMappingURL=SearchBarResults.js.map
