/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as k,jsx as a,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import*as u from"@dropins/tools/preact-compat.js";import{useState as L,useEffect as q}from"@dropins/tools/preact-compat.js";import{VComponent as y,classes as z,Slot as R}from"@dropins/tools/lib.js";import{Button as x,Icon as A,ActionButton as H,PriceRange as V,Divider as j,Checkbox as D,RadioButton as P}from"@dropins/tools/components.js";/* empty css                 */import{useText as O}from"@dropins/tools/i18n.js";/* empty css                   *//* empty css                      *//* empty css                   */import{events as N}from"@dropins/tools/event-bus.js";const T=e=>u.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},u.createElement("g",{id:"Large"},u.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),u.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},u.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),u.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),U=e=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 12H21",stroke:"currentColor"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 6H21",stroke:"currentColor"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 18H21",stroke:"currentColor"})),W=e=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),Y=e=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},u.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),G=({numberOfOptionsConfig:e=5,header:t,buckets:c})=>{const i=O({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),m=e,[h,g]=L(c.length<m),p=h?c.length:m;return k("div",{children:[a(y,{className:"plp-facet__header",node:t}),c.slice(0,p).map((F,v)=>a(y,{className:"plp-facet__bucket",node:F},v)),!h&&c.length>m&&a(x,{variant:"tertiary",icon:a(A,{source:T,size:"24"}),onClick:()=>g(!h),children:i.showMore}),h&&c.length>m&&a(x,{variant:"tertiary",icon:a(A,{source:Y,size:"24"}),onClick:()=>g(!h),children:i.showLess})]})},J=({selectedFacets:e,facets:t})=>{const[c,i]=L(!0),m=()=>{i(!c)};return k("div",{className:"plp-facet-list",children:[a("div",{className:"plp-facet-list__show-filters-button",children:k(H,{onClick:()=>{m()},children:[a(A,{source:U,size:"16"}),a("span",{children:"Filters"})]})}),a(y,{className:"plp-facet-list__selected-filters",node:e}),a(y,{className:z(["plp-facet-list__facet-options",["plp-facet-list__facet-options--hidden",c]]),node:t})]})},K="no",Q="yes",X=e=>{const t=e.buckets.find(c=>c.selected);return t?{attribute:e.attribute,range:{from:t.from,to:t.to}}:null},Z=e=>{const t=e.buckets.reduce((c,i)=>(i.selected&&c.push(i.title),c),[]);return t.length===0?null:{attribute:e.attribute,in:t}},I=e=>{var t;switch((t=e.buckets[0])==null?void 0:t.__typename){case"RangeBucket":return X(e);case"ScalarBucket":case"CategoryView":return Z(e)}},ee=e=>{var c,i,m,h,g,p,F,v,S,_,E;const t=e[0];return(m=(i=(c=t==null?void 0:t.price)==null?void 0:c.regular)==null?void 0:i.amount)!=null&&m.currency?t.price.regular.amount.currency:(F=(p=(g=(h=t==null?void 0:t.priceRange)==null?void 0:h.minimum)==null?void 0:g.regular)==null?void 0:p.amount)!=null&&F.currency?(E=(_=(S=(v=t==null?void 0:t.priceRange)==null?void 0:v.minimum)==null?void 0:S.regular)==null?void 0:_.amount)==null?void 0:E.currency:"USD"},te=(e,t,c)=>(t==null?void 0:t.attribute)==="price"?a(V,{minimumAmount:e.from,maximumAmount:e.to,currency:c||"USD",display:"dash"}):e.title,ne=(e,t)=>e.title===K?`Not ${t.title}`:e.title===Q?t.title:e.title,M=(e,t,c)=>{switch(e.__typename){case"RangeBucket":return te(e,t,c);case"ScalarBucket":case"CategoryView":return ne(e,t)}},he=({slots:e})=>{const t=O({clearAll:"Search.Facet.clearAll"}),[c,i]=L([]),[m,h]=L(null),g=r=>{if(!r||!r.result.facets&&!r.result.items&&!r.request.filter){i([]);return}const{facets:l,items:d}=r.result;h(ee(d));const n=r.request.filter;if(l){const s=l.map(o=>{const f=o.buckets.map(w=>{w.selected=!1;const C=n==null?void 0:n.find(B=>B.attribute===o.attribute);if(C){const B=C.range;(B&&w.from===B.from&&w.to===B.to||C.in&&C.in.includes(w.title))&&(w.selected=!0)}return w});return o.buckets=f,o});i(s)}},p=r=>{const l=c.map(n=>{const s=r.find(o=>o.attribute===n.attribute);return s||n}),d=l.reduce((n,s)=>{const o=I(s);return o&&n.push(o),n},[]);i(l),N.emit("search/request",{filter:d})},F=(r,l)=>{const d=r.buckets.map(s=>(s.title===l&&(s.selected=!1),s)),n=r;n.buckets=d,p([n])},v=()=>{const r=c.map(l=>{const d=l.buckets.map(n=>(n.selected=!1,n));return l.buckets=d,l});i(r),N.emit("search/request",{filter:[]})},S=(r,l)=>{const d=l.buckets.map(s=>{var o;return((o=l.buckets[0])==null?void 0:o.__typename)==="RangeBucket"&&(s.selected=!1),s.title===r.target.value&&(s.selected=r.target.checked),s}),n=l;n.buckets=d,p([n])},_=r=>{const l=a("span",{children:r.title}),d=r.buckets.map(n=>{var o;const s=M(n,r,m);switch((o=r.buckets[0])==null?void 0:o.__typename){case"RangeBucket":return a(P,{"data-testid":`${n.title}-radio`,label:s,name:r.attribute,value:n.title,checked:n.selected,onChange:f=>{S(f,r)}});case"ScalarBucket":case"CategoryView":return a(D,{"data-testid":`${n.title}-checkbox`,label:`${s} (${n.count})`,name:r.attribute,value:n.title,checked:n.selected,onChange:f=>{S(f,r)}});default:return null}}).filter(n=>n!==null);return a(G,{header:l,buckets:d})},E=()=>a(R,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:c},children:c.map(r=>r.buckets.length>0?k(b,{children:[a(R,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:r},children:_(r)}),a(j,{variant:"secondary"})]}):null)}),$=()=>{const r=c.reduce((n,s)=>(s.buckets.filter(f=>f.selected).length>0&&n.push(s),n),[]),l=r.map(n=>n.buckets.map(s=>{if(s.selected){const o=M(s,n,m);return a(x,{"data-testid":`${s.title}-selected-btn`,variant:"secondary",children:k(b,{children:[a("span",{children:o}),a(A,{source:W,size:"16"})]}),onClick:()=>{F(n,s.title)}})}return null})),d=l.length>0?a(x,{variant:"secondary",onClick:()=>{v()},children:a("span",{children:t.clearAll})}):null;return k(R,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:r},children:[l,d]})};return q(()=>{N.on("search/result",g)},[]),a(J,{selectedFacets:$(),facets:E()})};export{he as Facets,he as default};
//# sourceMappingURL=Facets.js.map
