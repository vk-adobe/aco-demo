/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as o,jsxs as x}from"@dropins/tools/preact-jsx-runtime.js";import*as P from"@dropins/tools/preact-compat.js";import{useState as _,useCallback as le,useEffect as he}from"@dropins/tools/preact-compat.js";import{classes as S,VComponent as g,Slot as E}from"@dropins/tools/lib.js";import{Skeleton as ue,SkeletonRow as I,InLineAlert as pe,Icon as ge,Pagination as fe,Picker as _e,PriceRange as M,Image as Se}from"@dropins/tools/components.js";import{p as Pe}from"../chunks/productSearch.js";import{u as we,P as y,s as Ee,d as Le,a as Ce,b as ke,c as ye,e as Re,f as xe}from"../chunks/acdlEvents.js";import{a as Ne}from"../chunks/attributeMetadata.js";/* empty css                 *//* empty css                   *//* empty css                      *//* empty css                   */import{events as $}from"@dropins/tools/event-bus.js";import{useText as Ae,Text as Ie}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const Ue=t=>P.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},P.createElement("g",{clipPath:"url(#clip0_841_1324)"},P.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),P.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),P.createElement("defs",null,P.createElement("clipPath",{id:"clip0_841_1324"},P.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),De=()=>o("div",{className:"dropin-product-item-card dropin-product-item-card-skeleton",children:x(ue,{className:"dropin-product-item-card__skeleton dropin-product-item-card__image-container",children:[o(I,{fullWidth:!0,className:"dropin-product-item-card__skeleton__image"}),x("div",{className:"dropin-product-item-card__content dropin-product-item-card__skeleton__content",children:[o(I,{fullWidth:!0,size:"large",className:"dropin-product-item-card__skeleton__item"}),o(I,{fullWidth:!0,size:"xsmall",className:"dropin-product-item-card__skeleton__item"}),o(I,{fullWidth:!0,size:"small",className:"dropin-product-item-card__skeleton__item"})]})," "]})}),ze=({className:t,image:r,titleNode:n,price:i,sku:c,actionButton:a,swatches:h,initialized:u=!1,...z})=>u?x("div",{...z,className:S(["dropin-product-item-card",t]),children:[o("div",{className:"dropin-product-item-card__image-container",children:r&&o(g,{node:r,className:S(["dropin-product-item-card__image"])})}),x("div",{className:"dropin-product-item-card__content",children:[n&&o(g,{node:n,className:S(["dropin-product-item-card__title"])}),c&&o(g,{node:c,className:S(["dropin-product-item-card__sku"])}),i&&o("div",{className:"dropin-product-item-card__price",children:o(g,{node:i,className:S(["dropin-product-item-card__price"])})}),h&&o("div",{className:"dropin-product-item-card__swatches",children:o(g,{node:h,className:S(["dropin-product-item-card__swatches"])})}),a&&o("div",{className:"dropin-product-item-card__action",children:o(g,{node:a,className:S(["dropin-product-item-card__action"])})})]})]}):o(De,{});function Fe(t){var c;let r="";try{r=self.crypto.randomUUID(),we(y,r,t.phrase||"",t.filter||[],t.pageSize||0,t.currentPage||0,t.sort||[]),Ee(y)}catch(a){console.error("Error collecting data:",a)}const n={attribute:"visibility",in:["Search","Catalog, Search"]},i=structuredClone(t);return(c=i.filter)==null||c.push(n),Pe(i).then(a=>{const h=Le(a);try{Ce(y,r,h),ke(y),t.phrase&&ye(y)}catch(u){console.error("Error collecting data:",u)}return h}).catch(a=>{throw console.error("Error fetching product search:",a),new Error("Error fetching product search.")}).finally(()=>{})}function He(){return Ne().then(t=>Re(t)).catch(t=>{throw console.error("Error fetching attribute metadata:",t),new Error("Error fetching attribute metadata.")}).finally(()=>{})}const O=t=>({text:t.relevanceLabel,value:"relevance_DESC"}),$e=(t,r)=>{const n=O(r),i=t.reduce((c,a)=>(a.attribute!=="position"&&a.attribute!=="relevance"&&(a.attribute==="price"?(c.push({text:r.sortASC,value:`${a.attribute}_ASC`}),c.push({text:r.sortDESC,value:`${a.attribute}_DESC`})):c.push({text:a.label,value:`${a.attribute}_DESC`})),c),[]);return i.push(n),{options:i,default:n}},U=t=>{const r=t.indexOf("_");return[{attribute:t.substring(0,r),direction:t.substring(r+1)==="ASC"?"ASC":"DESC"}]},qe=t=>t.length>0?`${t[0].attribute}_${t[0].direction}`:"",Me=(t,r)=>{const n=t.findIndex(i=>i.value===r);return n>-1?t[n]:null},We=({header:t,productList:r,footer:n})=>x("div",{className:"plp-product-list",children:[t&&o(g,{className:"plp-product-list__header",node:t}),o("div",{className:"plp-product-list__grid",children:r&&o(g,{node:r})}),n&&o(g,{className:"plp-product-list__pagination",node:n})]}),Oe=({alertMessage:t=""})=>o("div",{className:S(["plp-search-alert-message__wrapper"]),children:o("div",{className:"plp-search-alert-message__content",children:o(pe,{heading:t,type:"warning",icon:o(ge,{source:Ue,size:"24"}),onDismiss:void 0})})}),j={search:"q",search_query:"search_query",pagination:"p",sort:"product_list_order",page_size:"page_size"},R=t=>{const n=T().get(t);return n||""},T=()=>{const t=window.location.search;return new URLSearchParams(t)},je=t=>{const r=new URL(window.location.href),n=new URLSearchParams(r.searchParams);t===1?n.delete("p"):n.set("p",t.toString()),D(r.pathname,n)},Te=t=>{const r=new URL(window.location.href),n=new URLSearchParams(r.searchParams);n.set("product_list_order",t),D(r.pathname,n)},Qe=t=>{const r=new URL(window.location.href),n=new URLSearchParams(r.searchParams);n.set("q",t),D(r.pathname,n)},D=(t,r)=>{r.toString()===""?window.history.pushState({},"",`${t}`):window.history.pushState({},"",`${t}?${r.toString()}`)},W=t=>{var i;const r=T(),n=[];for(const[c,a]of r.entries())if(t.includes(c)&&!Object.values(j).includes(c))if(a.includes("--")){const h=a.split("--"),u={attribute:c,range:{from:Number(h[0]),to:Number(h[1])}};n.push(u)}else{const h=n.findIndex(u=>u.attribute==c);if(h!==-1)(i=n[h].in)==null||i.push(a);else{const u={attribute:c,in:[a]};n.push(u)}}return n},Ze=t=>{const r=new URL(window.location.href),n=new URLSearchParams(r.searchParams);for(const i of r.searchParams.keys())Object.values(j).includes(i)||n.delete(i);t.forEach(i=>{const c=i.attribute;if(i.range){const a=i.range;R(c)?(n.delete(c),n.append(c,`${a.from}--${a.to}`)):n.append(c,`${a.from}--${a.to}`)}else{const a=i.in||[],h=n.getAll(c);a.map(u=>{h.includes(u)||n.append(c,u)})}}),D(r.pathname,n)},Be=t=>new DOMParser().parseFromString(t,"text/html").documentElement.textContent,at=({minQueryLength:t=3,slots:r,pageSize:n=12,routeProduct:i})=>{const c=Ae({relevanceLabel:"Search.PLP.SortDropdown.relevanceLabel",sortASC:"Search.PLP.SortDropdown.sortASC",sortDESC:"Search.PLP.SortDropdown.sortDESC",minQueryLength:o(Ie,{id:"Search.PLP.Warning.minQueryLength",fields:{minQueryLength:t}}),noResults:"Search.PLP.Warning.noResults",searchError:"Search.PLP.Warning.searchError"}),[a,h]=_([]),[u,z]=_(),[Q,Z]=_(1),[B,w]=_(!1),[v,L]=_(c.noResults),N=O(c),[K,F]=_(),[G,J]=_([]),X=[...Array(n).keys()].map(()=>{const e=xe({});return e.initialized=!1,e}),[C,Y]=_(X),b=e=>{A({currentPage:e})},V=e=>{z(e),je(e)},ee=e=>{const s=U(e);F(e),A({sort:s})},te=e=>{const s=e.phrase||"";Qe(s);const l=e.filter||[];Ze(l);const m=qe(e.sort||[]);Te(m)},re=e=>He().then(s=>{J(((s==null?void 0:s.filterableInSearch)||[]).map(d=>d.attribute));const l=$e(s==null?void 0:s.sortable,c);h(l.options);const m=Me(l.options,e||l.default.value);return F(m.value),W(((s==null?void 0:s.filterableInSearch)||[]).map(d=>d.attribute))}).catch(()=>{w(!0),L(c.searchError)}),A=e=>{var p;const s=R("product_list_order"),l=U(s||N.value),m={phrase:(e==null?void 0:e.phrase)||R("q"),pageSize:(e==null?void 0:e.pageSize)||n,currentPage:(e==null?void 0:e.currentPage)||u,filter:(e==null?void 0:e.filter)||W(G),sort:(e==null?void 0:e.sort)||l};if((e!=null&&e.phrase||e!=null&&e.filter||e!=null&&e.sort||e!=null&&e.pageSize)&&(m.currentPage=1,e!=null&&e.phrase&&(m.filter=[],m.sort=U(N.value),F(N.value))),te(m),(((p=m==null?void 0:m.phrase)==null?void 0:p.length)||0)<t)w(!0),L(c.minQueryLength.replace("{SEARCH_PHRASE}",(m==null?void 0:m.phrase)||"")),H();else return w(!1),Fe(m).then(d=>{var f,k;$.emit("search/result",{result:d,request:m}),(d==null?void 0:d.totalCount)===0&&(d==null?void 0:d.items.length)===0?(w(!0),L(c.noResults)):(Y(d==null?void 0:d.items.map(q=>(q.initialized=!0,q))),V(((f=d==null?void 0:d.pageInfo)==null?void 0:f.currentPage)||1),Z(((k=d==null?void 0:d.pageInfo)==null?void 0:k.totalPages)||1))}).catch(()=>{w(!0),L(c.searchError),H()}).finally(()=>{})},ne=le(e=>{A(e)},[]),H=()=>{$.emit("search/result",{result:{},request:{}})};he(()=>{const e=R("q"),s=R("product_list_order")||N.value;re(s).then(m=>{e!=null&&e.length&&e.length<t?(w(!0),L(c.minQueryLength.replace("{SEARCH_PHRASE}",e)),H()):A({filter:m})});const l=$.on("search/request",ne);return()=>{l==null||l.off()}},[]);const oe=e=>o(E,{name:"ProductActions",slot:r==null?void 0:r.ProductActions,context:{product:e}}),ce=e=>{var l,m,p,d,f;const s=e.typename==="ComplexProductView"?o(M,{display:"from to",minimumAmount:(l=e.priceRange)==null?void 0:l.minimum.regular.amount.value,maximumAmount:(m=e.priceRange)==null?void 0:m.maximum.regular.amount.value,currency:(p=e.priceRange)==null?void 0:p.minimum.regular.amount.currency}):o(M,{amount:(d=e.price)==null?void 0:d.regular.amount.value,currency:(f=e.price)==null?void 0:f.regular.amount.currency});return o(E,{name:"ProductPrice",slot:r==null?void 0:r.ProductPrice,context:{product:e},children:i?o("a",{href:i(e),children:s}):s})},ae=e=>{const s=e.name!==null?Be(e.name):"";return o(E,{name:"ProductName",slot:r==null?void 0:r.ProductName,context:{product:e},children:i?o("a",{href:i(e),children:s}):s})},se=(e,s)=>{var p,d,f,k;const l={loading:s<8?"eager":"lazy",src:((d=(p=e.images)==null?void 0:p[0])==null?void 0:d.url)||"",alt:((k=(f=e.images)==null?void 0:f[0])==null?void 0:k.label)||"",width:"200",height:"250"},m=o(Se,{class:"plp-product-item__image",...l,"aria-label":e.sku});return o(E,{name:"ProductImage",slot:r==null?void 0:r.ProductImage,context:{product:e},children:i?o("a",{href:i(e),children:m}):m})},ie=()=>o(E,{name:"Header",slot:r==null?void 0:r.Header,context:{productList:C},children:o(_e,{floatingLabel:c.sortLabel,options:a,value:K,required:!0,handleSelect:e=>{const{value:s}=e.target;ee(s)},"data-testid":"product-list-sort-by-picker"})}),de=()=>o(E,{name:"Footer",slot:r==null?void 0:r.Footer,context:{productList:C},children:o(fe,{currentPage:u,totalPages:Q,onChange:e=>{b(e)}})}),me=o(We,{header:ie(),footer:de(),productList:C==null?void 0:C.map((e,s)=>o(ze,{image:se(e,s),titleNode:ae(e),price:ce(e),actionButton:oe(e),initialized:e.initialized},e.id||e.sku))});return o("div",{class:"plp-product-list__container",children:B?o(Oe,{alertMessage:v}):me})};export{at as ProductList,at as default};
//# sourceMappingURL=ProductList.js.map
