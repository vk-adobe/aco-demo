/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,Fragment as g,jsxs as N}from"@dropins/tools/preact-jsx-runtime.js";import{classes as w}from"@dropins/tools/lib.js";import{Price as _,Button as T,Icon as R,Image as j}from"@dropins/tools/components.js";import{useState as V}from"@dropins/tools/preact-compat.js";import{s as y,r as K}from"./removeProductsFromWishlist.js";import{events as U}from"@dropins/tools/event-bus.js";import{a as X,S as Y}from"./Trash.js";import{useText as H}from"@dropins/tools/i18n.js";const J=({taxes:r,displayMode:e})=>t(g,{children:r.map((o,c)=>N("div",{"data-testid":`wishlist-product-item-tax-${c}`,className:"wishlist-product-item-tax",children:[t("span",{className:"wishlist-product-item-tax-label",children:o.label}),t(_,{className:"wishlist-product-item-tax-price",amount:o.money.value,currency:o.money.currency}),t("span",{className:"wishlist-product-item-tax-display-mode",children:e==="INCLUDING_FPT_AND_DESCRIPTION"?"incl.":"excl."})]},c))}),Q=({className:r,item:e,onCartActionButtonClick:o,onTrashButtonClick:c,fixedProductTaxesEnabled:P,fixedProductTaxesEnabledDisplayInProductLists:n,routeProdDetailPage:d,...i})=>{var A,C,B,O,S,E,z;const u=H({cartActionBtn:"ProductItem.CartActionButton",trashActionBtn:"ProductItem.TrashActionButton",customizeActionBtn:"ProductItem.CustomizeActionButton"}),v=((B=(C=(A=e.product)==null?void 0:A.prices)==null?void 0:C.discount)==null?void 0:B.amountOff)!==0||((E=(S=(O=e.product)==null?void 0:O.prices)==null?void 0:S.discount)==null?void 0:E.percentOff)!==0,f=()=>{var s;return t("a",{className:"wishlist-product-item-image","data-testid":"wishlist-product-item-image",href:d(e.product),children:t(Z,{images:(s=e.product)!=null&&s.image?[e.product.image]:[]})})},a=()=>{var s,l,h,p,I,m,x,b,F,G;return N(g,{children:[t(_,{className:w(["wishlist-product-item-price",v?"strikeout":""]),"data-testid":"wishlist-product-item-price",amount:(l=(s=e.product)==null?void 0:s.prices)==null?void 0:l.regularPrice.value,currency:(p=(h=e.product)==null?void 0:h.prices)==null?void 0:p.regularPrice.currency}),v&&t(_,{className:"wishlist-product-item-discounted-price","data-testid":"wishlist-product-item-discounted-price",amount:(m=(I=e.product)==null?void 0:I.prices)==null?void 0:m.finalPrice.value,currency:(b=(x=e.product)==null?void 0:x.prices)==null?void 0:b.finalPrice.currency}),P&&(n==="INCLUDING_FPT_AND_DESCRIPTION"||n==="EXCLUDING_FPT_INCLUDING_DESCRIPTION_FINAL_PRICE")&&((G=(F=e.product)==null?void 0:F.prices)==null?void 0:G.fixedProductTaxes)&&t(J,{taxes:e.product.prices.fixedProductTaxes,displayMode:n})]})},k=()=>t(T,{"data-testid":"wishlist-product-item-remove-button",className:"wishlist-product-item-button__remove",variant:"tertiary",onClick:()=>c==null?void 0:c(),icon:t(R,{source:X,size:"24",stroke:"2",viewBox:"0 0 24 24","aria-label":u.trashActionBtn})}),L=()=>M()?W():$(),M=()=>{var s,l,h,p;return((s=e.product)==null?void 0:s.type)==="ConfigurableProduct"?q(e):((l=e.product)==null?void 0:l.type)!=="GiftCardProduct"&&((h=e.product)==null?void 0:h.type)!=="BundleProduct"&&((p=e.product)==null?void 0:p.type)!=="GroupedProduct"},q=s=>{var p,I;const l=((p=s.product.options)==null?void 0:p.filter(m=>m.required))||[];if(l.length===0)return!0;const h=((I=s.selectedOptions)==null?void 0:I.map(m=>m.uid))||[];return l.every(m=>{var x;return(x=m.values)==null?void 0:x.some(b=>h.includes(b.uid))})},W=()=>{var s;return t(T,{"data-testid":"wishlist-product-item-move-to-cart-button",size:"medium",type:"submit",icon:t(R,{source:Y}),disabled:((s=e.product)==null?void 0:s.stockStatus)!=="IN_STOCK","aria-label":u.cartActionBtn,onClick:()=>o==null?void 0:o(),children:u.cartActionBtn})},$=()=>t(T,{"data-testid":"wishlist-product-item-customize-button",size:"medium",type:"submit","aria-label":u.customizeActionBtn,href:d(e.product),children:u.customizeActionBtn});return t("div",{...i,className:w(["wishlist-product-item",r]),children:N("div",{className:"wishlist-product-item__content",children:[f(),N("div",{className:"wishlist-product-item__title","data-testid":"wishlist-product-item-header",children:[t("a",{className:"wishlist-product-item-name","data-testid":"wishlist-product-item-name",href:d(e.product),children:(z=e.product)==null?void 0:z.name}),k(),a()]}),L()]})})},Z=({className:r,children:e,images:o,...c})=>{const[P,n]=V(0);return N(g,{children:[t("div",{...c,className:w(["image-carousel",r]),children:t("div",{className:w(["overflow-hidden relative max-w-[200px]",r]),children:o==null?void 0:o.map((d,i)=>i===P&&t(j,{className:"image-carousel-image",alt:d.alt,src:d.src}))})}),(o==null?void 0:o.length)>1&&t("div",{className:w(["absolute","image-switcher-area"]),children:o==null?void 0:o.map((d,i)=>t("span",{className:w(["image-switcher",P===i?"image-switcher-active":"image-switcher-inactive"]),onClick:u=>{n(i),u.stopPropagation()}},i))})]})},ie=({initialData:r=null,moveProdToCart:e,routeProdDetailPage:o})=>{var n,d,i,u,v;if(!(r!=null&&r.product))return null;const c=async(f=!0)=>{try{return await K([r]),console.log(`Product ${r.product.sku} removed from wishlist!`),f&&U.emit("wishlist/alert",{action:"remove",item:r}),!0}catch(a){return console.error(`Product ${r.product.sku} could not be removed from wishlist`,a),!1}};return t(Q,{item:r,onCartActionButtonClick:async()=>{var f;try{return await e([{sku:r.product.sku,quantity:1,optionsUIDs:(f=r.selectedOptions)==null?void 0:f.map(a=>a.uid),enteredOptions:r.enteredOptions}]),console.log(`Product ${r.product.sku} successfully moved to cart ðŸ›’`),U.emit("wishlist/alert",{action:"move",item:r}),await c(!1)}catch(a){return console.error("Could not move product to cart: ",a),a.toString().includes("You need to choose options for your item.")&&window.location.replace(o(r.product)),!1}},onTrashButtonClick:c,fixedProductTaxesEnabled:((n=y.config)==null?void 0:n.fixedProductTaxesEnabled)??!1,fixedProductTaxesApply:((d=y.config)==null?void 0:d.fixedProductTaxesApply)??!1,fixedProductTaxesEnabledDisplayInProductLists:(i=y.config)==null?void 0:i.fixedProductTaxesEnabledDisplayInProductLists,fixedProductTaxesEnabledDisplayInProductView:(u=y.config)==null?void 0:u.fixedProductTaxesEnabledDisplayInProductView,fixedProductTaxesEnabledDisplayInSalesModules:(v=y.config)==null?void 0:v.fixedProductTaxesEnabledDisplayInSalesModules,routeProdDetailPage:o})};export{ie as W};
