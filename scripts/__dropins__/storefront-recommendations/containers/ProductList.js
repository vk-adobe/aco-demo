/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as E,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{useState as L,useCallback as M,useEffect as N}from"@dropins/tools/preact-hooks.js";import{Skeleton as O,SkeletonRow as U,ProductItemCard as W,Button as $,Price as H,Image as J}from"@dropins/tools/components.js";import{classes as K,VComponent as Q,Slot as h}from"@dropins/tools/lib.js";import{events as V}from"@dropins/tools/event-bus.js";import{c as X}from"../chunks/getRecommendations.js";import{useText as Y}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const Z=({className:d,children:f,heading:a,products:m=null,loading:l=!0,...u})=>t("div",{...u,className:K(["recommendations-product-list",d]),children:l?t(y,{}):E(_,{children:[a&&t(Q,{node:a,className:"recommendations-product-list__heading"}),t("div",{className:"recommendations-product-list__content",children:m})]})}),y=()=>t(O,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((d,f)=>t(U,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},f))}),oe=({initialData:d=null,hideHeading:f,routeProduct:a,currentSku:m,pageType:l,cartSkus:u,userPurchaseHistory:w,userViewHistory:P,slots:n,...F})=>{var T,k;const[z,g]=L(!d),[s,v]=L(((T=d==null?void 0:d.recommendations)==null?void 0:T.results)||[]),x=Y({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),C=M(()=>{if(!l)return!1;switch(l){case"Product":return!!m;case"Cart":return!!(u&&u.length>0);case"Category":case"Checkout":case"CMS":default:return!0}},[l,m,u]);if(N(()=>{const e=V.on("recommendations/data",r=>{var i;(i=r==null?void 0:r.items)!=null&&i.length?v([r]):v([]),g(!1)});return()=>{e==null||e.off()}},[]),N(()=>{if(!C()){g(!1);return}g(!0),X({currentSku:m||"",pageType:l,cartSkus:u,userPurchaseHistory:w,userViewHistory:P}).catch(e=>{console.error("Recommendations error:",e),v([]),g(!1)})},[m,l,u,w,P,C]),!C())return null;const I=(e,r)=>{var o,p,R,b;const i={loading:r<4?"eager":"lazy",src:((p=(o=e.images)==null?void 0:o[0])==null?void 0:p.url)||"",alt:((b=(R=e.images)==null?void 0:R[0])==null?void 0:b.label)||"",width:"300",height:"300",params:{width:300}},c=t(J,{"data-testid":"product-list-item-image",...i,"aria-label":e.sku});return t(h,{name:"Thumbnail",slot:n==null?void 0:n.Thumbnail,context:{item:e,defaultImageProps:i},children:a?t("a",{href:a(e),children:c}):c})},S=t(h,{name:"Heading",slot:n==null?void 0:n.Heading,context:{},children:t("div",{"data-testid":"default-product-list-heading",children:((k=s==null?void 0:s[0])==null?void 0:k.title)||x.heading})}),j=(e,r)=>t(h,{name:"Footer",slot:n==null?void 0:n.Footer,context:{item:e,index:r},children:t("div",{"data-testid":"default-product-list-footer",children:a&&t($,{"data-testid":"default-product-list-footer-button",children:x.viewProductText,"aria-label":x.viewProductText,variant:"primary",href:a(e)})})}),B=e=>t(h,{name:"Title",slot:n==null?void 0:n.Title,context:{item:e,productUrl:a?a(e):""},children:a?t("a",{href:a(e),children:e.name}):t("span",{children:e.name})}),G=e=>t(h,{name:"Sku",slot:n==null?void 0:n.Sku,context:{item:e},children:t("span",{children:e.sku})}),q=e=>{var r,i,c,o;return t(h,{name:"Price",slot:n==null?void 0:n.Price,context:{item:e},children:t("div",{"data-testid":"default-product-price",children:t(H,{amount:(i=(r=e.price.final)==null?void 0:r.amount)==null?void 0:i.value,currency:(o=(c=e.price.final)==null?void 0:c.amount)==null?void 0:o.currency})})})},A=t(_,{children:s==null?void 0:s.map(({items:e,totalProducts:r},i)=>r>0?e.map((c,o)=>{const{sku:p}=c;return t(W,{initialized:!0,sku:G(c),image:I(c,i*e.length+o),titleNode:B(c),price:q(c),actionButton:j(c,i*e.length+o)},p)}):null)});return t(Z,{...F,heading:f?void 0:S,loading:z,products:A})};export{oe as ProductList,oe as default};
//# sourceMappingURL=ProductList.js.map
