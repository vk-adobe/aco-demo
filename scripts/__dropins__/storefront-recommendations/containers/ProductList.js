/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as X,Fragment as w}from"@dropins/tools/preact-jsx-runtime.js";import{useState as O,useRef as $,useCallback as H,useEffect as E}from"@dropins/tools/preact-compat.js";import{ContentGrid as J,Skeleton as K,SkeletonRow as Q,ProductItemCard as Y,Button as Z,Price as D,Image as ee}from"@dropins/tools/components.js";import{classes as te,VComponent as ne,Slot as g}from"@dropins/tools/lib.js";import{events as re}from"@dropins/tools/event-bus.js";import{t as B,s as S,p as I,R as L,a as oe,b as ie,g as ce}from"../chunks/events.js";import{useText as ae}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const de=({className:d,children:s,heading:u,products:c=null,loading:h=!0,...T})=>t("div",{...T,className:te(["recommendations-product-list",d,["recommendations-product-list--empty",!c]]),children:h?t(se,{}):X(w,{children:[u&&t(ne,{node:u,className:"recommendations-product-list__heading"}),t(J,{className:"recommendations-product-list__content","data-testid":"recommendations-product-list__content",maxColumns:0,columnWidth:"minmax(240px, 1fr)",children:c})]})}),se=()=>t(K,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((d,s)=>t(Q,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},s))}),le=d=>{const{recommendationUnit:s,...u}=d,c=B(s,u);S(L,{units:[c]}),I(ie)},me=d=>{const{recommendationUnit:s,...u}=d,c=B(s,u);S(L,{units:[c]}),I(oe)},ve=({recId:d,initialData:s=null,hideHeading:u,routeProduct:c,currentSku:h,cartSkus:T,userPurchaseHistory:P,userViewHistory:N,slots:n,...A})=>{var _,k,y;const[F,x]=O(!s),[r,v]=O((_=s==null?void 0:s.recommendations)!=null&&_.results?s.recommendations.results.filter(e=>e.unitId===d):[]),f=$(null),C=ae({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),b=H(()=>!!d&&!!h,[d,h]);if(E(()=>{const e=re.on("recommendations/data",i=>{var a,o;if(i){const p=(Array.isArray(i)?i:[i]).filter(m=>m.unitId===d);v(p.filter(m=>m.items&&m.items.length>0)),le({recommendationUnit:i,pagePlacement:"product-list",yOffsetTop:((a=f.current)==null?void 0:a.getBoundingClientRect().top)??0,yOffsetBottom:((o=f.current)==null?void 0:o.getBoundingClientRect().bottom)??0,backupProducts:0,searchTime:0})}else v([]);x(!1)});return()=>{e==null||e.off()}},[d]),E(()=>{if(!(r!=null&&r.length)||!f.current)return;const e={root:null,rootMargin:"0px",threshold:.5},i=o=>{o.forEach(l=>{l.intersectionRatio>.5&&r.forEach(p=>{var m,R;me({recommendationUnit:p,pagePlacement:"product-list",yOffsetTop:((m=f.current)==null?void 0:m.getBoundingClientRect().top)??0,yOffsetBottom:((R=f.current)==null?void 0:R.getBoundingClientRect().bottom)??0})})})},a=new IntersectionObserver(i,e);return a.observe(f.current),()=>a.disconnect()},[r]),E(()=>{if(!b()){x(!1);return}x(!0),ce({currentSku:h||"",pageType:"Product",cartSkus:T,userPurchaseHistory:P,userViewHistory:N}).catch(e=>{console.error("Recommendations error:",e),v([]),x(!1)})},[h,T,P,N,b]),!b())return null;const z=(e,i)=>{var l,p,m,R;const a={loading:i<4?"eager":"lazy",src:((p=(l=e.images)==null?void 0:l[0])==null?void 0:p.url)||"",alt:((R=(m=e.images)==null?void 0:m[0])==null?void 0:R.label)||"",width:"300",height:"300",params:{width:300}},o=t(ee,{"data-testid":"product-list-item-image",...a,"aria-label":e.sku});return t(g,{name:"Thumbnail",slot:n==null?void 0:n.Thumbnail,context:{item:e,defaultImageProps:a},children:c?t("a",{href:c(e),children:o}):o})},G=t(g,{name:"Heading",slot:n==null?void 0:n.Heading,context:{},children:t("div",{"data-testid":"default-product-list-heading",children:((k=r==null?void 0:r[0])==null?void 0:k.title)||C.heading})}),M=(e,i)=>t(g,{name:"Footer",slot:n==null?void 0:n.Footer,context:{item:e,index:i},children:t("div",{"data-testid":"default-product-list-footer",children:c&&t(Z,{"data-testid":"default-product-list-footer-button",children:C.viewProductText,"aria-label":C.viewProductText,variant:"primary",href:c(e)})})}),W=e=>t(g,{name:"Title",slot:n==null?void 0:n.Title,context:{item:e,productUrl:c?c(e):""},children:c?t("a",{href:c(e),children:e.name}):t("span",{children:e.name})}),j=e=>t(g,{name:"Sku",slot:n==null?void 0:n.Sku,context:{item:e},children:t("span",{children:e.sku})}),V=e=>{var i,a,o,l;return t(g,{name:"Price",slot:n==null?void 0:n.Price,context:{item:e},children:t("div",{"data-testid":"default-product-price",children:t(D,{amount:(a=(i=e.price.final)==null?void 0:i.amount)==null?void 0:a.value,currency:(l=(o=e.price.final)==null?void 0:o.amount)==null?void 0:l.currency})})})},q=(y=r==null?void 0:r[0])!=null&&y.totalProducts?t(w,{children:r==null?void 0:r.map(({items:e,totalProducts:i},a)=>i>0?e.map((o,l)=>{const{sku:p}=o;return t(Y,{"data-testid":"recommendations-product-item-card",initialized:!0,sku:j(o),image:z(o,a*e.length+l),titleNode:W(o),price:V(o),actionButton:M(o,a*e.length+l)},p)}):null)}):null,U=!r||r.length===0||r.every(e=>!e.items||e.items.length===0);return t("div",{ref:f,children:t(de,{...A,className:U?"recommendations-product-list--empty":"",heading:u?void 0:G,loading:F,products:U?null:q})})};export{ve as ProductList,ve as default};
//# sourceMappingURL=ProductList.js.map
