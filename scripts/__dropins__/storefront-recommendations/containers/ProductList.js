/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as $,Fragment as S}from"@dropins/tools/preact-jsx-runtime.js";import{useState as L,useRef as D,useCallback as H,useEffect as b}from"@dropins/tools/preact-compat.js";import{ContentGrid as J,Skeleton as Q,SkeletonRow as Y,ProductItemCard as Z,Button as tt,Price as et,Image as nt}from"@dropins/tools/components.js";import{classes as ot,VComponent as rt,Slot as R}from"@dropins/tools/lib.js";import{events as it}from"@dropins/tools/event-bus.js";import{t as P,s as k,p as E,R as U,a as ct,b as at,c as dt,g as st}from"../chunks/events.js";import{useText as lt}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const mt=({className:c,children:m,heading:f,products:a=null,loading:h=!0,...C})=>e("div",{...C,className:ot(["recommendations-product-list",c,["recommendations-product-list--empty",!a]]),children:h?e(ut,{}):$(S,{children:[f&&e(rt,{node:f,className:"recommendations-product-list__heading"}),e(J,{className:"recommendations-product-list__content","data-testid":"recommendations-product-list__content",maxColumns:0,columnWidth:"minmax(240px, 1fr)",children:a})]})}),ut=()=>e(Q,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((c,m)=>e(Y,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},m))}),pt=c=>{const{recommendationUnit:m,...f}=c,a=P(m,f);k(U,{units:[a]}),E(dt)},ft=c=>{const{recommendationUnit:m,productId:f,...a}=c,h=P(m,a);k(U,{units:[h]}),E(at,void 0,{unitId:h.unitId,productId:f})},ht=c=>{const{recommendationUnit:m,...f}=c,a=P(m,f);k(U,{units:[a]}),E(ct)},kt=({recId:c,initialData:m=null,hideHeading:f,routeProduct:a,currentSku:h,cartSkus:C,userPurchaseHistory:y,userViewHistory:I,pagePlacement:F,slots:i,...M})=>{var O,N,B;const[z,v]=L(!m),[o,_]=L((O=m==null?void 0:m.recommendations)!=null&&O.results?m.recommendations.results.filter(t=>t.unitId===c):[]),g=D(null),T=lt({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),x=H(()=>!!c&&!!h,[c,h]);if(b(()=>{const t=it.on("recommendations/data",s=>{s&&s.length>0&&_(l=>{const n=l||[],d=s.filter(r=>{var u;return(r==null?void 0:r.unitId)===c&&((u=r==null?void 0:r.items)==null?void 0:u.length)&&!n.some(p=>p.unitId===r.unitId)});return d.forEach(r=>{var u,p;pt({recommendationUnit:r,pagePlacement:"product-list",yOffsetTop:((u=g.current)==null?void 0:u.getBoundingClientRect().top)??0,yOffsetBottom:((p=g.current)==null?void 0:p.getBoundingClientRect().bottom)??0,backupProducts:0,searchTime:0})}),[...n,...d]}),v(!1)});return()=>{t==null||t.off()}},[c]),b(()=>{if(!(o!=null&&o.length)||!g.current)return;const t={root:null,rootMargin:"0px",threshold:.5},s=n=>{n.forEach(d=>{d.intersectionRatio>.5&&o.forEach(r=>{var u,p;ht({recommendationUnit:r,pagePlacement:"product-list",yOffsetTop:((u=g.current)==null?void 0:u.getBoundingClientRect().top)??0,yOffsetBottom:((p=g.current)==null?void 0:p.getBoundingClientRect().bottom)??0})})})},l=new IntersectionObserver(s,t);return l.observe(g.current),()=>l.disconnect()},[o]),b(()=>{if(!x()){v(!1);return}v(!0),st({currentSku:h,pageType:"Product",cartSkus:C,userPurchaseHistory:y,userViewHistory:I,recId:c}).catch(t=>{console.error("Recommendations error:",t),_([]),v(!1)})},[h,C,y,I,x,c]),!x())return c||console.warn("ProductList: recId is missing. Please provide a valid recId to display product recommendations."),h||console.warn("ProductList: currentSku is missing. Please provide a valid currentSku to display product recommendations."),null;const G=(t,s)=>{var d,r,u,p;const l={loading:s<4?"eager":"lazy",src:((r=(d=t.images)==null?void 0:d[0])==null?void 0:r.url)||"",alt:((p=(u=t.images)==null?void 0:u[0])==null?void 0:p.label)||"",width:"300",height:"300",params:{width:300}},n=e(nt,{"data-testid":"product-list-item-image",...l,"aria-label":t.sku});return e(R,{name:"Thumbnail",slot:i==null?void 0:i.Thumbnail,context:{item:t,defaultImageProps:l},children:a?e("a",{href:a(t),children:n}):n})},W=e(R,{name:"Heading",slot:i==null?void 0:i.Heading,context:{},children:e("div",{"data-testid":"default-product-list-heading",children:((N=o==null?void 0:o[0])==null?void 0:N.title)||T.heading})}),j=(t,s)=>e(R,{name:"Footer",slot:i==null?void 0:i.Footer,context:{item:t,index:s},children:e("div",{"data-testid":"default-product-list-footer",children:a&&e("a",{href:a(t),children:e(tt,{"data-testid":"default-product-list-footer-button",children:T.viewProductText,"aria-label":T.viewProductText,variant:"primary"})})})}),A=t=>e(R,{name:"Title",slot:i==null?void 0:i.Title,context:{item:t,productUrl:a?a(t):""},children:a?e("a",{href:a(t),children:t.name}):e("span",{children:t.name})}),V=t=>e(R,{name:"Sku",slot:i==null?void 0:i.Sku,context:{item:t},children:e("span",{children:t.sku})}),q=t=>{var s,l,n,d;return e(R,{name:"Price",slot:i==null?void 0:i.Price,context:{item:t},children:e("div",{"data-testid":"default-product-price",children:e(et,{amount:((l=(s=t.price.final)==null?void 0:s.amount)==null?void 0:l.value)??void 0,currency:((d=(n=t.price.final)==null?void 0:n.amount)==null?void 0:d.currency)??void 0})})})},K=(t,s)=>{var n,d;const l=o==null?void 0:o.find(r=>{var u;return(u=r.items)==null?void 0:u.some(p=>p.sku===t.sku)});l&&ft({recommendationUnit:l,pagePlacement:F||"",yOffsetTop:((n=g.current)==null?void 0:n.getBoundingClientRect().top)??0,yOffsetBottom:((d=g.current)==null?void 0:d.getBoundingClientRect().bottom)??0,productId:s})},X=(B=o==null?void 0:o[0])!=null&&B.totalProducts?e(S,{children:o==null?void 0:o.map(({items:t,totalProducts:s},l)=>s>0?t.map((n,d)=>{const{sku:r}=n;return e("span",{onClick:()=>{K(n,d)},children:e(Z,{"data-testid":"recommendations-product-item-card",initialized:!0,sku:V(n),image:G(n,l*t.length+d),titleNode:A(n),price:q(n),actionButton:j(n,l*t.length+d)},r)},r)}):null)}):null,w=!o||o.length===0||o.every(t=>!t.items||t.items.length===0);return e("div",{ref:g,children:e(mt,{...M,className:w?"recommendations-product-list--empty":"",heading:f?void 0:W,loading:z,products:w?null:X})})};export{kt as ProductList,kt as default};
//# sourceMappingURL=ProductList.js.map
