/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as $,Fragment as S}from"@dropins/tools/preact-jsx-runtime.js";import{useState as L,useRef as D,useCallback as H,useEffect as b}from"@dropins/tools/preact-compat.js";import{ContentGrid as J,Skeleton as Q,SkeletonRow as Y,ProductItemCard as Z,Button as tt,Price as et,Image as nt}from"@dropins/tools/components.js";import{classes as ot,VComponent as rt,Slot as R}from"@dropins/tools/lib.js";import{events as it}from"@dropins/tools/event-bus.js";import{t as P,s as k,p as E,R as U,a as ct,b as at,c as dt,g as st}from"../chunks/events.js";import{useText as lt}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const mt=({className:c,children:m,heading:p,products:a=null,loading:g=!0,...C})=>e("div",{...C,className:ot(["recommendations-product-list",c,["recommendations-product-list--empty",!a]]),children:g?e(ut,{}):$(S,{children:[p&&e(rt,{node:p,className:"recommendations-product-list__heading"}),e(J,{className:"recommendations-product-list__content","data-testid":"recommendations-product-list__content",maxColumns:0,columnWidth:"minmax(240px, 1fr)",children:a})]})}),ut=()=>e(Q,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((c,m)=>e(Y,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},m))}),pt=c=>{const{recommendationUnit:m,...p}=c,a=P(m,p);k(U,{units:[a]}),E(dt)},ft=c=>{const{recommendationUnit:m,...p}=c,a=P(m,p);k(U,{units:[a]}),E(at)},ht=c=>{const{recommendationUnit:m,...p}=c,a=P(m,p);k(U,{units:[a]}),E(ct)},kt=({recId:c,initialData:m=null,hideHeading:p,routeProduct:a,currentSku:g,cartSkus:C,userPurchaseHistory:y,userViewHistory:_,pagePlacement:F,slots:i,...M})=>{var N,B,I;const[z,v]=L(!m),[o,w]=L((N=m==null?void 0:m.recommendations)!=null&&N.results?m.recommendations.results.filter(t=>t.unitId===c):[]),h=D(null),T=lt({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),x=H(()=>!!c&&!!g,[c,g]);if(b(()=>{const t=it.on("recommendations/data",d=>{d&&d.length>0&&w(s=>{const n=s||[],l=d.filter(r=>{var u;return(r==null?void 0:r.unitId)===c&&((u=r==null?void 0:r.items)==null?void 0:u.length)&&!n.some(f=>f.unitId===r.unitId)});return l.forEach(r=>{var u,f;pt({recommendationUnit:r,pagePlacement:"product-list",yOffsetTop:((u=h.current)==null?void 0:u.getBoundingClientRect().top)??0,yOffsetBottom:((f=h.current)==null?void 0:f.getBoundingClientRect().bottom)??0,backupProducts:0,searchTime:0})}),[...n,...l]}),v(!1)});return()=>{t==null||t.off()}},[c]),b(()=>{if(!(o!=null&&o.length)||!h.current)return;const t={root:null,rootMargin:"0px",threshold:.5},d=n=>{n.forEach(l=>{l.intersectionRatio>.5&&o.forEach(r=>{var u,f;ht({recommendationUnit:r,pagePlacement:"product-list",yOffsetTop:((u=h.current)==null?void 0:u.getBoundingClientRect().top)??0,yOffsetBottom:((f=h.current)==null?void 0:f.getBoundingClientRect().bottom)??0})})})},s=new IntersectionObserver(d,t);return s.observe(h.current),()=>s.disconnect()},[o]),b(()=>{if(!x()){v(!1);return}v(!0),st({currentSku:g,pageType:"Product",cartSkus:C,userPurchaseHistory:y,userViewHistory:_,recId:c}).catch(t=>{console.error("Recommendations error:",t),w([]),v(!1)})},[g,C,y,_,x,c]),!x())return c||console.warn("ProductList: recId is missing. Please provide a valid recId to display product recommendations."),g||console.warn("ProductList: currentSku is missing. Please provide a valid currentSku to display product recommendations."),null;const G=(t,d)=>{var l,r,u,f;const s={loading:d<4?"eager":"lazy",src:((r=(l=t.images)==null?void 0:l[0])==null?void 0:r.url)||"",alt:((f=(u=t.images)==null?void 0:u[0])==null?void 0:f.label)||"",width:"300",height:"300",params:{width:300}},n=e(nt,{"data-testid":"product-list-item-image",...s,"aria-label":t.sku});return e(R,{name:"Thumbnail",slot:i==null?void 0:i.Thumbnail,context:{item:t,defaultImageProps:s},children:a?e("a",{href:a(t),children:n}):n})},W=e(R,{name:"Heading",slot:i==null?void 0:i.Heading,context:{},children:e("div",{"data-testid":"default-product-list-heading",children:((B=o==null?void 0:o[0])==null?void 0:B.title)||T.heading})}),j=(t,d)=>e(R,{name:"Footer",slot:i==null?void 0:i.Footer,context:{item:t,index:d},children:e("div",{"data-testid":"default-product-list-footer",children:a&&e("a",{href:a(t),children:e(tt,{"data-testid":"default-product-list-footer-button",children:T.viewProductText,"aria-label":T.viewProductText,variant:"primary"})})})}),A=t=>e(R,{name:"Title",slot:i==null?void 0:i.Title,context:{item:t,productUrl:a?a(t):""},children:a?e("a",{href:a(t),children:t.name}):e("span",{children:t.name})}),V=t=>e(R,{name:"Sku",slot:i==null?void 0:i.Sku,context:{item:t},children:e("span",{children:t.sku})}),q=t=>{var d,s,n,l;return e(R,{name:"Price",slot:i==null?void 0:i.Price,context:{item:t},children:e("div",{"data-testid":"default-product-price",children:e(et,{amount:((s=(d=t.price.final)==null?void 0:d.amount)==null?void 0:s.value)??void 0,currency:((l=(n=t.price.final)==null?void 0:n.amount)==null?void 0:l.currency)??void 0})})})},K=t=>{var s,n;const d=o==null?void 0:o.find(l=>{var r;return(r=l.items)==null?void 0:r.some(u=>u.sku===t.sku)});d&&ft({recommendationUnit:d,pagePlacement:F||"",yOffsetTop:((s=h.current)==null?void 0:s.getBoundingClientRect().top)??0,yOffsetBottom:((n=h.current)==null?void 0:n.getBoundingClientRect().bottom)??0})},X=(I=o==null?void 0:o[0])!=null&&I.totalProducts?e(S,{children:o==null?void 0:o.map(({items:t,totalProducts:d},s)=>d>0?t.map((n,l)=>{const{sku:r}=n;return e("span",{onClick:()=>{K(n)},children:e(Z,{"data-testid":"recommendations-product-item-card",initialized:!0,sku:V(n),image:G(n,s*t.length+l),titleNode:A(n),price:q(n),actionButton:j(n,s*t.length+l)},r)},r)}):null)}):null,O=!o||o.length===0||o.every(t=>!t.items||t.items.length===0);return e("div",{ref:h,children:e(mt,{...M,className:O?"recommendations-product-list--empty":"",heading:p?void 0:W,loading:z,products:O?null:X})})};export{kt as ProductList,kt as default};
//# sourceMappingURL=ProductList.js.map
