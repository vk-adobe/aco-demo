/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as S,jsx as n,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import{h as Q,a as X}from"../chunks/errors.js";import{classes as H,VComponent as Y,Slot as ee}from"@dropins/tools/lib.js";import{s as te,t as ne}from"../chunks/setShippingMethods.js";import{events as E}from"@dropins/tools/event-bus.js";import{n as re,g as A}from"../chunks/values.js";import{W as oe,h as T,g as ie}from"../chunks/ConditionalWrapper.js";/* empty css                       */import{Skeleton as se,SkeletonRow as _,IllustratedMessage as ae,Icon as ce,ProgressSpinner as ue,RadioButton as pe,Price as O,ToggleButton as de}from"@dropins/tools/components.js";import*as u from"@dropins/tools/preact-compat.js";import{useText as Z}from"@dropins/tools/i18n.js";import{useState as P,useCallback as C,useEffect as U,useMemo as le}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/synchronizeCheckout.js";import"../fragments.js";const he=o=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.47266 4.90002H15.1851V10.9645H21.2495L23 12.715V17.6124H20.073",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M15.1758 5.87573H19.0019L21.0394 10.7636",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76151 16.7898C9.76151 18.0525 8.72845 19.076 7.46582 19.076C6.20318 19.076 5.17969 18.0429 5.17969 16.7803C5.17969 15.5176 6.20318 14.4941 7.46582 14.4941C8.72845 14.4941 9.75195 15.5176 9.76151 16.7803C9.76151 16.7803 9.76151 16.7803 9.76151 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8726 16.7898C19.8726 18.062 18.8491 19.0855 17.5769 19.0855C16.3047 19.0855 15.2812 18.062 15.2812 16.7898C15.2812 15.5176 16.3047 14.4941 17.5769 14.4941C18.8491 14.4941 19.8726 15.5176 19.8726 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.08792 7.63574H1.69824",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M7.11229 10.3619H1",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.16084 13.0402H1.92773",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76172 16.7611H15.2809",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.38672 16.7611H5.17025",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),me=()=>S(se,{"data-testid":"shipping-methods-skeleton",children:[n(_,{size:"small",variant:"heading"}),n(_,{size:"small",variant:"empty"}),n(_,{fullWidth:!0,size:"medium"}),n(_,{fullWidth:!0,size:"medium"})]}),ge=({className:o,isLoading:i=!1,onSelectionChange:d=()=>{},options:l,selection:s,title:M,UIComponentType:c="RadioButton",...y})=>{const W=Z({EmptyState:"Checkout.ShippingMethods.emptyState"}),j=(r,B)=>{const L={busy:i,key:r.value,className:"checkout-shipping-methods__method",name:"shipping-method",value:r.value,onChange:()=>d(r)};return B==="RadioButton"?n(pe,{...L,checked:(s==null?void 0:s.value)===r.value,"data-testid":"shipping-method-radioButton",description:r.title,id:r.value,label:S(b,{children:[n(O,{amount:r.amount.value,currency:r.amount.currency}),"Â ",n("span",{children:r.carrier.title})]})}):n(de,{...L,"data-testid":"shipping-method-toggleButton",label:S(b,{children:[n("span",{children:r.carrier.title}),n(O,{amount:r.amount.value,currency:r.amount.currency})]}),selected:(s==null?void 0:s.value)===r.value})};return S("div",{...y,className:H(["checkout-shipping-methods",o]),"data-testid":"checkout-shipping-methods",children:[M&&n(Y,{className:"checkout-shipping-methods__title",node:M}),!i&&l.length===0&&n(ae,{"data-testid":"checkout-shipping-methods-empty",icon:n(ce,{source:he}),message:n("p",{children:W.EmptyState})}),S("div",{className:H(["checkout-shipping-methods__content"]),children:[i&&n(ue,{className:"checkout-shipping-methods__spinner"}),n("div",{className:H(["checkout-shipping-methods__options",["checkout-shipping-methods__options--loading",i],["checkout-shipping-methods__options--toggleButton",c==="ToggleButton"]]),children:l.map(r=>j(r,c))})]})]})},fe=oe(ge,me);function ke(o,i){return o?i.some(d=>d.code===o.code):!1}function D(o,i){return!o||!i||o.amount.value!==i.amount.value?!1:o.code===i.code&&o.carrier.code===i.carrier.code}function ve(o){const i=E.lastPayload("shipping/estimate");i&&E.emit("shipping/estimate",{...i,shippingMethod:ne(o)})}const Ue=({displayTitle:o=!0,initialData:i,onSelectionChange:d,onSelectionError:l,slots:s,UIComponentType:M="RadioButton",active:c=!0,autoSync:y=!0,...W})=>{const[j,r]=P(!1),[B,L]=P(null),[x,w]=P(),q=Q.value,F=X.value,$=q||F,z=Z({Title:"Checkout.ShippingMethods.title"}),a=C(e=>{L(t=>D(t,e)?t:(re({selectedShippingMethod:e}),e))},[]),f=C(async(e,t)=>{if(!y||!T())return;const p={method_code:e.code,carrier_code:e.carrier.code};try{await te([p])}catch(h){a(t??null),l==null||l(h,e)}},[y,l,a]),G=C(async e=>{const t=A("selectedShippingMethod");a(e),d==null||d(e),T()||ve(e),await f(e,t)},[d,a,f]),k=C(e=>{var R;const t=!e||e.isEmpty,p=!!(e!=null&&e.isVirtual);if(t||p){r(p),a(null),w([]);return}const h=(R=e.shippingAddresses)==null?void 0:R[0];if(!h)return;const m=h.availableShippingMethods??[];if(w(m),m.length===0){a(null);return}const v=h.selectedShippingMethod??null,g=A("selectedShippingMethod"),V=ke(g,m),K=D(g,v);if(g&&V&&!K){f(g,v);return}if((!g||!V)&&v){a(v);return}if((!g||!V)&&!v){const I=m[0];a(I),f(I)}},[f,a]),N=C(e=>{if(e===void 0)return;const{shippingMethod:t,availableShippingMethods:p}=e,h=(p==null?void 0:p.find(m=>m.code===(t==null?void 0:t.methodCode)&&m.carrier.code===(t==null?void 0:t.carrierCode)))??null;w(p),a(h)},[a]);U(()=>{if(!c)return;const e=ie();if(e){k(e);return}const t=E.on("checkout/initialized",k,{eager:!0});return()=>{t==null||t.off()}},[c,k]),U(()=>{if(!c)return;const e=E.on("checkout/updated",k,{eager:!1});return()=>{e==null||e.off()}},[c,k]),U(()=>{if(!c||T())return;const e=E.on("shipping/estimate",N,{eager:!0});return()=>{e==null||e.off()}},[c,N]);const J=le(()=>{if(o)return n(ee,{name:"checkout-shipping-methods-title",slot:s==null?void 0:s.Title,children:n("h3",{children:z.Title})})},[o,s==null?void 0:s.Title,z.Title]);return n(fe,{...W,UIComponentType:M,initialized:x!==void 0,isLoading:$,options:x??[],selection:B,title:J,visible:c&&!j,onSelectionChange:G})};export{Ue as ShippingMethods,Ue as default,ve as emitShippingEstimateEvent};
