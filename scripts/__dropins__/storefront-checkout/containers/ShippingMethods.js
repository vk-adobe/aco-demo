/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as E,jsx as i,Fragment as P}from"@dropins/tools/preact-jsx-runtime.js";import"../chunks/subscription-email-statuses.js";import{classes as j,VComponent as J,Slot as K}from"@dropins/tools/lib.js";import{s as N,h as Q,a as X}from"../chunks/IsBillToShippingSignal.js";import{events as T}from"@dropins/tools/event-bus.js";import{t as Y,s as ee}from"../chunks/setShippingMethods.js";import{W as te}from"../chunks/ConditionalWrapper.js";/* empty css                       */import{Skeleton as ne,SkeletonRow as b,IllustratedMessage as re,Icon as ie,ProgressSpinner as oe,RadioButton as se,Price as R,ToggleButton as ae}from"@dropins/tools/components.js";import*as s from"@dropins/tools/preact-compat.js";import{useText as D}from"@dropins/tools/i18n.js";import{s as o}from"../chunks/SelectedShippingMethodSignal.js";import{useState as x,useRef as z,useCallback as B,useEffect as O,useMemo as ce}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/synchronizeCheckout.js";import"../fragments.js";const ue=n=>s.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.47266 4.90002H15.1851V10.9645H21.2495L23 12.715V17.6124H20.073",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M15.1758 5.87573H19.0019L21.0394 10.7636",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76151 16.7898C9.76151 18.0525 8.72845 19.076 7.46582 19.076C6.20318 19.076 5.17969 18.0429 5.17969 16.7803C5.17969 15.5176 6.20318 14.4941 7.46582 14.4941C8.72845 14.4941 9.75195 15.5176 9.76151 16.7803C9.76151 16.7803 9.76151 16.7803 9.76151 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8726 16.7898C19.8726 18.062 18.8491 19.0855 17.5769 19.0855C16.3047 19.0855 15.2812 18.062 15.2812 16.7898C15.2812 15.5176 16.3047 14.4941 17.5769 14.4941C18.8491 14.4941 19.8726 15.5176 19.8726 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.08792 7.63574H1.69824",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M7.11229 10.3619H1",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.16084 13.0402H1.92773",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76172 16.7611H15.2809",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.38672 16.7611H5.17025",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),le=()=>E(ne,{"data-testid":"shipping-methods-skeleton",children:[i(b,{size:"small",variant:"heading"}),i(b,{size:"small",variant:"empty"}),i(b,{fullWidth:!0,size:"medium"}),i(b,{fullWidth:!0,size:"medium"})]}),pe=({className:n,isLoading:r=!1,onSelectionChange:m=()=>{},options:a,selection:l,title:S,UIComponentType:C="RadioButton",..._})=>{const M=D({EmptyState:"Checkout.ShippingMethods.emptyState"}),g=(t,d)=>{const L={busy:r,key:t.value,className:"checkout-shipping-methods__method",name:"shipping-method",value:t.value,onChange:()=>m(t)};return d==="RadioButton"?i(se,{...L,checked:(l==null?void 0:l.value)===t.value,"data-testid":"shipping-method-radioButton",description:t.title,id:t.value,label:E(P,{children:[i(R,{amount:t.amount.value,currency:t.amount.currency}),"Â ",i("span",{children:t.carrier.title})]})}):i(ae,{...L,"data-testid":"shipping-method-toggleButton",label:E(P,{children:[i("span",{children:t.carrier.title}),i(R,{amount:t.amount.value,currency:t.amount.currency})]}),selected:(l==null?void 0:l.value)===t.value})};return E("div",{..._,className:j(["checkout-shipping-methods",n]),"data-testid":"checkout-shipping-methods",children:[S&&i(J,{className:"checkout-shipping-methods__title",node:S}),!r&&a.length===0&&i(re,{"data-testid":"checkout-shipping-methods-empty",icon:i(ie,{source:ue}),message:i("p",{children:M.EmptyState})}),E("div",{className:j(["checkout-shipping-methods__content"]),children:[r&&i(oe,{className:"checkout-shipping-methods__spinner"}),i("div",{className:j(["checkout-shipping-methods__options",["checkout-shipping-methods__options--loading",r],["checkout-shipping-methods__options--toggleButton",C==="ToggleButton"]]),children:a.map(t=>g(t,C))})]})]})},de=te(pe,le);function H(n){const r=N.peek();if(!(r!=null&&r.address))return;const m={address:r.address,shippingMethod:n?Y(n):null};T.emit("shipping/estimate",m)}function I(n,r){return n?r.some(m=>m.code===n.code):!1}function he(n,r){return!n||!r?!1:n.code===r.code&&n.carrier.code===r.carrier.code}function me(n){return n?n.isEmpty||n.isVirtual:!0}const He=({displayTitle:n=!0,onShippingMethodSelect:r,initialData:m,slots:a,UIComponentType:l="RadioButton",...S})=>{const[C,_]=x(!0),[M,g]=x(),t=z(!1),d=z(!1),L=o.value,U=Q.value,Z=X.value,q=U||Z,V=D({Title:"Checkout.ShippingMethods.title"}),k=B(e=>{if(!d.current)return;const c={method_code:e.code,carrier_code:e.carrier.code};ee([c]).catch(console.error)},[]),F=e=>{o.value=e,r==null||r(e),k(e),d.current||H(e)},y=B(e=>{var A;const c=me(e)===!1;if(_(c),!c){d.current=!1,t.current=!1,o.value=void 0,g(void 0);return}const f=(A=e.shippingAddresses)==null?void 0:A[0];if(d.current=!!f,!f)return;const h=f.availableShippingMethods??[];if(g(h),h.length===0){o.value=void 0,t.current=!0;return}const p=f.selectedShippingMethod;if(!t.current&&p){o.value=p,t.current=!0;return}if(!t.current&&!p){const v=h[0];o.value=v,k(v),t.current=!0;return}const u=o.peek(),W=I(u,h),G=he(u,p);if(u&&W&&!G){k(u);return}if((!u||!W)&&p){o.value=p;return}if((!u||!W)&&!p){const v=h[0];o.value=v,k(v)}},[k]),w=B(e=>{if(e===void 0)return;const c=e.options??[];g(c);const f=c.length>0,h=o.peek();if(!f){o.value=void 0,H(null);return}if(I(h,c))return;const u=c[0];o.value=u,H(u)},[]);O(()=>{const e=T.on("checkout/initialized",y,{eager:!0});return()=>{e==null||e.off()}},[y]),O(()=>{const e=T.on("checkout/updated",y,{eager:!1});return()=>{e==null||e.off()}},[y]),O(()=>{if(d.current)return;const e=N.subscribe(w);return()=>{e()}},[w]);const $=ce(()=>{if(n)return i(K,{name:"checkout-shipping-methods-title",slot:a==null?void 0:a.Title,children:i("h3",{children:V.Title})})},[n,a==null?void 0:a.Title,V.Title]);return i(de,{...S,UIComponentType:l,isInitialized:M!==void 0,isLoading:q,isVisible:C,options:M??[],selection:L,title:$,onSelectionChange:F})};export{He as ShippingMethods,He as default};
