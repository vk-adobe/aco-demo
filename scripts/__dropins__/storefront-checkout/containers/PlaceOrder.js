/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as I,jsx as r}from"@dropins/tools/preact-jsx-runtime.js";import{s as T}from"../chunks/subscription-email-statuses.js";import{classes as U,Slot as w}from"@dropins/tools/lib.js";import{h as N,U as R}from"../chunks/IsBillToShippingSignal.js";import{events as l}from"@dropins/tools/event-bus.js";import{W as j}from"../chunks/ConditionalWrapper.js";/* empty css                  */import{Skeleton as M,SkeletonRow as S,Button as W}from"@dropins/tools/components.js";import{s as _,i as B}from"../chunks/SelectedPaymentMethodSignal.js";import"../chunks/SelectedShippingMethodSignal.js";import{s as H}from"../chunks/ServerErrorSignal.js";import{useState as m,useRef as Q,useCallback as u,useEffect as d}from"@dropins/tools/preact-hooks.js";import{useText as V,Text as $}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";const q=()=>I(M,{"data-testid":"place-order-skeleton",children:[r(S,{size:"small",variant:"empty"}),r(S,{size:"small"})]}),A=({children:c,className:s,disabled:i=!1,onClick:o})=>r("div",{className:U(["checkout-place-order",s]),children:r(W,{className:"checkout-place-order__button","data-testid":"place-order-button",disabled:i,size:"medium",type:"submit",variant:"primary",onClick:o,children:c},"placeOrder")}),D=j(A,q),ce=({disabled:c=!1,handleValidation:s,handlePlaceOrder:i,slots:o,...O})=>{const[x,y]=m(!0),[C,g]=m(!1),[v,f]=m(!1),p=Q(""),a=_.value,E=N.value,h=V({CheckoutUnexpectedError:"Checkout.ServerError.unexpected"}),k=u(e=>{H.value=e instanceof TypeError||e instanceof R?h.CheckoutUnexpectedError:e.message},[h]),P=u(async()=>{try{if(s&&!s())return;await i({cartId:T.cartId,code:a??"",isSubscribedToNewsletter:B.peek(),email:p.current})}catch(e){k(e)}},[s,i,k,a]),n=u(e=>{const t=!!e&&!e.isEmpty;y(t),p.current=(e==null?void 0:e.email)??"",!t&&f(!1)},[]);return d(()=>{const e=l.on("cart/initialized",t=>{const z=(t==null?void 0:t.items)||[];f(z.some(b=>b.outOfStock||b.insufficientQuantity))},{eager:!0});return()=>{e==null||e.off()}},[]),d(()=>{const e=l.on("checkout/initialized",t=>{g(!0),n(t)},{eager:!0});return()=>{e==null||e.off()}},[n]),d(()=>{const e=l.on("checkout/updated",n,{eager:!1});return()=>{e==null||e.off()}},[n]),r(D,{...O,disabled:c||v||E,isInitialized:C,isVisible:x,onClick:P,children:r(w,{context:{code:a??""},name:"Content",slot:o==null?void 0:o.Content,children:r($,{id:"Checkout.PlaceOrder.button"})})})};export{ce as PlaceOrder,ce as default};
