/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as E,jsx as n}from"@dropins/tools/preact-jsx-runtime.js";import{s as J}from"../chunks/subscription-email-statuses.js";import{classes as I,VComponent as K,Slot as z}from"@dropins/tools/lib.js";import{h as Q}from"../chunks/IsBillToShippingSignal.js";import{events as L}from"@dropins/tools/event-bus.js";import{s as X}from"../chunks/setPaymentMethod.js";import{W as Y}from"../chunks/ConditionalWrapper.js";/* empty css                      */import{Skeleton as ee,SkeletonRow as P,IllustratedMessage as te,Icon as B,ProgressSpinner as ne,ToggleButton as re,RadioButton as oe}from"@dropins/tools/components.js";import*as M from"@dropins/tools/preact-compat.js";import{useText as R}from"@dropins/tools/i18n.js";import{s as a}from"../chunks/SelectedPaymentMethodSignal.js";import"../chunks/SelectedShippingMethodSignal.js";import"../chunks/ServerErrorSignal.js";import{useState as b,useRef as N,useCallback as A,useEffect as V,useMemo as ae}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/synchronizeCheckout.js";const ie=r=>M.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},M.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),M.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),M.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),ce=()=>E(ee,{"data-testid":"payment-methods-skeleton",children:[n(P,{size:"medium",variant:"heading"}),n(P,{size:"medium",variant:"empty"}),n(P,{fullWidth:!0,size:"xlarge"}),n(P,{fullWidth:!0,size:"xlarge"})]}),se=({code:r,icon:i,isLoading:t,onChange:m,selected:c,title:u,UIComponentType:h="ToggleButton"})=>{const p={busy:t,className:"checkout-payment-methods__method",label:u,name:"payment-method",value:r,onChange:()=>m(r)};return h==="ToggleButton"?n(re,{...p,icon:i?n(B,{source:i}):void 0,selected:c}):n(oe,{...p,checked:c,icon:i??void 0})},de=({className:r,title:i,isLoading:t=!1,onChange:m=()=>{},options:c,paymentMethodContent:u,UIComponentType:h,selection:p})=>{const T=R({EmptyState:"Checkout.PaymentMethods.emptyState"});return E("div",{className:I(["checkout-payment-methods",r]),"data-testid":"checkout-payment-methods",children:[i&&n(K,{className:"checkout-payment-methods__title",node:i}),!t&&c.length===0&&n(te,{"data-testid":"checkout-payment-methods-empty",icon:n(B,{source:ie}),message:n("p",{children:T.EmptyState})}),E("div",{className:I(["checkout-payment-methods__wrapper",["checkout-payment-methods__wrapper--loading",t]]),children:[t&&n(ne,{className:"checkout-payment-methods__spinner"}),n("div",{className:I(["checkout-payment-methods__methods",["checkout-payment-methods--full-width",c.length%2!==0]]),children:c==null?void 0:c.map(d=>n(se,{UIComponentType:h,code:d.code,icon:d.icon,selected:d.code===p,title:d.displayLabel??!0?d.title:"",onChange:m},d.code))}),u&&n("div",{className:"checkout-payment-methods__content",children:u})]})]})},le=Y(de,ce);function me(r){return(r.shippingAddresses??[]).length>0}function ue(r,i){return r?i.some(t=>t.code===r):!1}const He=({displayTitle:r=!0,UIComponentType:i="ToggleButton",slots:t,setOnChange:m={}})=>{var x,W,U;const[c,u]=b(!0),[h,p]=b(!1),[T,d]=b([]),[H]=b(m),f=N(!1),S=N(!1),s=t==null?void 0:t.Methods,D=a.value,Z=Q.value,$=T.filter(e=>{var o;return((o=s==null?void 0:s[e.code])==null?void 0:o.enabled)!==!1}).map(e=>{const o=(s==null?void 0:s[e.code])||{};return{...e,...o}}),O=R({Title:"Checkout.PaymentMethods.title"}),g=A(e=>{var o;S.current&&(H[e]===!1||((o=s==null?void 0:s[e])==null?void 0:o.setOnChange)===!1||X({code:e}).catch(console.error))},[s,H]),q=e=>{a.value=e,g(e)},C=A(e=>{var j;const o=!!e&&!e.isEmpty;if(u(o),!o){S.current=!1,f.current=!1,a.value=void 0,d([]);return}S.current=e.isVirtual||me(e);const y=e.availablePaymentMethods??[];if(d(y),y.length===0){f.current=!0,a.value=void 0;return}const l=(j=e.selectedPaymentMethod)==null?void 0:j.code;if(!f.current&&l){a.value=l,f.current=!0;return}if(!f.current&&!l){const k=y[0].code;a.value=k,f.current=!0,g(k);return}const v=a.peek(),_=ue(v,y);if(v&&_&&l!==v){g(v);return}if((!v||!_)&&l){a.value=l;return}if((!v||!_)&&!l){const k=y[0].code;a.value=k,g(k)}},[g]);V(()=>{const e=L.on("checkout/initialized",o=>{p(!0),C(o)},{eager:!0});return()=>{e==null||e.off()}},[C]),V(()=>{const e=L.on("checkout/updated",C,{eager:!1});return()=>{e==null||e.off()}},[C]),V(()=>{t!=null&&t.Handlers&&console.warn("The `slots.Handlers` prop is deprecated and will be removed in future versions. Use the `Methods` object instead."),m&&console.warn("The `setOnChange` prop is deprecated and will be removed in future versions. Use the `Methods` object instead.")},[]);const w=a.value?((W=(x=t==null?void 0:t.Methods)==null?void 0:x[a.value])==null?void 0:W.render)||((U=t==null?void 0:t.Handlers)==null?void 0:U[a.value]):null,F=w?n(z,{context:{cartId:J.cartId??"",replaceHTML(e){this.replaceWith(e)}},name:"PaymentMethodContent",slot:w},w):void 0,G=ae(()=>{if(r)return n(z,{name:"checkout-payment-methods-title",slot:t==null?void 0:t.Title,children:n("h2",{children:O.Title})})},[r,t==null?void 0:t.Title,O.Title]);return n(le,{UIComponentType:i,isInitialized:h,isLoading:h&&Z,isVisible:c,options:$,paymentMethodContent:F,selection:D,title:G,onChange:q})};export{He as PaymentMethods,He as default};
