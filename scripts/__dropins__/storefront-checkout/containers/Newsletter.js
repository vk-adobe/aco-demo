/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as l}from"@dropins/tools/preact-jsx-runtime.js";import{W as S}from"../chunks/ConditionalWrapper.js";/* empty css                  */import{Skeleton as g,SkeletonRow as V,Checkbox as z}from"@dropins/tools/components.js";import{c as I}from"../chunks/classes.js";import{useText as _}from"@dropins/tools/i18n.js";import{s as C}from"../chunks/subscription-email-statuses.js";import"@dropins/tools/lib.js";import"../chunks/IsBillToShippingSignal.js";import{events as f}from"@dropins/tools/event-bus.js";import{i as r}from"../chunks/SelectedPaymentMethodSignal.js";import"../chunks/SelectedShippingMethodSignal.js";import"../chunks/ServerErrorSignal.js";import{useState as m,useCallback as E,useEffect as n}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";const T=()=>l(g,{className:"checkout-newsletter-skeleton","data-testid":"checkout-newsletter-skeleton",children:l(V,{size:"small",variant:"row"})}),y=({className:c,checked:i,onChange:o})=>{const u=_({title:"Checkout.Newsletter.title"});return l("div",{className:"checkout-newsletter","data-testid":"checkout-newsletter",children:l(z,{checked:i,className:I(["checkout-newsletter__checkbox",c]),"data-testid":"checkout-newsletter-checkbox",label:u.title,name:"checkout-newsletter__checkbox",onChange:o})})},W=S(y,T),Y=({defaultChecked:c=!1,onChange:i,showForAuthenticatedUsers:o=!1})=>{var p;const[u,b]=m(!0),[h,w]=m(!1),[N,v]=m(!1),d=r.value,s=((p=C.config)==null?void 0:p.newsletterEnabled)===!1,k=!o&&h,x=async e=>{const t=e.target.checked;r.value=t,i==null||i(t)},a=E(e=>{const t=!!e&&!e.isEmpty;if(b(t),!t){r.value=!1;return}},[]);return n(()=>{if(s)return;const e=f.on("authenticated",t=>{w(t),t&&!o&&(r.value=!1)},{eager:!0});return()=>{e==null||e.off()}},[s,o]),n(()=>{if(s)return;const e=f.on("checkout/initialized",t=>{v(!0),a(t)},{eager:!0});return()=>{e==null||e.off()}},[s,a]),n(()=>{if(s)return;const e=f.on("checkout/updated",a,{eager:!1});return()=>{e==null||e.off()}},[s,a]),n(()=>{c&&!d&&(r.value=c)},[]),(s||k)&&(r.value=!1),l(W,{checked:d,isInitialized:N,isVisible:u&&!s&&!k,onChange:x})};export{Y as Newsletter,Y as default};
