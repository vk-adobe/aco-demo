/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a}from"@dropins/tools/preact-jsx-runtime.js";import{h as C}from"../chunks/errors.js";import"@dropins/tools/lib.js";import{events as f}from"@dropins/tools/event-bus.js";import{n as _}from"../chunks/values.js";import{W as z,h as I,g as V}from"../chunks/ConditionalWrapper.js";import{s as N}from"../chunks/setBillingAddress.js";/* empty css                             */import{Skeleton as U,SkeletonRow as w,Checkbox as y}from"@dropins/tools/components.js";import{c as D}from"../chunks/classes.js";import{useText as P}from"@dropins/tools/i18n.js";import{useState as h,useRef as R,useCallback as u,useEffect as g}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/synchronizeCheckout.js";const W=()=>a(U,{className:"bill-to-shipping-address__skeleton","data-testid":"bill-to-shipping-skeleton",children:a(w,{size:"small",variant:"row"})}),j=({className:i,checked:t,disabled:l,onChange:n})=>{const r=P({title:"Checkout.BillToShippingAddress.title"});return a("div",{className:"checkout-bill-to-shipping-address",children:a(y,{checked:t,className:D(["checkout-bill-to-shipping-address__checkbox",i]),"data-testid":"bill-to-shipping-checkbox",disabled:l,label:r.title,name:"checkout-bill-to-shipping-address__checkbox",onChange:n})})},L=z(j,W);function $(i){var r;const t=(r=i.shippingAddresses)==null?void 0:r[0],l=!!i.billingAddress;return(t==null?void 0:t.sameAsBilling)??!l}const es=({active:i=!0,autoSync:t=!0,onChange:l,onError:n})=>{const[r,m]=h(!1),[k,b]=h(!1),[B,A]=h(!0),d=R(!1),S=C.value,c=u(s=>{A(e=>e===s?e:(l==null||l(s),s)),_({isBillToShipping:s})},[l]),T=u(s=>{const o=s.target.checked;c(o),!(!t||!o||!I())&&N({sameAsShipping:!0}).catch(x=>{c(!1),n==null||n(x)})},[t,n,c]),p=u(s=>{const e=!s||(s==null?void 0:s.isEmpty),o=!!(s!=null&&s.isVirtual);if(e||o){b(o),c(!1),d.current=!1;return}d.current||(c($(s)),d.current=!0)},[c]);return g(()=>{if(!i)return;const s=V();if(s){m(!0),p(s);return}const e=f.on("checkout/initialized",o=>{m(!0),p(o)},{eager:!0});return()=>{e==null||e.off()}},[i,p]),g(()=>{if(!i)return;const s=f.on("checkout/updated",p,{eager:!1});return()=>{s==null||s.off()}},[i,p]),a(L,{checked:B,disabled:S,initialized:r,visible:i&&!k,onChange:T})};export{es as BillToShippingAddress,es as default};
