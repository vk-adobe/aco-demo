/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as V}from"@dropins/tools/preact-jsx-runtime.js";/* empty css                             */import{Skeleton as N,SkeletonRow as E,Checkbox as w}from"@dropins/tools/components.js";import{p as y}from"../chunks/TermsAndConditions.js";import{classes as k,VComponent as D,Slot as W}from"@dropins/tools/lib.js";/* empty css                  *//* empty css                      *//* empty css                  *//* empty css                       */import{W as j}from"../chunks/ConditionalWrapper.js";import{A as H}from"../chunks/checkout.js";import{s as P}from"../chunks/subscription-email-statuses.js";import"../chunks/IsBillToShippingSignal.js";import{events as g}from"@dropins/tools/event-bus.js";import{useState as m,useCallback as R,useEffect as _}from"@dropins/tools/preact-hooks.js";import{useText as $,MarkupText as q}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";const L=({html:n})=>{const o=y.sanitize(n,{ADD_ATTR:["target"]});return o===""?null:t("span",{dangerouslySetInnerHTML:{__html:o}})},O=()=>t(N,{className:"checkout-terms-and-conditions-skeleton","data-testid":"checkout-terms-and-conditions-skeleton",children:t(E,{fullWidth:!0,size:"small",variant:"row"})}),B=({className:n,agreements:o,error:s,...a})=>t("div",{className:"checkout-terms-and-conditions","data-testid":"checkout-terms-and-conditions",children:V("form",{...a,noValidate:!0,className:k(["checkout-terms-and-conditions__form",n]),"data-testid":"checkout-terms-and-conditions-form",name:"checkout-terms-and-conditions__form",children:[o&&t(D,{className:k(["checkout-terms-and-conditions__agreements"]),"data-testid":"checkout-terms-and-conditions-agreements",node:o}),s&&t("div",{className:"checkout-terms-and-conditions__error","data-testid":"checkout-terms-and-conditions-error",children:s})]})}),F=j(B,O),me=({slots:n,...o})=>{var u;const[s,a]=m(!0),[A,C]=m(!1),[T,l]=m(""),{errorMessage:x}=$({errorMessage:"Checkout.TermsAndConditions.error"}),r=((u=P.config)==null?void 0:u.agreementsEnabled)===!1,b=()=>{l("")},I=()=>{l(x)},i=R(e=>{a(!!e&&!e.isEmpty)},[]);return _(()=>{if(r)return;const e=g.on("checkout/initialized",c=>{C(!0),i(c)},{eager:!0});return()=>{e==null||e.off()}},[r,i]),_(()=>{if(r)return;const e=g.on("checkout/updated",i,{eager:!1});return()=>{e==null||e.off()}},[r,i]),t(F,{...o,agreements:t(W,{context:{appendAgreement(e){this._registerMethod((...c)=>{const f=e(...c);if(!f)return;const{mode:v,name:h,text:d,translationId:p}=f;if(!d&&!p){console.warn(`The agreement ${h} is misconfigured. Please provide a text or a translationId.`);return}const M=d?t(L,{html:d}):t(q,{id:p}),z=t(w,{checked:v===H.AUTO,label:M,name:h,required:!0,onChange:b,onInvalid:I});this._setProps(S=>({children:[...S.children||[],z]}))})}},name:"Agreements",slot:n==null?void 0:n.Agreements}),error:T,isInitialized:A,isVisible:s&&!r})};export{me as TermsAndConditions,me as default};
