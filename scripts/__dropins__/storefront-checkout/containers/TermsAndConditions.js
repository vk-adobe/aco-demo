/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as E}from"@dropins/tools/preact-jsx-runtime.js";/* empty css                             */import{Skeleton as N,SkeletonRow as w,Checkbox as j}from"@dropins/tools/components.js";import{p as y}from"../chunks/TermsAndConditions.js";import{classes as p,VComponent as H,Slot as P}from"@dropins/tools/lib.js";/* empty css                      *//* empty css                  *//* empty css                       */import{A as V}from"../chunks/checkout.js";import{events as k}from"@dropins/tools/event-bus.js";import{s as $}from"../chunks/state.js";import{useEffect as g}from"@dropins/tools/preact-compat.js";import{useState as i,useCallback as _}from"@dropins/tools/preact-hooks.js";import{useText as q,MarkupText as L}from"@dropins/tools/i18n.js";const O=({html:n})=>{const r=y.sanitize(n);return r===""?null:e("span",{dangerouslySetInnerHTML:{__html:r}})},R=({className:n,agreements:r,error:s,isInitialized:a=!1,...c})=>a?e("div",{className:"checkout-terms-and-conditions","data-testid":"checkout-terms-and-conditions",children:E("form",{...c,className:p(["checkout-terms-and-conditions__form",n]),name:"checkout-terms-and-conditions__form","data-testid":"checkout-terms-and-conditions-form",noValidate:!0,children:[r&&e(H,{node:r,className:p(["checkout-terms-and-conditions__agreements"]),"data-testid":"checkout-terms-and-conditions-agreements"}),s&&e("div",{className:"checkout-terms-and-conditions__error","data-testid":"checkout-terms-and-conditions-error",children:s})]})}):e(U,{}),U=()=>e(N,{"data-testid":"checkout-terms-and-conditions-skeleton",className:"checkout-terms-and-conditions-skeleton",children:e(w,{variant:"row",size:"small",fullWidth:!0})}),re=({slots:n,...r})=>{const[s,a]=i(!0),[c,A]=i(!1),[C,x]=i(!1),[I,m]=i(""),{errorMessage:l}=q({errorMessage:"Checkout.TermsAndConditions.error"}),T=_(()=>{m("")},[]),v=_(()=>{m(l)},[l]);return g(()=>{const t=k.on("checkout/initialized",()=>{var o;A(!0),a(((o=$.config)==null?void 0:o.isCheckoutAgreementsEnabled)??!0)},{eager:!0});return()=>{t==null||t.off()}},[]),g(()=>{const t=k.on("authenticated",o=>{x(o)},{eager:!0});return()=>{t==null||t.off()}},[]),!s||C?null:e(R,{...r,error:I,isInitialized:c,agreements:e(P,{name:"Agreements",slot:n==null?void 0:n.Agreements,context:{appendAgreement(t){this._registerMethod((...o)=>{const u=t(...o);if(!u)return;const{mode:M,name:h,text:d,translationId:f}=u;if(!d&&!f){console.warn(`The agreement ${h} is misconfigured. Please provide a text or a translationId.`);return}const b=d?e(O,{html:d}):e(L,{id:f}),S=e(j,{checked:M===V.AUTO,label:b,name:h,required:!0,onChange:T,onInvalid:v});this._setProps(z=>({children:[...z.children||[],S]}))})}}})})};export{re as TermsAndConditions,re as default};
