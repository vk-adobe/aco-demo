/*! Copyright 2025 Adobe
All Rights Reserved. */
import{merge as ue,Initializer as le}from"@dropins/tools/lib.js";import{events as T}from"@dropins/tools/event-bus.js";import{PRODUCT_FRAGMENT as ie}from"../fragments.js";import{FetchGraphQL as me}from"@dropins/tools/fetch-graphql.js";function Qe(e){const i=new URLSearchParams(window.location.search);Object.entries(e).forEach(([n,t])=>{t===null?i.delete(n):i.set(n,String(t))});let r=window.location.pathname;r+=`?${i.toString()}`,r+=window.location.hash,window.history.replaceState({},"",r)}function re(){const e=new URLSearchParams(window.location.search),i={};return e.forEach((r,n)=>{i[n]=r}),i}function ce(e=1){const r=(re()||{}).quantity;if(r){const n=parseInt(r,10);if(!isNaN(n)&&Number.isInteger(n)&&n>0)return n}return e}function fe(e){var i,r,n,t,s,a,l,o,m,u,c,f;return{productId:Number(e==null?void 0:e.externalId),name:e==null?void 0:e.name,sku:(e==null?void 0:e.variantSku)||(e==null?void 0:e.sku),topLevelSku:e==null?void 0:e.sku,specialToDate:void 0,specialFromDate:void 0,newToDate:void 0,newFromDate:void 0,createdAt:void 0,updatedAt:void 0,manufacturer:void 0,countryOfManufacture:void 0,categories:void 0,productType:e==null?void 0:e.productType,pricing:{regularPrice:((r=(i=e==null?void 0:e.prices)==null?void 0:i.regular)==null?void 0:r.amount)||0,minimalPrice:(t=(n=e==null?void 0:e.prices)==null?void 0:n.final)==null?void 0:t.minimumAmount,maximalPrice:(a=(s=e==null?void 0:e.prices)==null?void 0:s.final)==null?void 0:a.maximumAmount,specialPrice:(o=(l=e==null?void 0:e.prices)==null?void 0:l.final)==null?void 0:o.amount,tierPricing:void 0,currencyCode:((u=(m=e==null?void 0:e.prices)==null?void 0:m.final)==null?void 0:u.currency)||"USD"},canonicalUrl:e==null?void 0:e.url,mainImageUrl:(f=(c=e==null?void 0:e.images)==null?void 0:c[0])==null?void 0:f.url}}const Pe={PRODUCT_CONTEXT:"productContext"},de={PRODUCT_PAGE_VIEW:"product-page-view"};function se(){return window.adobeDataLayer=window.adobeDataLayer||[],window.adobeDataLayer}function he(e,i){const r=se();r.push({[e]:null}),r.push({[e]:i})}function ye(e,i){se().push(n=>{const t=n.getState?n.getState():{};n.push({event:e,eventInfo:{...t,...i}})})}function we(e){const i=fe(e);he(Pe.PRODUCT_CONTEXT,i),ye(de.PRODUCT_PAGE_VIEW)}var q=(e=>(e.ComplexProduct="complex",e.SimpleProduct="simple",e))(q||{}),ae=(e=>(e.ComplexProductView="ComplexProductView",e.SimpleProductView="SimpleProductView",e))(ae||{});function K(e,i){var a,l,o,m,u,c,f,d,h,w,P,k;const r=((m=(o=(l=(a=e==null?void 0:e.options)==null?void 0:a[0])==null?void 0:l.values)==null?void 0:o[0])==null?void 0:m.__typename)==="ProductViewOptionValueProduct",n=Oe(e,r,i==null?void 0:i.preselectFirstOption),t=(e==null?void 0:e.__typename)===ae.SimpleProductView?q.SimpleProduct:q.ComplexProduct,s=e?{name:e.name,sku:e.sku,isBundle:r,addToCartAllowed:e.addToCartAllowed,inStock:e.inStock,shortDescription:e.shortDescription,metaDescription:e.metaDescription,metaKeyword:e.metaKeyword,metaTitle:e.metaTitle,description:e.description,images:ge(e),prices:Te(e,r,n),attributes:De(e),options:Ce(e,r),optionUIDs:n,url:e.url,urlKey:e.urlKey,externalId:e.externalId,externalParentId:e.externalParentId,variantSku:e.variantSku,productType:t}:null;return ue(s,((d=(f=(c=(u=b.getConfig())==null?void 0:u.models)==null?void 0:c.ProductDetails)==null?void 0:f.transformer)==null?void 0:d.call(f,e))??((k=(P=(w=(h=b.getConfig())==null?void 0:h.models)==null?void 0:w.ProductDetails)==null?void 0:P.transform)==null?void 0:k.call(P,e)))}function ge(e){var i,r;return(r=(i=e.images)==null?void 0:i.filter(n=>{var t;return!((t=n.roles)!=null&&t.includes("hide_from_pdp"))}))==null?void 0:r.map(n=>(n.url=n.url.replace(/^https?:/,""),n))}function De(e){var i,r;return(r=(i=e.attributes)==null?void 0:i.filter(({roles:n})=>(n==null?void 0:n.indexOf("visible_in_pdp"))!==-1))==null?void 0:r.map(({label:n,value:t,name:s})=>({id:s,label:n,value:t.toString().split(",").join(", ")}))}function Ce(e,i){const{options:r,optionUIDs:n}=e;return r==null?void 0:r.map(({id:t,title:s,required:a,multi:l,values:o})=>{var c;const m=(c=o==null?void 0:o[0])==null?void 0:c.__typename;let u=o==null?void 0:o[0].type;return u?u=u.replace("COLOR_HEX","color").replace("TEXT","text").replace("IMAGE","image"):u="dropdown",{id:t,type:u,typename:m,label:s,required:a,multiple:l,items:i?xe(o,n):Ee(o,n,u)}})}function xe(e,i){return e==null?void 0:e.filter(({enabled:r})=>typeof r>"u"||r).map(({id:r,title:n,inStock:t,isDefault:s,product:a})=>({id:r,inStock:t,label:n,selected:(i==null?void 0:i.indexOf(r))>-1||s,value:r,product:a}))}function Ee(e,i,r){return e==null?void 0:e.map(({id:n,title:t,inStock:s,value:a})=>({id:n,inStock:s,label:t,selected:(i==null?void 0:i.indexOf(n))>-1,value:(r==null?void 0:r.toLowerCase())==="dropdown"?n:a==null?void 0:a.replace(/^https?:/,"")}))}function Te(e,i,r){var P,k,X,B,z;const{price:n,priceRange:t,options:s,optionUIDs:a=r}=e;let{__typename:l}=e;function o(){var x;const D=n==null?void 0:n.regular.amount.value,y=((x=n==null?void 0:n.final)==null?void 0:x.amount.value)??(n==null?void 0:n.regular.amount.value),C=(n==null?void 0:n.regular.amount.currency)==="NONE"?"USD":n==null?void 0:n.regular.amount.currency;return[D,y,y,C]}function m(){var O,S,p,v,U,A,I,V,F,N,G,M;const D=(O=t==null?void 0:t.minimum)==null?void 0:O.final.amount.value,y=(S=t==null?void 0:t.maximum)==null?void 0:S.final.amount.value;let C;((v=(p=t==null?void 0:t.minimum)==null?void 0:p.regular)==null?void 0:v.amount.value)===((A=(U=t==null?void 0:t.maximum)==null?void 0:U.regular)==null?void 0:A.amount.value)&&(C=(V=(I=t==null?void 0:t.minimum)==null?void 0:I.regular)==null?void 0:V.amount.value);const x=((N=(F=t==null?void 0:t.minimum)==null?void 0:F.final)==null?void 0:N.amount.currency)==="NONE"?"USD":(M=(G=t==null?void 0:t.minimum)==null?void 0:G.final)==null?void 0:M.amount.currency;return[C,D,y,x]}function u(){var p,v,U,A,I,V,F,N,G,M,W,Y,J;let D=0,y=0;s==null||s.forEach(_=>{var Z;const j=_==null?void 0:_.values;if(j&&Array.isArray(j)){const E=j.map(g=>{var $,L,R,ee;return(ee=(R=(L=($=g==null?void 0:g.product)==null?void 0:$.price)==null?void 0:L.regular)==null?void 0:R.amount)==null?void 0:ee.value}).filter(g=>g!==void 0),Q=E.length>0?Math.max(...E):0;D+=Q}(Z=_==null?void 0:_.values)==null||Z.forEach(E=>{var Q,g,$,L;a!=null&&a.includes(E.id)&&(y+=(L=($=(g=(Q=E==null?void 0:E.product)==null?void 0:Q.price)==null?void 0:g.final)==null?void 0:$.amount)==null?void 0:L.value)})});const C=(p=t==null?void 0:t.minimum)==null?void 0:p.final.amount.value,x=(v=t==null?void 0:t.maximum)==null?void 0:v.final.amount.value;let O;((A=(U=t==null?void 0:t.minimum)==null?void 0:U.regular)==null?void 0:A.amount.value)===((V=(I=t==null?void 0:t.maximum)==null?void 0:I.regular)==null?void 0:V.amount.value)&&(O=(N=(F=t==null?void 0:t.minimum)==null?void 0:F.regular)==null?void 0:N.amount.value);const S=((M=(G=t==null?void 0:t.minimum)==null?void 0:G.final)==null?void 0:M.amount.currency)==="NONE"?"USD":(Y=(W=t==null?void 0:t.minimum)==null?void 0:W.final)==null?void 0:Y.amount.currency;return i&&(a==null?void 0:a.length)<1?[O,C,x,S]:D===((J=t==null?void 0:t.maximum)==null?void 0:J.regular.amount.value)?[y,y,y,S]:[O,C,x,S]}const[c,f,d,h]=l==="SimpleProductView"?o():i?u():m(),w=l==="SimpleProductView"?(P=n==null?void 0:n.roles)==null?void 0:P.includes("visible"):((X=(k=t==null?void 0:t.maximum)==null?void 0:k.roles)==null?void 0:X.includes("visible"))&&((z=(B=t==null?void 0:t.minimum)==null?void 0:B.roles)==null?void 0:z.includes("visible"));return d&&f===d?{regular:{amount:c,currency:h,variant:c&&f!==c?"strikethrough":"default"},final:{amount:d,currency:h,variant:"default"},visible:w}:{final:{minimumAmount:f,maximumAmount:d,currency:h},visible:w}}function Oe(e,i,r){var n;return i?((n=e==null?void 0:e.options)==null?void 0:n.map(({values:s})=>{var o;const a=((o=s==null?void 0:s.find(({isDefault:m})=>m))==null?void 0:o.id)??null,l=r?s[0].id:null;return a||l})).filter(s=>s!==null):e==null?void 0:e.optionUIDs}const H=new le({init:async e=>{var l,o,m;const i=(o=(l=e==null?void 0:e.models)==null?void 0:l.ProductDetails)==null?void 0:o.initialData,n=((m=(re()||{}).optionsUIDs)==null?void 0:m.split(","))||(i==null?void 0:i.optionsUIDs),t=ce(1),a={...{defaultLocale:"en-US",persistURLParams:!1,acdl:!1,optionsUIDs:n},...e};if(H.config.setConfig({...a}),a!=null&&a.sku){const u=i?K(i):await ne(a.sku,{preselectFirstOption:a.preselectFirstOption});T.emit("pdp/data",u);const c={sku:a.sku,quantity:t,optionsUIDs:u==null?void 0:u.optionUIDs};Ie(()=>({...c})),Fe(()=>{var f;return u!=null&&u.options?u.options.length===((f=u==null?void 0:u.optionUIDs)==null?void 0:f.length):!0}),a.acdl&&u&&we(u)}},listeners:()=>[T.on("locale",async()=>{const{sku:e}=H.config.getConfig();if(e){const i=await ne(e);T.emit("pdp/data",i)}})]}),b=H.config,{setEndpoint:je,setFetchGraphQlHeader:qe,removeFetchGraphQlHeader:He,setFetchGraphQlHeaders:Ke,fetchGraphQl:oe,getConfig:Xe}=new me().getMethods(),Se=`
query GET_PRODUCT_DATA($skus: [String]) {
    products(skus: $skus) {
        ...PRODUCT_FRAGMENT
    }
}

${ie}
`,_e=async(e,i,r)=>{var s;const{data:n}=await oe(Se,{method:"GET",variables:{skus:[e]}}),t=(s=n==null?void 0:n.products)==null?void 0:s[0];return i!=null&&i.optionsUIDs&&(t.optionUIDs=i.optionsUIDs),t?r?t:K(t,{preselectFirstOption:i==null?void 0:i.preselectFirstOption}):null},be=`
query REFINE_PRODUCT_QUERY(
    $optionIds: [String!]!
    $sku: String!
) {
    # Refined Product
    refineProduct(
        optionIds: $optionIds 
        sku: $sku
    ) {
        ...PRODUCT_FRAGMENT
    }

    # Parent Product
    products(skus: [$sku]) {
        ...PRODUCT_FRAGMENT
    }

    # %extendedPlaceholder%
}

${ie}
`;async function te(e,i){const r=pe(i),n=ve(r,e),t=be.replace("# %extendedPlaceholder%",n),{data:s}=await oe(t,{method:"GET",variables:{optionIds:i,sku:e}});return s}const ke=async(e,i,r,n)=>{var d,h,w;const t=await te(e,i);if(!t)return null;let{products:s,refineProduct:a,...l}=t;const o=s==null?void 0:s[0],m=Ue(Object.values(l),o.options,r);if(r!=null&&r.length&&a===null){i=Ae(m,i,r);const P=await te(e,i);a=P==null?void 0:P.refineProduct}const u={...a||o,sku:o.sku,name:o.name,externalParentId:o==null?void 0:o.externalId,options:m,optionUIDs:i,variantSku:(a==null?void 0:a.__typename)==="SimpleProductView"?a==null?void 0:a.sku:void 0},c=n?u:K(u),f=(w=(h=(d=b==null?void 0:b.getConfig())==null?void 0:d.models)==null?void 0:h.ProductDetails)==null?void 0:w.fallbackData;return f?f(o,c):c};function pe(e){if(e.length<2)return[e];const i=[];return e.forEach(r=>{const n=[];e.forEach(t=>{r!==t&&n.push(t)}),i.push(n)}),i}function ve(e,i){return e.map((r,n)=>`
          ProductOption${n}: refineProduct(
            optionIds: [
              ${r.map(t=>`"${t}"`).join(", ")}
            ]
            sku: "${i}"
          ) {
            ... on ComplexProductView {
              options {
                ...PRODUCT_OPTION_FRAGMENT
              }
            }
          }
        `).join("")}function Ue(e,i=[],r){const n=Object.values(e).filter(s=>!!s).reduce((s,a)=>a.options?[...s,...a.options]:[...s],[]),t=new Map(i.map(s=>[s.id,s]));return n.forEach(s=>{r!=null&&r.includes(s.id)||t.set(s.id,s)}),[...t.values()]}function Ae(e,i,r){const n=[];let t;return e.forEach(s=>{var a,l,o,m;r.includes(s.id)?t=((l=(a=s.values)==null?void 0:a.find(u=>i.includes(u==null?void 0:u.id)))==null?void 0:l.id)||((o=s.values[0])==null?void 0:o.id):t=(m=s.values[0])==null?void 0:m.id,n.push(t)}),n}const ne=async(e,i)=>{const{anchors:r,optionsUIDs:n}=b.getConfig(),{optionsUIDs:t=n,anchors:s=r,preselectFirstOption:a,isBundle:l,skipTransform:o}=i??{};return!l&&t?await ke(e,t,s,o):await _e(e,{preselectFirstOption:a,optionsUIDs:t},o)},Ie=e=>{const i=Ve(),r=e(i);T.emit("pdp/values",{...r})},Ve=()=>{var e;return((e=T._lastEvent["pdp/values"])==null?void 0:e.payload)??null},Fe=e=>{const i=Ne(),r=e(i);T.emit("pdp/valid",r)},Ne=()=>{var e;return((e=T._lastEvent["pdp/valid"])==null?void 0:e.payload)??null};export{qe as a,Ke as b,b as c,_e as d,ke as e,oe as f,Xe as g,ne as h,H as i,Ie as j,Ve as k,Fe as l,Ne as m,ce as n,Qe as o,we as p,He as r,je as s,K as t};
//# sourceMappingURL=isProductConfigurationValid.js.map
