{"version":3,"file":"getRecommendations.js","sources":["/@dropins/storefront-recommendations/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-recommendations/src/lib/fetch-error.ts","/@dropins/storefront-recommendations/src/api/getRecommendations/graphql/GetRecommendationsQuery.ts","/@dropins/storefront-recommendations/src/data/transforms/transform-recommendations.ts","/@dropins/storefront-recommendations/src/api/getRecommendations/getRecommendations.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\nexport const {\n  setEndpoint,\n  setFetchGraphQlHeader,\n  removeFetchGraphQlHeader,\n  setFetchGraphQlHeaders,\n  fetchGraphQl,\n  getConfig,\n} = new FetchGraphQL().getMethods();\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Handles GraphQL fetch errors\n * @param errors Array of GraphQL errors\n * @returns null if the error is handled, otherwise throws an error\n */\nexport const handleFetchError = (\n  errors: Array<{\n    message: string;\n    [key: string]: any;\n  }>\n) => {\n  const errorMessage = errors.map((e) => e.message).join(' ');\n\n  // For other errors, throw an exception\n  throw new Error(errorMessage);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const GET_RECOMMENDATIONS_QUERY = `query GetRecommendations(\n  $pageType: PageType!\n  $currentSku: String!\n  $cartSkus: [String]\n  $userPurchaseHistory: [PurchaseHistory]\n  $userViewHistory: [ViewHistory]\n) {\n  recommendations(\n    cartSkus: $cartSkus\n    currentSku: $currentSku\n    pageType: $pageType\n    userPurchaseHistory: $userPurchaseHistory\n    userViewHistory: $userViewHistory\n  ) {\n    results {\n      displayOrder\n      pageType\n      productsView {\n        __typename\n        name\n        sku\n        queryType\n        visibility\n        images {\n          url\n        }\n        urlKey\n        ... on SimpleProductView {\n          price {\n            final {\n              amount {\n                currency\n                value\n              }\n            }\n          }\n        }\n        ... on ComplexProductView {\n          priceRange {\n            maximum {\n              final {\n                amount {\n                  currency\n                  value\n                }\n              }\n            }\n            minimum {\n              final {\n                amount {\n                  currency\n                  value\n                }\n              }\n            }\n          }\n        }\n      }\n      storefrontLabel\n      totalProducts\n      typeId\n      unitId\n      unitName\n    }\n    totalResults\n  }\n}`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  RecommendationUnitModel,\n  PageType,\n  Item,\n} from '@/recommendations/data/models';\n\nexport function transformRecommendations(\n  data: any\n): RecommendationUnitModel | null {\n  if (!data) return null;\n\n  return {\n    displayOrder: data.results[0]?.displayOrder ?? 0,\n    pageType: data.results[0]?.pageType as PageType,\n    title: data.results[0]?.storefrontLabel ?? '',\n    items: transformItems(data.results[0]?.productsView ?? []),\n    totalProducts: data.results[0]?.totalProducts ?? 0,\n    typeId: data.results[0]?.typeId ?? '',\n    unitId: data.results[0]?.unitId ?? '',\n    unitName: data.results[0]?.unitName ?? '',\n  };\n}\n\nfunction transformItems(products: any): Item[] {\n  if (!products?.length) return [];\n\n  return products.map((product: any) => ({\n    itemType: product.__typename ?? '',\n    uid: product.sku,\n    sku: product.sku,\n    name: product.name ?? '',\n    urlKey: product.urlKey ?? '',\n    images: [\n      {\n        label: product.name ?? '',\n        roles: ['thumbnail'],\n        url: (product.images?.[0]?.url ?? '').replace('http://', '//'),\n      },\n    ],\n    price: {\n      final: {\n        amount: {\n          value: product.price?.final?.amount?.value ?? null,\n          currency: product.price?.final?.amount?.currency ?? null,\n        },\n      },\n    },\n    priceRange: {\n      minimum: {\n        final: {\n          amount: {\n            value: product.priceRange?.minimum?.final?.amount?.value ?? null,\n            currency:\n              product.priceRange?.minimum?.final?.amount?.currency ?? null,\n          },\n        },\n      },\n      maximum: {\n        final: {\n          amount: {\n            value: product.priceRange?.maximum?.final?.amount?.value ?? null,\n            currency:\n              product.priceRange?.maximum?.final?.amount?.currency ?? null,\n          },\n        },\n      },\n    },\n    visibility: product.visibility ?? '',\n    queryType: product.queryType ?? '',\n  }));\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/recommendations/api/fetch-graphql';\nimport { handleFetchError } from '@/recommendations/lib/fetch-error';\nimport { GET_RECOMMENDATIONS_QUERY } from '@/recommendations/api/getRecommendations/graphql/GetRecommendationsQuery';\nimport {\n  GraphQLResponse,\n  RecommendationUnitModel,\n} from '@/recommendations/data/models';\nimport { events } from '@adobe-commerce/event-bus';\nimport { transformRecommendations } from '@/recommendations/data/transforms';\n\nexport interface GetRecommendationsProps {\n  currentSku?: string;\n  pageType: string;\n  cartSkus?: string[];\n  userPurchaseHistory?: any[];\n  userViewHistory?: any[];\n}\n\nexport const getRecommendations = async (\n  params: GetRecommendationsProps\n): Promise<RecommendationUnitModel | null> => {\n  return fetchGraphQl(GET_RECOMMENDATIONS_QUERY, {\n    method: 'GET',\n    variables: params,\n  }).then(({ errors, data }: GraphQLResponse) => {\n    if (errors && errors.length > 0) return handleFetchError(errors);\n\n    // transform recommendations\n    const payload = transformRecommendations(data?.recommendations);\n\n    // emit events\n    events.emit('recommendations/data', payload);\n\n    return payload;\n  });\n};\n"],"names":["setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","fetchGraphQl","getConfig","FetchGraphQL","handleFetchError","errors","errorMessage","e","GET_RECOMMENDATIONS_QUERY","transformRecommendations","data","_a","_b","_c","transformItems","_d","_e","_f","_g","_h","products","product","_l","_k","_j","_i","_p","_o","_n","_m","_t","_s","_r","_q","_x","_w","_v","_u","getRecommendations","params","payload","events"],"mappings":"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"}