{"version":3,"file":"ProductList.js","sources":["/@dropins/storefront-recommendations/src/components/ProductList/ProductList.tsx","/@dropins/storefront-recommendations/src/containers/ProductList/ProductList.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FunctionComponent, VNode } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { Skeleton, SkeletonRow } from '@adobe-commerce/elsie/components';\nimport { classes, VComponent } from '@adobe-commerce/elsie/lib';\n\nimport '@/recommendations/components/ProductList/ProductList.css';\n\nexport interface ProductListProps\n  extends HTMLAttributes<HTMLDivElement>,\n    Omit<HTMLAttributes<HTMLDivElement>, 'loading'> {\n  heading?: VNode | null;\n  products?: VNode | null;\n  loading?: boolean;\n}\n\nexport const ProductList: FunctionComponent<ProductListProps> = ({\n  className,\n  children,\n  heading,\n  products = null,\n  loading = true,\n  ...props\n}) => {\n  return (\n    <div\n      {...props}\n      className={classes(['recommendations-product-list', className])}\n    >\n      {loading ? (\n        <ProductListSkeleton />\n      ) : (\n        <>\n          {heading && (\n            <VComponent\n              node={heading}\n              className=\"recommendations-product-list__heading\"\n            />\n          )}\n          <div className=\"recommendations-product-list__content\">\n            {products}\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nconst ProductListSkeleton: FunctionComponent = () => {\n  return (\n    <Skeleton\n      data-testid=\"recommendations-product-list-skeleton\"\n      className=\"recommendations-product-list-skeleton\"\n      rowGap=\"medium\"\n    >\n      {[...Array(2)].map((_, i) => (\n        <SkeletonRow\n          key={i}\n          variant=\"row\"\n          size=\"large\"\n          fullWidth\n          lines={2}\n          multilineGap=\"small\"\n        />\n      ))}\n    </Skeleton>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { HTMLAttributes } from 'preact/compat';\nimport { VNode } from 'preact';\nimport { useEffect, useState, useCallback } from 'preact/hooks';\nimport { ProductList as ProductListComponent } from '@/recommendations/components';\nimport { Container, Slot, SlotProps } from '@adobe-commerce/elsie/lib';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport {\n  Button,\n  Image,\n  ImageProps,\n  Price,\n  ProductItemCard,\n} from '@adobe-commerce/elsie/components';\nimport { Item, RecommendationUnitModel } from '@/recommendations/data/models';\nimport { events } from '@adobe-commerce/event-bus';\nimport { getRecommendations } from '@/recommendations/api';\n\nexport interface ProductListProps extends HTMLAttributes<HTMLDivElement> {\n  footer?: any;\n  initialData?: {\n    recommendations?: {\n      results: RecommendationUnitModel[];\n      totalProducts: number;\n    };\n  };\n  hideHeading?: boolean;\n  routeProduct?: (item: Item) => string;\n  currentSku?: string;\n  pageType: string;\n  cartSkus?: string[];\n  userPurchaseHistory?: any[];\n  userViewHistory?: any[];\n  slots?: {\n    Heading?: SlotProps;\n    Footer?: SlotProps;\n    Title?: SlotProps<{\n      item: Item;\n      productUrl: string;\n    }>;\n    Sku?: SlotProps<{\n      item: Item;\n    }>;\n    Price?: SlotProps<{\n      item: Item;\n    }>;\n    Thumbnail?: SlotProps<{\n      item: any;\n      defaultImageProps: ImageProps;\n    }>;\n  };\n}\n\nexport const ProductList: Container<ProductListProps> = ({\n  initialData = null,\n  hideHeading,\n  routeProduct,\n  currentSku,\n  pageType,\n  cartSkus,\n  userPurchaseHistory,\n  userViewHistory,\n  slots,\n  ...props\n}) => {\n  const [loading, setLoading] = useState(!initialData);\n  const [recommendations, setRecommendations] = useState<\n    RecommendationUnitModel[] | null\n  >(initialData?.recommendations?.results || []);\n\n  const dictionary = useText({\n    addToCartText: 'Recommendations.ProductList.addToCart',\n    optionsText: 'Recommendations.ProductList.selectOptions',\n    viewProductText: 'Recommendations.ProductList.viewProduct',\n  });\n\n  // Helper function to validate if all required data is available\n  const hasRequiredData = useCallback((): boolean => {\n    if (!pageType) return false;\n\n    switch (pageType) {\n      case 'Product':\n        return !!currentSku;\n      case 'Cart':\n        return !!(cartSkus && cartSkus.length > 0);\n      case 'Category':\n      case 'Checkout':\n      case 'CMS':\n      default:\n        return true;\n    }\n  }, [pageType, currentSku, cartSkus]);\n\n  useEffect(() => {\n    const dataEvent = events.on(\n      'recommendations/data',\n      (payload: RecommendationUnitModel | null) => {\n        if (payload?.items?.length) {\n          setRecommendations([payload]);\n        } else {\n          setRecommendations([]);\n        }\n        setLoading(false);\n      }\n    );\n\n    return () => {\n      dataEvent?.off();\n    };\n  }, []);\n\n  useEffect(() => {\n    // Only fetch recommendations if we have all required data\n    if (!hasRequiredData()) {\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    getRecommendations({\n      currentSku: currentSku || '',\n      pageType,\n      cartSkus,\n      userPurchaseHistory,\n      userViewHistory,\n    }).catch((error) => {\n      console.error('Recommendations error:', error);\n      setRecommendations([]);\n      setLoading(false);\n    });\n  }, [\n    currentSku,\n    pageType,\n    cartSkus,\n    userPurchaseHistory,\n    userViewHistory,\n    hasRequiredData,\n  ]);\n\n  // Only proceed with rendering if all required data is available\n  if (!hasRequiredData()) {\n    return null;\n  }\n\n  const getImage = (\n    item: RecommendationUnitModel['items'][0],\n    index: number\n  ) => {\n    const defaultImageProps: ImageProps = {\n      loading: index < 4 ? 'eager' : 'lazy',\n      src: item.images?.[0]?.url || '',\n      alt: item.images?.[0]?.label || '',\n      width: '300',\n      height: '300',\n      params: { width: 300 },\n    };\n\n    const imageComponent = (\n      <Image\n        data-testid=\"product-list-item-image\"\n        {...defaultImageProps}\n        aria-label={item.sku}\n      />\n    );\n\n    return (\n      <Slot\n        name=\"Thumbnail\"\n        slot={slots?.Thumbnail}\n        context={{\n          item,\n          defaultImageProps,\n        }}\n      >\n        {routeProduct ? (\n          <a href={routeProduct(item)}>{imageComponent}</a>\n        ) : (\n          imageComponent\n        )}\n      </Slot>\n    );\n  };\n\n  const heading = (\n    <Slot name=\"Heading\" slot={slots?.Heading} context={{}}>\n      <div data-testid=\"default-product-list-heading\">\n        {recommendations?.[0]?.title || dictionary.heading}\n      </div>\n    </Slot>\n  );\n\n  const getFooter = (\n    item: RecommendationUnitModel['items'][0],\n    index: number\n  ) => {\n    return (\n      <Slot\n        name=\"Footer\"\n        slot={slots?.Footer}\n        context={{\n          item,\n          index,\n        }}\n      >\n        <div data-testid=\"default-product-list-footer\">\n          {routeProduct && (\n            <Button\n              data-testid=\"default-product-list-footer-button\"\n              children={dictionary.viewProductText}\n              aria-label={dictionary.viewProductText}\n              variant=\"primary\"\n              href={routeProduct(item)}\n            />\n          )}\n        </div>\n      </Slot>\n    );\n  };\n\n  const getTitle = (item: RecommendationUnitModel['items'][0]) => {\n    return (\n      <Slot\n        name=\"Title\"\n        slot={slots?.Title}\n        context={{\n          item,\n          productUrl: routeProduct ? routeProduct(item) : '',\n        }}\n      >\n        {routeProduct ? (\n          <a href={routeProduct(item)}>{item.name}</a>\n        ) : (\n          <span>{item.name}</span>\n        )}\n      </Slot>\n    );\n  };\n\n  const getSku = (item: RecommendationUnitModel['items'][0]) => {\n    return (\n      <Slot\n        name=\"Sku\"\n        slot={slots?.Sku}\n        context={{\n          item,\n        }}\n      >\n        <span>{item.sku}</span>\n      </Slot>\n    );\n  };\n\n  const getPrice = (item: RecommendationUnitModel['items'][0]) => {\n    return (\n      <Slot\n        name=\"Price\"\n        slot={slots?.Price}\n        context={{\n          item,\n        }}\n      >\n        <div data-testid=\"default-product-price\">\n          <Price\n            amount={item.price.final?.amount?.value}\n            currency={item.price.final?.amount?.currency}\n          />\n        </div>\n      </Slot>\n    );\n  };\n\n  const productEntries: VNode = (\n    <>\n      {recommendations?.map(\n        ({ items, totalProducts }: RecommendationUnitModel, unitIndex) =>\n          totalProducts > 0\n            ? items.map(\n                (item: RecommendationUnitModel['items'][0], index: number) => {\n                  const { sku } = item;\n\n                  return (\n                    <ProductItemCard\n                      key={sku}\n                      initialized\n                      sku={getSku(item)}\n                      image={getImage(item, unitIndex * items.length + index)}\n                      titleNode={getTitle(item)}\n                      price={getPrice(item)}\n                      actionButton={getFooter(\n                        item,\n                        unitIndex * items.length + index\n                      )}\n                    />\n                  );\n                }\n              )\n            : null\n      )}\n    </>\n  );\n\n  return (\n    <ProductListComponent\n      {...props}\n      heading={hideHeading ? undefined : heading}\n      loading={loading}\n      products={productEntries}\n    />\n  );\n};\n"],"names":["ProductList","className","children","heading","products","loading","props","jsx","classes","ProductListSkeleton","jsxs","Fragment","VComponent","Skeleton","_","i","SkeletonRow","initialData","hideHeading","routeProduct","currentSku","pageType","cartSkus","userPurchaseHistory","userViewHistory","slots","setLoading","useState","recommendations","setRecommendations","_a","dictionary","useText","hasRequiredData","useCallback","useEffect","dataEvent","events","payload","getRecommendations","error","getImage","item","index","defaultImageProps","_b","_d","_c","imageComponent","Image","Slot","getFooter","Button","getTitle","getSku","getPrice","Price","productEntries","items","totalProducts","unitIndex","sku","ProductItemCard","ProductListComponent"],"mappings":"yjBAgCO,MAAMA,EAAmD,CAAC,CAC/D,UAAAC,EACA,SAAAC,EACA,QAAAC,EACA,SAAAC,EAAW,KACX,QAAAC,EAAU,GACV,GAAGC,CACL,IAEIC,EAAC,MAAA,CACE,GAAGD,EACJ,UAAWE,EAAQ,CAAC,+BAAgCP,CAAS,CAAC,EAE7D,SACCI,EAAAE,EAACE,EAAoB,CAAA,CAAA,EAGlBC,EAAAC,EAAA,CAAA,SAAA,CACCR,GAAAI,EAACK,EAAA,CACC,KAAMT,EACN,UAAU,uCAAA,CACZ,EAEDI,EAAA,MAAA,CAAI,UAAU,wCACZ,SACHH,CAAA,CAAA,CAAA,CACF,CAAA,CAAA,CAEJ,EAIEK,EAAyC,IAE3CF,EAACM,EAAA,CACC,cAAY,wCACZ,UAAU,wCACV,OAAO,SAEN,SAAA,CAAC,GAAG,MAAM,CAAC,CAAC,EAAE,IAAI,CAACC,EAAGC,IACrBR,EAACS,EAAA,CAEC,QAAQ,MACR,KAAK,QACL,UAAS,GACT,MAAO,EACP,aAAa,OAAA,EALRD,CAOR,CAAA,CAAA,CACH,ECZSf,GAA2C,CAAC,CACvD,YAAAiB,EAAc,KACd,YAAAC,EACA,aAAAC,EACA,WAAAC,EACA,SAAAC,EACA,SAAAC,EACA,oBAAAC,EACA,gBAAAC,EACA,MAAAC,EACA,GAAGnB,CACL,IAAM,SACJ,KAAM,CAACD,EAASqB,CAAU,EAAIC,EAAS,CAACV,CAAW,EAC7C,CAACW,EAAiBC,CAAkB,EAAIF,IAE5CG,EAAAb,GAAA,YAAAA,EAAa,kBAAb,YAAAa,EAA8B,UAAW,EAAE,EAEvCC,EAAaC,EAAQ,CACzB,cAAe,wCACf,YAAa,4CACb,gBAAiB,yCAAA,CAClB,EAGKC,EAAkBC,EAAY,IAAe,CAC7C,GAAA,CAACb,EAAiB,MAAA,GAEtB,OAAQA,EAAU,CAChB,IAAK,UACH,MAAO,CAAC,CAACD,EACX,IAAK,OACH,MAAO,CAAC,EAAEE,GAAYA,EAAS,OAAS,GAC1C,IAAK,WACL,IAAK,WACL,IAAK,MACL,QACS,MAAA,EAAA,CAEV,EAAA,CAACD,EAAUD,EAAYE,CAAQ,CAAC,EAiD/B,GA/CJa,EAAU,IAAM,CACd,MAAMC,EAAYC,EAAO,GACvB,uBACCC,GAA4C,QACvCR,EAAAQ,GAAA,YAAAA,EAAS,QAAT,MAAAR,EAAgB,OACCD,EAAA,CAACS,CAAO,CAAC,EAE5BT,EAAmB,CAAA,CAAE,EAEvBH,EAAW,EAAK,CAAA,CAEpB,EAEA,MAAO,IAAM,CACXU,GAAA,MAAAA,EAAW,KACb,CACF,EAAG,EAAE,EAELD,EAAU,IAAM,CAEV,GAAA,CAACF,IAAmB,CACtBP,EAAW,EAAK,EAChB,MAAA,CAGFA,EAAW,EAAI,EACIa,EAAA,CACjB,WAAYnB,GAAc,GAC1B,SAAAC,EACA,SAAAC,EACA,oBAAAC,EACA,gBAAAC,CAAA,CACD,EAAE,MAAOgB,GAAU,CACV,QAAA,MAAM,yBAA0BA,CAAK,EAC7CX,EAAmB,CAAA,CAAE,EACrBH,EAAW,EAAK,CAAA,CACjB,CAAA,EACA,CACDN,EACAC,EACAC,EACAC,EACAC,EACAS,CAAA,CACD,EAGG,CAACA,IACI,OAAA,KAGH,MAAAQ,EAAW,CACfC,EACAC,IACG,aACH,MAAMC,EAAgC,CACpC,QAASD,EAAQ,EAAI,QAAU,OAC/B,MAAKE,GAAAf,EAAAY,EAAK,SAAL,YAAAZ,EAAc,KAAd,YAAAe,EAAkB,MAAO,GAC9B,MAAKC,GAAAC,EAAAL,EAAK,SAAL,YAAAK,EAAc,KAAd,YAAAD,EAAkB,QAAS,GAChC,MAAO,MACP,OAAQ,MACR,OAAQ,CAAE,MAAO,GAAI,CACvB,EAEME,EACJzC,EAAC0C,EAAA,CACC,cAAY,0BACX,GAAGL,EACJ,aAAYF,EAAK,GAAA,CACnB,EAIA,OAAAnC,EAAC2C,EAAA,CACC,KAAK,YACL,KAAMzB,GAAA,YAAAA,EAAO,UACb,QAAS,CACP,KAAAiB,EACA,kBAAAE,CACF,EAEC,SAAAzB,IACE,IAAE,CAAA,KAAMA,EAAauB,CAAI,EAAI,UAAe,CAAA,EAE7CM,CAAA,CAEJ,CAEJ,EAEM7C,IACH+C,EAAK,CAAA,KAAK,UAAU,KAAMzB,GAAA,YAAAA,EAAO,QAAS,QAAS,GAClD,SAAClB,EAAA,MAAA,CAAI,cAAY,+BACd,WAAAsC,EAAAjB,GAAA,YAAAA,EAAkB,KAAlB,YAAAiB,EAAsB,QAASd,EAAW,OAAA,CAC7C,CACF,CAAA,EAGIoB,EAAY,CAChBT,EACAC,IAGEpC,EAAC2C,EAAA,CACC,KAAK,SACL,KAAMzB,GAAA,YAAAA,EAAO,OACb,QAAS,CACP,KAAAiB,EACA,MAAAC,CACF,EAEA,SAACpC,EAAA,MAAA,CAAI,cAAY,8BACd,SACCY,GAAAZ,EAAC6C,EAAA,CACC,cAAY,qCACZ,SAAUrB,EAAW,gBACrB,aAAYA,EAAW,gBACvB,QAAQ,UACR,KAAMZ,EAAauB,CAAI,CAAA,CAAA,CAG7B,CAAA,CAAA,CACF,EAIEW,EAAYX,GAEdnC,EAAC2C,EAAA,CACC,KAAK,QACL,KAAMzB,GAAA,YAAAA,EAAO,MACb,QAAS,CACP,KAAAiB,EACA,WAAYvB,EAAeA,EAAauB,CAAI,EAAI,EAClD,EAEC,SACCvB,EAAAZ,EAAC,IAAE,CAAA,KAAMY,EAAauB,CAAI,EAAI,SAAAA,EAAK,IAAK,CAAA,EAEvCnC,EAAA,OAAA,CAAM,WAAK,IAAK,CAAA,CAAA,CAErB,EAIE+C,EAAUZ,GAEZnC,EAAC2C,EAAA,CACC,KAAK,MACL,KAAMzB,GAAA,YAAAA,EAAO,IACb,QAAS,CACP,KAAAiB,CACF,EAEA,SAAAnC,EAAC,OAAM,CAAA,SAAAmC,EAAK,GAAI,CAAA,CAAA,CAClB,EAIEa,EAAYb,GAA8C,aAE5D,OAAAnC,EAAC2C,EAAA,CACC,KAAK,QACL,KAAMzB,GAAA,YAAAA,EAAO,MACb,QAAS,CACP,KAAAiB,CACF,EAEA,SAAAnC,EAAC,MAAI,CAAA,cAAY,wBACf,SAAAA,EAACiD,EAAA,CACC,QAAQX,GAAAf,EAAAY,EAAK,MAAM,QAAX,YAAAZ,EAAkB,SAAlB,YAAAe,EAA0B,MAClC,UAAUC,GAAAC,EAAAL,EAAK,MAAM,QAAX,YAAAK,EAAkB,SAAlB,YAAAD,EAA0B,QAAA,CAAA,CAExC,CAAA,CAAA,CACF,CAEJ,EAEMW,OAED,SAAiB7B,GAAA,YAAAA,EAAA,IAChB,CAAC,CAAE,MAAA8B,EAAO,cAAAC,GAA0CC,IAClDD,EAAgB,EACZD,EAAM,IACJ,CAAChB,EAA2CC,IAAkB,CACtD,KAAA,CAAE,IAAAkB,GAAQnB,EAGd,OAAAnC,EAACuD,EAAA,CAEC,YAAW,GACX,IAAKR,EAAOZ,CAAI,EAChB,MAAOD,EAASC,EAAMkB,EAAYF,EAAM,OAASf,CAAK,EACtD,UAAWU,EAASX,CAAI,EACxB,MAAOa,EAASb,CAAI,EACpB,aAAcS,EACZT,EACAkB,EAAYF,EAAM,OAASf,CAAA,CAC7B,EATKkB,CAUP,CAAA,CAEJ,EAEF,MAEV,EAIA,OAAAtD,EAACwD,EAAA,CACE,GAAGzD,EACJ,QAASY,EAAc,OAAYf,EACnC,QAAAE,EACA,SAAUoD,CAAA,CACZ,CAEJ"}