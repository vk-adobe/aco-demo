{"version":3,"file":"SearchBarResults.js","sources":["/@dropins/storefront-product-discovery/src/components/SearchBarResults/SearchBarResults.tsx","/@dropins/storefront-product-discovery/src/components/ProductItem/ProductItem.tsx","/@dropins/storefront-product-discovery/src/containers/SearchBarResults/SearchBarResults.tsx"],"sourcesContent":["/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { FunctionComponent, VNode } from 'preact';\nimport { HTMLAttributes, useEffect, useRef, useCallback } from 'preact/compat';\nimport { VComponent } from '@adobe-commerce/elsie/lib';\n\nimport '@/plp/components/SearchBarResults/SearchBarResults.css';\n\nexport interface SearchBarResultsProps extends HTMLAttributes<HTMLDivElement> {\n  productList?: VNode[];\n  viewAllButton?: VNode;\n  onClose?: () => void;\n}\n\nexport const SearchBarResults: FunctionComponent<SearchBarResultsProps> = ({\n  productList,\n  viewAllButton,\n  onClose,\n  ...props\n}) => {\n  const hasData = productList && productList.length > 0;\n  const popoverRef = useRef<HTMLDivElement>(null);\n\n  const handleClickOutside = useCallback(\n    (event: MouseEvent) => {\n      if (popoverRef.current && !popoverRef.current.contains(event.target as Node)) {\n        onClose?.();\n      }\n    },\n    [onClose],\n  );\n\n  const handleEscapeKey = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose?.();\n      }\n    },\n    [onClose],\n  );\n\n  useEffect(() => {\n    if (!hasData) return;\n\n    document.addEventListener('mousedown', handleClickOutside);\n    document.addEventListener('keydown', handleEscapeKey);\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n      document.removeEventListener('keydown', handleEscapeKey);\n    };\n  }, [hasData, handleClickOutside, handleEscapeKey]);\n\n  if (!hasData) return null;\n\n  return (\n    <div className=\"product-discovery--search-bar-results\" {...props}>\n      <div\n        className=\"product-discovery--search-bar-results__popover\"\n        ref={popoverRef}\n        role=\"region\"\n        aria-label=\"Search results\"\n        aria-live=\"polite\"\n      >\n        <div\n          className=\"product-discovery--search-bar-results__grid\"\n          role=\"list\"\n          aria-label={`${productList?.length || 0} search results`}\n        >\n          {productList?.map((item, index) => (\n            <div key={index} role=\"listitem\">\n              {item}\n            </div>\n          ))}\n        </div>\n        {viewAllButton && (\n          <div className=\"product-discovery--search-bar-results__view-all-wrapper\">\n            <VComponent className=\"product-discovery--search-bar-results__view-all-button\" node={viewAllButton} />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n ***************************************************************************/\n\nimport { FunctionComponent, VNode } from 'preact';\nimport { HTMLAttributes, useMemo } from 'preact/compat';\nimport { VComponent } from '@adobe-commerce/elsie/lib';\nimport { Product } from '@/plp/data/models/product';\n\nimport '@/plp/components/ProductItem/ProductItem.css';\n\nexport interface ProductItemProps extends HTMLAttributes<HTMLDivElement> {\n  productItem: Product;\n  productImage?: VNode;\n  productName?: VNode;\n  productPrice?: VNode;\n}\n\nexport const ProductItem: FunctionComponent<ProductItemProps> = ({\n  productItem,\n  productImage,\n  productName,\n  productPrice,\n  ...props\n}) => {\n  const productData = useMemo(() => {\n    const { name = '', sku = '', url = '' } = productItem || {};\n\n    // create tooltip text depending on available data\n    const tooltipText = [name, sku && `SKU: ${sku}`].filter(Boolean).join('\\n');\n\n    return { tooltipText, url };\n  }, [productItem]);\n\n  return (\n    <a\n      className=\"product-discovery--product-item\"\n      href={productData.url}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      title={productData.tooltipText}\n      {...props}\n    >\n      <div className=\"product-discovery--product-item__image\">\n        <VComponent node={productImage} />\n      </div>\n      <div className=\"product-discovery--product-item__details\">\n        <VComponent node={productName} />\n        <VComponent node={productPrice} />\n      </div>\n    </a>\n  );\n};\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { HTMLAttributes, useState, useEffect, useCallback } from 'preact/compat';\nimport { Button, Image, Price } from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { Container, Slot, SlotProps } from '@adobe-commerce/elsie/lib';\nimport { events } from '@adobe-commerce/event-bus';\n\nimport { Product, SearchInputRequest, SearchInputResult } from '@/plp/data/models/product';\nimport { SearchVariables } from '@/plp/data/models/api';\nimport { SearchBarResults as SearchBarResultsComponent } from '@/plp/components/SearchBarResults';\nimport { ProductItem as ProductItemComponent } from '@/plp/components/ProductItem';\n\nexport interface SearchBarResultsProps extends HTMLAttributes<HTMLDivElement> {\n  products?: Product[];\n  routeSearch?: (searchQuery: string) => void;\n  slots?: {\n    ProductImage?: SlotProps;\n    ProductName?: SlotProps;\n    ProductPrice?: SlotProps;\n  };\n}\n\nexport const SearchBarResults: Container<SearchBarResultsProps> = ({\n  products = [],\n  routeSearch = () => {},\n  slots,\n}) => {\n  const [searchResults, setSearchResults] = useState<Product[]>(products);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [showResults, setShowResults] = useState(products.length > 0);\n\n  const translations = useText({ viewAllButton: 'Search.SearchInput.viewAllButton' });\n\n  useEffect(() => {\n    const searchInputEvent = events.on('search-input/result', handleSearchInputResult);\n\n    return () => {\n      searchInputEvent?.off();\n    };\n  }, []);\n\n  const handleSearchInputResult = ({\n    result = [],\n    request = {},\n  }: {\n    result?: Product[];\n    request?: Pick<SearchVariables, 'phrase'>;\n  }) => {\n    const { phrase = '' } = request;\n    setSearchResults(result);\n    setSearchQuery(phrase);\n    setShowResults(result.length > 0 && phrase.length > 0);\n  };\n\n  const handleOnClose = useCallback(() => {\n    // if a `routeSearch` cb function is provided, use it to handle any navigation needed\n    routeSearch && routeSearch(searchQuery);\n\n    // emit \"search/request\" event to trigger listeners of the search event\n    events.emit('search/request', { phrase: searchQuery } as SearchInputRequest);\n\n    // emit \"search-input/result\" event with empty payloads to clear anything listening for that\n    events.emit('search-input/result', {\n      result: [],\n      request: { phrase: '' },\n    } as SearchInputResult);\n\n    setShowResults(false);\n  }, [routeSearch, searchQuery]);\n\n  const getProductImage = (productItem: Product) => (\n    <Slot name=\"ProductImage\" slot={slots?.ProductImage} context={{ productItem }}>\n      <Image src={productItem?.images?.[0]?.url || ''} />\n    </Slot>\n  );\n\n  const getProductName = (productItem: Product) => (\n    <Slot name=\"ProductName\" slot={slots?.ProductName} context={{ productItem }}>\n      {productItem?.name || ''}\n    </Slot>\n  );\n\n  const getProductPrice = (productItem: Product) => {\n    const { value, currency } = productItem?.priceRange?.minimum?.final?.amount || {};\n    return (\n      <Slot name=\"ProductPrice\" slot={slots?.ProductPrice} context={{ productItem }}>\n        <Price amount={typeof value === 'number' ? value : undefined} currency={currency} />\n      </Slot>\n    );\n  };\n\n  const productContainer = (productItem: Product) => (\n    <ProductItemComponent\n      productItem={productItem}\n      productImage={getProductImage(productItem)}\n      productName={getProductName(productItem)}\n      productPrice={getProductPrice(productItem)}\n    />\n  );\n\n  const viewAllButton = () => (\n    <Button\n      variant=\"tertiary\"\n      onClick={() => {\n        handleOnClose();\n      }}\n    >\n      {translations.viewAllButton}\n    </Button>\n  );\n\n  const searchBarResultsContainer = () =>\n    searchResults.length > 0 &&\n    showResults && (\n      <SearchBarResultsComponent\n        productList={searchResults?.map((product) => productContainer(product))}\n        viewAllButton={viewAllButton()}\n        onClose={handleOnClose}\n      />\n    );\n\n  return <div>{searchBarResultsContainer()}</div>;\n};\n"],"names":["SearchBarResults","productList","viewAllButton","onClose","props","hasData","popoverRef","useRef","handleClickOutside","useCallback","event","handleEscapeKey","useEffect","jsx","jsxs","item","index","VComponent","ProductItem","productItem","productImage","productName","productPrice","productData","useMemo","name","sku","url","products","routeSearch","slots","searchResults","setSearchResults","useState","searchQuery","setSearchQuery","showResults","setShowResults","translations","useText","searchInputEvent","events","handleSearchInputResult","result","request","phrase","handleOnClose","getProductImage","Slot","Image","_b","_a","getProductName","getProductPrice","value","currency","_c","Price","productContainer","ProductItemComponent","Button","SearchBarResultsComponent","product"],"mappings":"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"}