{"version":3,"file":"resetCart.js","sources":["/@dropins/storefront-cart/src/lib/cookies.ts","/@dropins/storefront-cart/src/lib/state.ts","/@dropins/storefront-cart/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-cart/src/lib/fetch-error.ts","/@dropins/storefront-cart/src/api/resetCart/resetCart.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport function getCookie(cookieName: string) {\n  // Split the cookie string into an array of individual cookies\n  const cookies = document.cookie.split(';');\n\n  // Loop through the cookies to find the one with the specified name\n  for (let i = 0; i < cookies.length; i++) {\n    const cookie = cookies[i].trim(); // Remove leading and trailing spaces\n\n    // Check if this cookie starts with the name you're looking for\n    if (cookie.indexOf(`${cookieName}=`) === 0) {\n      // Extract and return the cookie's value\n      return cookie.substring(cookieName.length + 1);\n    }\n  }\n\n  // If the cookie is not found, return null\n  return null;\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { getCookie } from '@/cart/lib/cookies';\nimport { StoreConfigModel } from '@/cart/data/models/store-models';\nimport { getPersistedCartData } from './persisted-data';\n\ntype State = {\n  state: {\n    displayMiniCart: boolean;\n    miniCartMaxItemsDisplay: number;\n    cartExpiresInDays: number;\n    cartSummaryDisplayTotal: number;\n    defaultCountry: string;\n    categoryFixedProductTaxDisplaySetting: string;\n    productFixedProductTaxDisplaySetting: string;\n    salesFixedProductTaxDisplaySetting: string;\n    useConfigurableParentThumbnail: boolean;\n    shoppingCartDisplaySetting: {\n      zeroTax: boolean;\n      subtotal: string;\n      price: string;\n      shipping: string;\n      fullSummary: boolean;\n      grandTotal: boolean;\n      taxGiftWrapping: string;\n    };\n  };\n  cartId: string | null;\n  authenticated: boolean;\n  initializing?: boolean;\n  locale?: string;\n  config?: StoreConfigModel | null;\n};\n\nconst _state: State = (() => {\n  const persistedCartData = getPersistedCartData();\n  const isAuthenticated = persistedCartData\n    ? !persistedCartData.isGuestCart\n    : false;\n  return {\n    cartId: null,\n    authenticated: isAuthenticated,\n  };\n})();\n\n// Proxy state to allow reactivity\nexport const state = new Proxy(_state, {\n  set(target, key, value) {\n    // @ts-ignore\n    target[key] = value;\n\n    if (key === 'cartId') {\n      // only update cookie if value has changed\n      if (value === state.cartId) return true;\n\n      if (value === null) {\n        // remove cookie\n        document.cookie = `DROPIN__CART__CART-ID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;\n        return true;\n      }\n\n      // get expiration days from config\n      const expiresInDays = state.config?.cartExpiresInDays;\n\n      if (!expiresInDays) {\n        console.warn(\n          'Missing \"expiresInDays\" config. Cookie expiration will default to 30 days.'\n        );\n      }\n\n      // set expiration date\n      const expires = new Date();\n      expires.setDate(expires.getDate() + (expiresInDays ?? 30));\n\n      // set cookie\n      document.cookie = `DROPIN__CART__CART-ID=${value}; expires=${expires.toUTCString()}; path=/`;\n    }\n\n    return true;\n  },\n  get(target, key) {\n    if (key === 'cartId') {\n      // get value from cookie\n      return getCookie('DROPIN__CART__CART-ID');\n    }\n\n    return target[key as keyof State];\n  },\n});\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\nexport const {\n  setEndpoint,\n  setFetchGraphQlHeader,\n  removeFetchGraphQlHeader,\n  setFetchGraphQlHeaders,\n  fetchGraphQl,\n  getConfig,\n} = new FetchGraphQL().getMethods();\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { resetCart } from '../api';\n\n/** Actions */\nexport const handleFetchError = (\n  errors: Array<{\n    message: string;\n    path: Array<string>;\n    extensions: { category: string };\n  }>\n) => {\n  const unauthorized =\n    errors.findIndex(\n      ({ extensions }) => extensions?.category === 'graphql-authorization'\n    ) > -1;\n\n  // Exclude invalid Coupon error\n  const missingCart =\n    errors.findIndex(\n      ({ path, extensions }) =>\n        extensions?.category === 'graphql-no-such-entity' &&\n        !path?.includes('applyCouponsToCart')\n    ) > -1;\n\n  const errorMessage = errors.map((e: any) => e.message).join(' ');\n\n  // Invalid cart\n  const invalidCart =\n    errors.findIndex(\n      ({ path, extensions }) =>\n        extensions?.category === 'graphql-input' &&\n        path?.includes('cart')\n    ) > -1;\n\n  // Reset cart data if unauthorized or missing cart or invalid cart\n  if (unauthorized || missingCart || invalidCart) {\n    resetCart();\n    console.error(errorMessage);\n    return null;\n  }\n\n  throw Error(errorMessage);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { state } from '@/cart/lib/state';\nimport { CartModel } from '@/cart/data/models';\n\nexport const resetCart = (): Promise<CartModel | null> => {\n  state.cartId = null;\n  state.authenticated = false;\n\n  return Promise.resolve(null);\n};\n"],"names":["getCookie","cookieName","cookies","i","cookie","_state","persistedCartData","getPersistedCartData","state","target","key","value","expiresInDays","_a","expires","setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","fetchGraphQl","getConfig","FetchGraphQL","handleFetchError","errors","unauthorized","extensions","missingCart","path","errorMessage","e","invalidCart","resetCart"],"mappings":"2IAiBO,SAASA,EAAUC,EAAoB,CAE5C,MAAMC,EAAU,SAAS,OAAO,MAAM,GAAG,EAGzC,QAASC,EAAI,EAAGA,EAAID,EAAQ,OAAQC,IAAK,CACvC,MAAMC,EAASF,EAAQC,CAAC,EAAE,KAAK,EAG/B,GAAIC,EAAO,QAAQ,GAAGH,CAAU,GAAG,IAAM,EAEvC,OAAOG,EAAO,UAAUH,EAAW,OAAS,CAAC,CAC/C,CAIK,OAAA,IACT,CCeA,MAAMI,GAAiB,IAAM,CAC3B,MAAMC,EAAoBC,EAAqB,EAIxC,MAAA,CACL,OAAQ,KACR,cALsBD,EACpB,CAACA,EAAkB,YACnB,EAIJ,CACF,GAAG,EAGUE,EAAQ,IAAI,MAAMH,EAAQ,CACrC,IAAII,EAAQC,EAAKC,EAAO,OAItB,GAFAF,EAAOC,CAAG,EAAIC,EAEVD,IAAQ,SAAU,CAEhB,GAAAC,IAAUH,EAAM,OAAe,MAAA,GAEnC,GAAIG,IAAU,KAEZ,gBAAS,OAAS,wEACX,GAIH,MAAAC,GAAgBC,EAAAL,EAAM,SAAN,YAAAK,EAAc,kBAE/BD,GACK,QAAA,KACN,4EACF,EAII,MAAAE,MAAc,KACpBA,EAAQ,QAAQA,EAAQ,QAAQ,GAAKF,GAAiB,GAAG,EAGzD,SAAS,OAAS,yBAAyBD,CAAK,aAAaG,EAAQ,YAAa,CAAA,UAAA,CAG7E,MAAA,EACT,EACA,IAAIL,EAAQC,EAAK,CACf,OAAIA,IAAQ,SAEHV,EAAU,uBAAuB,EAGnCS,EAAOC,CAAkB,CAAA,CAEpC,CAAC,ECpFY,CACX,YAAAK,EACA,sBAAAC,EACA,yBAAAC,EACA,uBAAAC,EACA,aAAAC,EACA,UAAAC,CACF,EAAI,IAAIC,EAAa,EAAE,WAAW,ECNrBC,EACXC,GAKG,CACH,MAAMC,EACJD,EAAO,UACL,CAAC,CAAE,WAAAE,CAAW,KAAMA,GAAA,YAAAA,EAAY,YAAa,uBAAA,EAC3C,GAGAC,EACJH,EAAO,UACL,CAAC,CAAE,KAAAI,EAAM,WAAAF,CAAW,KAClBA,GAAA,YAAAA,EAAY,YAAa,0BACzB,EAACE,GAAA,MAAAA,EAAM,SAAS,sBAAoB,EACpC,GAEAC,EAAeL,EAAO,IAAKM,GAAWA,EAAE,OAAO,EAAE,KAAK,GAAG,EAGzDC,EACJP,EAAO,UACL,CAAC,CAAE,KAAAI,EAAM,WAAAF,MACPA,GAAA,YAAAA,EAAY,YAAa,kBACzBE,GAAA,YAAAA,EAAM,SAAS,QAAM,EACrB,GAGF,GAAAH,GAAgBE,GAAeI,EACvB,OAAAC,EAAA,EACV,QAAQ,MAAMH,CAAY,EACnB,KAGT,MAAM,MAAMA,CAAY,CAC1B,ECtCaG,EAAY,KACvBvB,EAAM,OAAS,KACfA,EAAM,cAAgB,GAEf,QAAQ,QAAQ,IAAI"}