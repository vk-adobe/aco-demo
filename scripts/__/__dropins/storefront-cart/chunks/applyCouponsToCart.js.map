{"version":3,"file":"applyCouponsToCart.js","sources":["/@dropins/storefront-cart/src/api/applyCouponsToCart/graphql/ApplyCouponsToCartMutation.ts","/@dropins/storefront-cart/src/api/applyCouponsToCart/applyCouponsToCart.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CART_FRAGMENT } from '@/cart/api/graphql/CartFragment';\nimport { CART_ITEMS_PAGINATION_ARGUMENTS } from '@/cart/api/graphql/arguments';\n\nexport const APPLY_COUPONS_TO_CART_MUTATION = `\nmutation APPLY_COUPONS_TO_CART_MUTATION(\n    $cartId: String!, \n    $couponCodes: [String!]!, \n    $type: ApplyCouponsStrategy!,\n    ${CART_ITEMS_PAGINATION_ARGUMENTS}\n  ) {\n   applyCouponsToCart(\n    input: {\n      cart_id: $cartId\n      coupon_codes: $couponCodes \n      type: $type\n    }\n  ) {\n    cart {\n      ...CART_FRAGMENT\n    }\n\n  }\n}\n${CART_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { state } from '@/cart/lib/state';\nimport { fetchGraphQl } from '@/cart/api';\nimport { handleFetchError } from '@/cart/lib/fetch-error';\nimport { CartModel } from '@/cart/data/models';\nimport { transformCart } from '@/cart/data/transforms';\nimport { events } from '@adobe-commerce/event-bus';\n\nimport { APPLY_COUPONS_TO_CART_MUTATION } from './graphql/ApplyCouponsToCartMutation';\n\nexport interface ApplyCouponsToCartInput {\n  type: ApplyCouponsStrategy;\n}\n\nexport enum ApplyCouponsStrategy {\n  APPEND = 'APPEND',\n  REPLACE = 'REPLACE',\n}\n\nexport const applyCouponsToCart = async (\n  couponCodes: string[],\n  type: ApplyCouponsStrategy\n): Promise<CartModel | null> => {\n  const cartId = state.cartId;\n\n  if (!cartId) {\n    throw Error('Cart ID is not set');\n  }\n\n  return fetchGraphQl(APPLY_COUPONS_TO_CART_MUTATION, {\n    variables: {\n      cartId,\n      couponCodes,\n      type,\n    },\n  }).then(({ errors, data }) => {\n    // handle errors\n    const _errors = [\n      ...(data?.applyCouponsToCart?.user_errors ?? []),\n      ...(errors ?? []),\n    ];\n\n    if (_errors.length > 0) return handleFetchError(_errors);\n\n    // transform cart\n    const payload = transformCart(data.applyCouponsToCart.cart);\n\n    // emit events\n    events.emit('cart/updated', payload);\n    events.emit('cart/data', payload);\n\n    return payload;\n  });\n};\n"],"names":["APPLY_COUPONS_TO_CART_MUTATION","CART_ITEMS_PAGINATION_ARGUMENTS","CART_FRAGMENT","ApplyCouponsStrategy","applyCouponsToCart","couponCodes","type","cartId","state","fetchGraphQl","errors","data","_errors","_a","handleFetchError","payload","transformCart","events"],"mappings":"kMAoBO,MAAMA,EAAiC;AAAA;AAAA;AAAA;AAAA;AAAA,MAKxCC,CAA+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAenCC,CAAa;AAAA,ECVH,IAAAC,GAAAA,IACVA,EAAA,OAAS,SACTA,EAAA,QAAU,UAFAA,IAAAA,GAAA,CAAA,CAAA,EAKC,MAAAC,EAAqB,MAChCC,EACAC,IAC8B,CAC9B,MAAMC,EAASC,EAAM,OAErB,GAAI,CAACD,EACH,MAAM,MAAM,oBAAoB,EAGlC,OAAOE,EAAaT,EAAgC,CAClD,UAAW,CACT,OAAAO,EACA,YAAAF,EACA,KAAAC,CAAA,CAEH,CAAA,EAAE,KAAK,CAAC,CAAE,OAAAI,EAAQ,KAAAC,KAAW,OAE5B,MAAMC,EAAU,CACd,KAAIC,EAAAF,GAAA,YAAAA,EAAM,qBAAN,YAAAE,EAA0B,cAAe,CAAC,EAC9C,GAAIH,GAAU,CAAA,CAChB,EAEA,GAAIE,EAAQ,OAAS,EAAG,OAAOE,EAAiBF,CAAO,EAGvD,MAAMG,EAAUC,EAAcL,EAAK,mBAAmB,IAAI,EAGnD,OAAAM,EAAA,KAAK,eAAgBF,CAAO,EAC5BE,EAAA,KAAK,YAAaF,CAAO,EAEzBA,CAAA,CACR,CACH"}