{"version":3,"file":"ProductGallery.js","sources":["/@dropins/storefront-pdp/src/containers/ProductGallery/ProductGallery.tsx"],"sourcesContent":["import { HTMLAttributes, useEffect, useMemo, useState } from 'preact/compat';\nimport {\n  Container,\n  ResolveImageUrlOptions,\n  Slot,\n  SlotProps,\n} from '@adobe-commerce/elsie/lib';\n\nimport { Image, ImageProps } from '@adobe-commerce/elsie/components';\nimport { events } from '@adobe-commerce/event-bus';\nimport { ProductModel } from '@/pdp/data/models/product-model';\nimport { getFetchedProductData } from '@/pdp/api';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { Carousel, Overlay, Zoom } from '@/pdp/components';\n\ntype DefaultSlotContext = {\n  data: ProductModel | null;\n};\n\nexport interface ProductGalleryProps\n  extends Omit<HTMLAttributes<HTMLDivElement>, 'controls'> {\n  controls?: 'thumbnailsRow' | 'thumbnailsColumn' | 'dots' | null;\n  loop?: boolean;\n  peak?: boolean;\n  gap?: 'small' | 'medium' | 'large' | null;\n  arrows?: boolean;\n  arrowsOnMainImage?: boolean;\n  imageParams?: ResolveImageUrlOptions;\n  thumbnailParams?: ResolveImageUrlOptions;\n  zoom?: { closeButton: boolean } | boolean;\n  slots?: {\n    CarouselThumbnail?: SlotProps<\n      DefaultSlotContext & { defaultImageProps: ImageProps }\n    >;\n    CarouselMainImage?: SlotProps<\n      DefaultSlotContext & { defaultImageProps: ImageProps }\n    >;\n  };\n}\n\nexport const ProductGallery: Container<\n  ProductGalleryProps,\n  ProductModel | null\n> = ({\n  initialData = null,\n  controls = 'dots',\n  loop = true,\n  peak = false,\n  gap = null,\n  arrows = true,\n  arrowsOnMainImage = false,\n  zoom = false,\n  imageParams,\n  thumbnailParams,\n  children,\n  slots,\n  ...props\n}) => {\n  const ImagesLabel = useText('PDP.Product.Image.label').label;\n\n  const [data, setData] = useState<ProductModel | null>(initialData);\n\n  const [zoomTo, setZoomTo] = useState<number | null>(null);\n\n  useEffect(() => {\n    const dataEvent = events.on('pdp/data', setData);\n    return () => {\n      dataEvent?.off();\n    };\n  }, []);\n\n  const defaultSlotContext: DefaultSlotContext = useMemo(\n    () => ({ data }),\n    [data]\n  );\n\n  const images = useMemo(\n    () =>\n      data?.images?.map(({ label, url }, key) => {\n        const Item = ({ ...itemProps }) => {\n          const defaultProps = {\n            title: label,\n            src: url,\n            alt: ImagesLabel?.replace('{product}', label)\n              .replace('{key}', String(key + 1))\n              .replace('{total}', String(data?.images?.length)),\n\n            // TODO: change width/height for image aspect ratio\n            // pending https://jira.corp.adobe.com/browse/DATA-5122\n            width: imageParams?.width ?? 960,\n            height: imageParams?.height ?? 1191,\n            params: imageParams ?? { width: 960 },\n            loading: key === 0 ? 'eager' : 'lazy',\n            ...itemProps,\n          } as const;\n\n          return (\n            <Slot\n              name=\"CarouselMainImage\"\n              slot={slots?.CarouselMainImage}\n              context={{\n                ...defaultSlotContext,\n                defaultImageProps: defaultProps,\n              }}\n            >\n              <Image {...defaultProps} />\n            </Slot>\n          );\n        };\n\n        return zoom ? (\n          <Zoom\n            key={url}\n            closeButton={typeof zoom === 'object' ? zoom.closeButton : false}\n          >\n            <Item />\n          </Zoom>\n        ) : (\n          <Item key={url} onClick={() => setZoomTo(key)} />\n        );\n      }) ?? (\n        <img\n          key=\"pleaceholder\"\n          src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n          className=\"pdp-product-gallery__images__placeholder\"\n          width={imageParams?.width ?? 960}\n          height={imageParams?.height ?? 1191}\n          aria-hidden\n        />\n      ),\n    [\n      ImagesLabel,\n      data?.images,\n      imageParams,\n      zoom,\n      defaultSlotContext,\n      slots?.CarouselMainImage,\n    ]\n  );\n\n  const thumbnails = useMemo(() => {\n    return (\n      data?.images?.map(({ label, url }, key) => {\n        const defaultProps = {\n          title: label,\n          src: url,\n          alt: ImagesLabel?.replace('{product}', label)\n            .replace('{key}', String(key + 1))\n            .replace('{total}', String(data?.images?.length)),\n\n          // TODO: change width/height for image aspect ratio\n          // pending https://jira.corp.adobe.com/browse/DATA-5122\n          width: thumbnailParams?.width ?? 200,\n          height: thumbnailParams?.height ?? 248,\n          params: thumbnailParams ?? { width: 200 },\n          loading: 'lazy',\n        } as const;\n\n        return (\n          <Slot\n            key={url}\n            name=\"CarouselThumbnail\"\n            slotTag=\"span\"\n            contentTag=\"span\"\n            slot={slots?.CarouselThumbnail}\n            context={{\n              ...defaultSlotContext,\n              defaultImageProps: defaultProps,\n            }}\n          >\n            <Image {...defaultProps} />\n          </Slot>\n        );\n      }) ?? (\n        <img\n          key=\"pleaceholder\"\n          src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n          className=\"pdp-product-gallery__thumbnail__placeholder\"\n          width={thumbnailParams?.width ?? 200}\n          height={thumbnailParams?.height ?? 248}\n          aria-hidden\n        />\n      )\n    );\n  }, [\n    ImagesLabel,\n    data?.images,\n    thumbnailParams,\n    defaultSlotContext,\n    slots?.CarouselThumbnail,\n  ]);\n\n  if (!data) return null;\n\n  return (\n    <div {...props}>\n      {/* Carousel */}\n      <Carousel\n        arrows={!!data?.images?.length && arrows}\n        arrowsOnMainImage={arrowsOnMainImage}\n        controls={data?.images?.length ? controls : undefined}\n        loop={loop && !!data.images?.length}\n        peak={!!data?.images?.length && peak}\n        gap={gap}\n        defaultIndex={zoomTo || 0}\n        thumbnails={thumbnails}\n      >\n        {images}\n      </Carousel>\n\n      {/* Zoom Overlay */}\n      {zoomTo === null ? null : (\n        <Overlay onClose={() => setZoomTo(null)} centered>\n          <Carousel\n            arrows={!!data?.images?.length}\n            width=\"100%\"\n            height=\"100%\"\n            defaultIndex={zoomTo}\n            loop={loop && !!data.images?.length}\n            controls=\"dots\"\n            isZoomed\n          >\n            {images}\n          </Carousel>\n        </Overlay>\n      )}\n    </div>\n  );\n};\n\nProductGallery.getInitialData = getFetchedProductData;\n"],"names":["ProductGallery","initialData","controls","loop","peak","gap","arrows","arrowsOnMainImage","zoom","imageParams","thumbnailParams","children","slots","props","ImagesLabel","useText","data","setData","useState","zoomTo","setZoomTo","useEffect","dataEvent","events","defaultSlotContext","useMemo","images","_a","label","url","key","Item","itemProps","defaultProps","jsx","Slot","Image","Zoom","thumbnails","jsxs","Carousel","_b","_c","_d","Overlay","_e","_f","getFetchedProductData"],"mappings":"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"}