{"version":3,"file":"ProductQuantity.js","sources":["/@dropins/storefront-pdp/src/containers/ProductQuantity/ProductQuantity.tsx"],"sourcesContent":["/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { HTMLAttributes, useEffect, useState } from 'preact/compat';\nimport { classes, Container } from '@adobe-commerce/elsie/lib';\nimport { Incrementer } from '@adobe-commerce/elsie/components';\nimport { events } from '@adobe-commerce/event-bus';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { ProductModel } from '@/pdp/data/models';\nimport {\n  setProductConfigurationValues,\n  getFetchedProductData,\n} from '@/pdp/api';\nimport {\n  setUrlParams,\n  getValidatedQuantityFromUrl,\n} from '@/pdp/lib/url-params';\nimport { config } from '@/pdp/api/initialize';\n\nexport interface ProductQuantityProps extends HTMLAttributes<HTMLDivElement> {\n  onValue?: (quantity: number) => void;\n}\n\nexport const ProductQuantity: Container<\n  ProductQuantityProps,\n  ProductModel | null\n> = ({ initialData = null, onValue, children, ...props }) => {\n  const IncrementerLabel = useText('PDP.Product.Incrementer.label').label;\n\n  const [data, setData] = useState<ProductModel | null>(initialData);\n\n  const [current, setCurrent] = useState(() => getValidatedQuantityFromUrl(1)); // Default quantity to 1\n\n  useEffect(() => {\n    const dataEvent = events.on('pdp/data', setData);\n\n    const valuesEvent = events.on(\n      'pdp/values',\n      ({ quantity }) => {\n        setCurrent(quantity);\n      },\n      { eager: true }\n    );\n\n    return () => {\n      dataEvent?.off();\n      valuesEvent?.off();\n    };\n  }, []);\n\n  const handleOnValue = (value: string) => {\n    const quantity = parseInt(value, 10);\n    setProductConfigurationValues((prev) => ({ ...prev, quantity }));\n\n    // Update URL parameters if persistURLParams is enabled\n    const { persistURLParams } = config.getConfig() ?? {};\n    if (persistURLParams) {\n      setUrlParams({ quantity });\n    }\n\n    onValue?.(quantity);\n  };\n\n  if (!data) return null;\n\n  return (\n    <Incrementer\n      key=\"quantity\"\n      name=\"quantity\"\n      defaultValue={String(current)}\n      value={String(current)}\n      min={1}\n      aria-label={IncrementerLabel}\n      onValue={handleOnValue}\n      {...props}\n      className={classes(['pdp-quantity', props.className])}\n    />\n  );\n};\n\nProductQuantity.getInitialData = getFetchedProductData;\n"],"names":["ProductQuantity","initialData","onValue","children","props","IncrementerLabel","useText","data","setData","useState","current","setCurrent","getValidatedQuantityFromUrl","useEffect","dataEvent","events","valuesEvent","quantity","handleOnValue","value","setProductConfigurationValues","prev","persistURLParams","config","setUrlParams","jsx","Incrementer","classes","getFetchedProductData"],"mappings":"+hBAoCa,MAAAA,EAGT,CAAC,CAAE,YAAAC,EAAc,KAAM,QAAAC,EAAS,SAAAC,EAAU,GAAGC,KAAY,CACrD,MAAAC,EAAmBC,EAAQ,+BAA+B,EAAE,MAE5D,CAACC,EAAMC,CAAO,EAAIC,EAA8BR,CAAW,EAE3D,CAACS,EAASC,CAAU,EAAIF,EAAS,IAAMG,EAA4B,CAAC,CAAC,EAE3EC,EAAU,IAAM,CACd,MAAMC,EAAYC,EAAO,GAAG,WAAYP,CAAO,EAEzCQ,EAAcD,EAAO,GACzB,aACA,CAAC,CAAE,SAAAE,CAAA,IAAe,CAChBN,EAAWM,CAAQ,CACrB,EACA,CAAE,MAAO,EAAK,CAChB,EAEA,MAAO,IAAM,CACXH,GAAA,MAAAA,EAAW,MACXE,GAAA,MAAAA,EAAa,KACf,CACF,EAAG,EAAE,EAEC,MAAAE,EAAiBC,GAAkB,CACjC,MAAAF,EAAW,SAASE,EAAO,EAAE,EACnCC,EAA+BC,IAAU,CAAE,GAAGA,EAAM,SAAAJ,CAAW,EAAA,EAG/D,KAAM,CAAE,iBAAAK,CAAiB,EAAIC,EAAO,aAAe,CAAC,EAChDD,GACWE,EAAA,CAAE,SAAAP,EAAU,EAG3Bf,GAAA,MAAAA,EAAUe,EACZ,EAEI,OAACV,EAGHkB,EAACC,EAAA,CAEC,KAAK,WACL,aAAc,OAAOhB,CAAO,EAC5B,MAAO,OAAOA,CAAO,EACrB,IAAK,EACL,aAAYL,EACZ,QAASa,EACR,GAAGd,EACJ,UAAWuB,EAAQ,CAAC,eAAgBvB,EAAM,SAAS,CAAC,CAAA,EARhD,UASN,EAbgB,IAepB,EAEAJ,EAAgB,eAAiB4B"}