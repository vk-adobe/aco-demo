import{createElement as t}from"../../external/preact/dist/preact.js";import{UIElement as e}from"../internal/UIElement/UIElement.js";import o from"./components/UPIComponent/UPIComponent.js";import{CoreProvider as r}from"../../core/Context/CoreProvider.js";import n from"../internal/Await/Await.js";import i from"../internal/QRLoader/QRLoader.js";import p from"../../core/Errors/SRPanelProvider.js";import{TxVariants as s}from"../tx-variants.js";import a from"../../utils/isMobile.js";function d(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function l(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable})))),r.forEach((function(e){d(t,e,o[e])}))}return t}function u(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e.push.apply(e,o)}return e}(Object(e)).forEach((function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(e,o))})),t}class c extends e{formatProps(t){var e,o;if(!a())return u(l({},super.formatProps(t)),{defaultMode:null!==(o=null==t?void 0:t.defaultMode)&&void 0!==o?o:"qrCode",apps:[]});const r=(null===(e=t.apps)||void 0===e?void 0:e.length)>0,n=r?"intent":"vpa",i=[n,"qrCode"],p={id:"vpa",name:t.i18n.get("upi.collect.dropdown.label"),type:s.upi_collect},d=r?[...t.apps.map((t=>u(l({},t),{type:s.upi_intent}))),p]:[];return u(l({},super.formatProps(t)),{defaultMode:i.includes(null==t?void 0:t.defaultMode)?t.defaultMode:n,apps:d})}get isValid(){return this.state.isValid}formatData(){const{virtualPaymentAddress:t,app:e}=this.state.data||{};return{paymentMethod:l({},this.paymentType&&{type:this.paymentType},this.paymentType===s.upi_collect&&t&&{virtualPaymentAddress:t},this.paymentType===s.upi_intent&&(null==e?void 0:e.id)&&{appId:e.id})}}get paymentType(){var t,e;return"qrCode"===this.selectedMode?s.upi_qr:"vpa"===this.selectedMode?s.upi_collect:null===(e=this.state.data)||void 0===e||null===(t=e.app)||void 0===t?void 0:t.type}renderContent(e,r,p){switch(e){case"qrCode":return t(i,u(l({ref:t=>{this.componentRef=t}},this.props),{qrCodeData:this.props.qrCodeData?encodeURIComponent(this.props.qrCodeData):null,type:s.upi_qr,brandLogo:this.props.brandLogo||this.icon,onComplete:this.onComplete,introduction:this.props.i18n.get("upi.qrCodeWaitingMessage"),countdownTime:5,onActionHandled:this.onActionHandled}));case"await":return t(n,{ref:t=>{this.componentRef=t},url:r,type:p,showCountdownTimer:!0,shouldRedirectAutomatically:!0,countdownTime:5,clientKey:this.props.clientKey,paymentData:this.props.paymentData,onActionHandled:this.onActionHandled,onError:this.props.onError,messageText:this.props.i18n.get("upi.vpaWaitingMessage"),awaitText:this.props.i18n.get("await.waitForConfirmation"),onComplete:this.onComplete,brandLogo:this.icon});default:return t(o,{ref:t=>{this.componentRef=t},payButton:this.payButton,onChange:this.setState,onUpdateMode:this.onUpdateMode,apps:this.props.apps,defaultMode:this.props.defaultMode,showPayButton:this.props.showPayButton})}}render(){const{type:e,url:o,paymentMethodType:n}=this.props;return t(r,{i18n:this.props.i18n,loadingContext:this.props.loadingContext,resources:this.resources},t(p,{srPanel:this.props.modules.srPanel},this.renderContent(e,o,n)))}constructor(t,e){super(t,e),d(this,"selectedMode",void 0),d(this,"onUpdateMode",(t=>{this.selectedMode=t})),this.selectedMode=this.props.defaultMode}}d(c,"type",s.upi),d(c,"txVariants",[s.upi,s.upi_qr,s.upi_collect,s.upi_intent]);export{c as default};
//# sourceMappingURL=UPI.js.map
