{"version":3,"file":"CashAppComponent.js","sources":["../../../../../src/components/CashAppPay/components/CashAppComponent.tsx"],"sourcesContent":["import { h, RefObject } from 'preact';\nimport { useCallback, useEffect, useRef, useState } from 'preact/hooks';\nimport AdyenCheckoutError from '../../../core/Errors/AdyenCheckoutError';\nimport Spinner from '../../internal/Spinner';\nimport { CashAppPayEvents, ICashAppService } from '../services/types';\nimport { CashAppPayEventData } from '../types';\nimport StoreDetails from '../../internal/StoreDetails';\nimport './CashAppComponent.scss';\nimport { UIElementStatus } from '../../internal/UIElement/types';\n\ninterface CashAppComponentProps {\n    enableStoreDetails?: boolean;\n    cashAppService: ICashAppService;\n    onClick(): void;\n    onChangeStoreDetails(data: any): void;\n    onAuthorize(payEventData: CashAppPayEventData): void;\n    onError(error: AdyenCheckoutError): void;\n    ref(ref: RefObject<typeof CashAppComponent>): void;\n}\n\nexport function CashAppComponent({\n    enableStoreDetails,\n    cashAppService,\n    onClick,\n    onChangeStoreDetails,\n    onAuthorize,\n    onError\n}: CashAppComponentProps): h.JSX.Element {\n    const cashAppRef = useRef<HTMLDivElement>(null);\n    const [status, setStatus] = useState<UIElementStatus>('loading');\n    const subscriptions = useRef<Function[]>([]);\n    const [storePaymentMethod, setStorePaymentMethod] = useState<boolean>(false);\n\n    this.setStatus = setStatus;\n\n    const initializeCashAppSdk = useCallback(async () => {\n        try {\n            await cashAppService.initialize();\n\n            subscriptions.current = [\n                cashAppService.subscribeToEvent(CashAppPayEvents.CustomerDismissed, () => {\n                    onError(new AdyenCheckoutError('CANCEL', 'Customer dismissed the modal'));\n                }),\n                cashAppService.subscribeToEvent(CashAppPayEvents.CustomerRequestDeclined, async () => {\n                    onError(new AdyenCheckoutError('ERROR', 'Payment declined by CashAppPay'));\n                    await cashAppService.restart();\n                    await cashAppService.renderButton(cashAppRef.current);\n                }),\n\n                cashAppService.subscribeToEvent(CashAppPayEvents.CustomerRequestApproved, ({ customerProfile, grants }) => {\n                    const cashAppPaymentData: CashAppPayEventData = {\n                        ...(customerProfile?.id && { customerId: customerProfile.id }),\n                        ...(customerProfile?.cashtag && { cashTag: customerProfile.cashtag }),\n                        ...(grants?.payment?.grantId && { grantId: grants.payment.grantId }),\n                        ...(grants?.onFile?.grantId && { onFileGrantId: grants.onFile.grantId })\n                    };\n\n                    onAuthorize(cashAppPaymentData);\n                }),\n                cashAppService.subscribeToEvent(CashAppPayEvents.CustomerRequestFailed, () => {\n                    onError(new AdyenCheckoutError('ERROR', 'Customer request failed'));\n                })\n            ];\n\n            await cashAppService.renderButton(cashAppRef.current);\n\n            setStatus('ready');\n        } catch (error) {\n            if (error instanceof AdyenCheckoutError) onError(error);\n            else onError(new AdyenCheckoutError('ERROR', 'Error when initializing CashAppPay', { cause: error }));\n        }\n    }, [cashAppService, onError, onAuthorize]);\n\n    useEffect(() => {\n        if (enableStoreDetails) {\n            cashAppService.setStorePaymentMethod(storePaymentMethod);\n            onChangeStoreDetails(storePaymentMethod);\n        }\n    }, [enableStoreDetails, storePaymentMethod]);\n\n    useEffect(() => {\n        void initializeCashAppSdk();\n        return () => {\n            void cashAppService.restart();\n            subscriptions.current.forEach(unsubscribeFn => unsubscribeFn());\n        };\n    }, [cashAppService, initializeCashAppSdk]);\n\n    return (\n        <div className=\"adyen-checkout__cashapp\" aria-live=\"polite\" aria-busy={status === 'loading'}>\n            {status === 'loading' && <Spinner />}\n            {status !== 'loading' && enableStoreDetails && <StoreDetails storeDetails={storePaymentMethod} onChange={setStorePaymentMethod} />}\n\n            {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions,jsx-a11y/click-events-have-key-events */}\n            <div onClick={onClick} className={'adyen-checkout__cashapp-button'} ref={cashAppRef}></div>\n        </div>\n    );\n}\n"],"names":["CashAppComponent","enableStoreDetails","cashAppService","onClick","onChangeStoreDetails","onAuthorize","onError","cashAppRef","useRef","status","setStatus","useState","subscriptions","storePaymentMethod","setStorePaymentMethod","this","initializeCashAppSdk","useCallback","async","initialize","current","subscribeToEvent","CashAppPayEvents","CustomerDismissed","AdyenCheckoutError","CustomerRequestDeclined","restart","renderButton","CustomerRequestApproved","customerProfile","grants","cashAppPaymentData","_object_spread","id","customerId","cashtag","cashTag","payment","grantId","onFile","onFileGrantId","CustomerRequestFailed","error","cause","useEffect","forEach","unsubscribeFn","h","div","className","aria-live","aria-busy","Spinner","StoreDetails","storeDetails","onChange","ref"],"mappings":"khBAoBO,SAASA,GAAiBC,mBAC7BA,EAAkBC,eAClBA,EAAcC,QACdA,EAAOC,qBACPA,EAAoBC,YACpBA,EAAWC,QACXA,IAEA,MAAMC,EAAaC,EAAuB,OACnCC,EAAQC,GAAaC,EAA0B,WAChDC,EAAgBJ,EAAmB,KAClCK,EAAoBC,GAAyBH,GAAkB,GAEtEI,KAAKL,UAAYA,EAEjB,MAAMM,EAAuBC,GAAYC,UACrC,UACUhB,EAAeiB,aAErBP,EAAcQ,QAAU,CACpBlB,EAAemB,iBAAiBC,EAAiBC,mBAAmB,KAChEjB,EAAQ,IAAIkB,EAAmB,SAAU,gCAAA,IAE7CtB,EAAemB,iBAAiBC,EAAiBG,yBAAyBP,UACtEZ,EAAQ,IAAIkB,EAAmB,QAAS,yCAClCtB,EAAewB,gBACfxB,EAAeyB,aAAapB,EAAWa,QAAO,IAGxDlB,EAAemB,iBAAiBC,EAAiBM,yBAAyB,EAAGC,kBAAiBC,iBAIlFA,EACAA,EAJR,MAAMC,wUAA0CC,CACxCH,CAAAA,GAAAA,aAAAA,EAAAA,EAAiBI,KAAM,CAAEC,WAAYL,EAAgBI,KACrDJ,aAAAA,EAAAA,EAAiBM,UAAW,CAAEC,QAASP,EAAgBM,UACvDL,SAAAA,QAAAA,EAAAA,EAAQO,eAARP,IAAAA,OAAAA,EAAAA,EAAiBQ,UAAW,CAAEA,QAASR,EAAOO,QAAQC,UACtDR,SAAAA,QAAAA,EAAAA,EAAQS,cAART,IAAAA,OAAAA,EAAAA,EAAgBQ,UAAW,CAAEE,cAAeV,EAAOS,OAAOD,UAGlEjC,EAAY0B,EAAAA,IAEhB7B,EAAemB,iBAAiBC,EAAiBmB,uBAAuB,KACpEnC,EAAQ,IAAIkB,EAAmB,QAAS,2BAAA,WAI1CtB,EAAeyB,aAAapB,EAAWa,SAE7CV,EAAU,QACd,CAAE,MAAOgC,GACoCpC,EAArCoC,aAAiBlB,EAA4BkB,EACpC,IAAIlB,EAAmB,QAAS,qCAAsC,CAAEmB,MAAOD,IAChG,IACD,CAACxC,EAAgBI,EAASD,IAiB7B,OAfAuC,GAAU,KACF3C,IACAC,EAAeY,sBAAsBD,GACrCT,EAAqBS,GACzB,GACD,CAACZ,EAAoBY,IAExB+B,GAAU,KACD5B,IACE,KACEd,EAAewB,UACpBd,EAAcQ,QAAQyB,SAAQC,GAAiBA,KAAAA,IAEpD,CAAC5C,EAAgBc,IAGhB+B,EAACC,MAAAA,CAAIC,UAAU,0BAA0BC,YAAU,SAASC,YAAsB,YAAX1C,GACvD,YAAXA,GAAwBsC,EAACK,EAAAA,MACd,YAAX3C,GAAwBR,GAAsB8C,EAACM,EAAAA,CAAaC,aAAczC,EAAoB0C,SAAUzC,IAGzGiC,EAACC,MAAAA,CAAI7C,QAASA,EAAS8C,UAAW,iCAAkCO,IAAKjD,IAGrF"}