import{createElement as t}from"../../../../external/preact/dist/preact.js";import{useRef as e,useState as a,useCallback as n,useEffect as o}from"../../../../external/preact/hooks/dist/hooks.js";import r from"../../../../utils/Script.js";import{KLARNA_WIDGET_URL as i}from"../../constants.js";function l(t,e){if(null==t)return{};var a,n,o=function(t,e){if(null==t)return{};var a,n,o={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(o[a]=t[a]);return o}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(o[a]=t[a])}return o}function s(s){var{sdkData:m,paymentMethodType:c,widgetInitializationTime:d,payButton:p}=s,y=l(s,["sdkData","paymentMethodType","widgetInitializationTime","payButton"]);const u=e(null),[f,_]=a("ready"),h=n((()=>{_("error"),y.onComplete({data:{paymentData:y.paymentData,details:{}}})}),[y.paymentData,y.onComplete]),w=n((()=>{window.Klarna.Payments.init({client_token:m.client_token}),window.Klarna.Payments.load({container:u.current,payment_method_category:m.payment_method_category},(function(t){!t.show_form||t.error?h():y.onLoaded()}))}),[m.client_token,m.payment_method_category]),k=n((()=>{_("loading");try{window.Klarna.Payments.authorize({payment_method_category:m.payment_method_category},(function(t){!0===t.approved&&!0===t.show_form?(_("success"),y.onComplete({data:{paymentData:y.paymentData,details:{authorization_token:t.authorization_token}}})):t.approved||!0!==t.show_form?h():(_("ready"),y.onError(t))}))}catch(t){h()}}),[m.payment_method_category,y.onComplete,y.onError]);return o((()=>{var t,e;(null===(e=window.Klarna)||void 0===e||null===(t=e.Payments)||void 0===t?void 0:t.init)&&w()}),[d]),o((()=>{window.klarnaAsyncCallback=function(){w()};const t=new r(i);return t.load(),()=>{t.remove()}}),[w]),"error"!==f&&"success"!==f?t("div",{className:"adyen-checkout__klarna-widget"},t("div",{ref:u}),p({status:f,disabled:"loading"===f,onClick:k})):null}export{s as KlarnaWidget};
//# sourceMappingURL=KlarnaWidget.js.map
