{"version":3,"file":"Script.js","sources":["../../../src/utils/Script.ts"],"sourcesContent":["import AdyenCheckoutError from '../core/Errors/AdyenCheckoutError';\n\ninterface IScript {\n    load(): Promise<any>;\n    remove(): HTMLScriptElement;\n}\n\n/**\n * Creates a script element from a certain source in the passed node selector.\n * If no selector is passed it will add the script element in the body.\n *\n * @example\n * ```\n * const script = new Script('https://example.com/script.js', '.container');\n * script.load().then(doSomething);\n *\n * // To clean up just call the remove method\n * script.remove();\n * ```\n */\nclass Script implements IScript {\n    private readonly src: string;\n    private readonly node: string;\n    private readonly attributes: Partial<HTMLScriptElement>;\n    private readonly dataAttributes: Record<string, string | undefined>;\n\n    private isScriptLoadCalled = false;\n    private script: HTMLScriptElement;\n\n    constructor(src, node = 'body', attributes: Partial<HTMLScriptElement> = {}, dataAttributes: Record<string, string | undefined> = {}) {\n        this.src = src;\n        this.node = node;\n        this.attributes = attributes;\n        this.dataAttributes = dataAttributes;\n    }\n\n    public load = (): Promise<void> => {\n        if (this.isScriptLoadCalled) {\n            if (process.env.NODE_ENV === 'development') console.warn(`[Warning] script.load called more than once for ${this.src}`);\n            return;\n        }\n\n        return new Promise((resolve, reject) => {\n            const handleOnLoad = () => {\n                this.script.setAttribute('data-script-loaded', 'true');\n                resolve();\n            };\n\n            const handleOnError = (errorEvent: ErrorEvent) => {\n                this.remove();\n                reject(\n                    new AdyenCheckoutError('SCRIPT_ERROR', `Unable to load script ${this.src}. Message: ${errorEvent.message}`, {\n                        cause: errorEvent.error\n                    })\n                );\n            };\n\n            this.isScriptLoadCalled = true;\n\n            const scriptContainer: Element = document.querySelector(this.node);\n            this.script = scriptContainer.querySelector(`script[src=\"${this.src}\"]`);\n\n            // Script element exists in the browser and is already loaded\n            if (this.script && this.script.getAttribute('data-script-loaded')) {\n                resolve();\n                return;\n            } else if (this.script) {\n                // Script element exists in the browser, but it is not loaded yet\n                // Use-case:  Multiple PayPal standalone components being loaded in different parts of the screen.\n                this.script.addEventListener('load', handleOnLoad);\n                this.script.addEventListener('error', handleOnError);\n                return;\n            }\n\n            // Script element doesn't exist in the browser, so we create it and append to the DOM tree\n            this.script = document.createElement('script');\n            Object.assign(this.script, this.attributes);\n            Object.assign(this.script.dataset, this.dataAttributes);\n\n            this.script.src = this.src;\n            this.script.async = true;\n\n            this.script.addEventListener('load', handleOnLoad);\n            this.script.addEventListener('error', handleOnError);\n\n            scriptContainer.appendChild(this.script);\n        });\n    };\n\n    public remove = (): HTMLScriptElement => {\n        return this.script.parentNode && this.script.parentNode.removeChild(this.script);\n    };\n}\n\nexport default Script;\n"],"names":["Script","constructor","src","node","attributes","dataAttributes","_define_property","this","isScriptLoadCalled","script","load","Promise","resolve","reject","handleOnLoad","setAttribute","handleOnError","errorEvent","remove","AdyenCheckoutError","message","cause","error","scriptContainer","document","querySelector","getAttribute","addEventListener","createElement","Object","assign","dataset","async","appendChild","parentNode","removeChild"],"mappings":"4KAoBA,MAAMA,EASFC,WAAAA,CAAYC,EAAKC,EAAO,OAAQC,EAAyC,CAAE,EAAEC,EAAqD,IARlIC,EAAAC,KAAiBL,WAAjB,GACAI,EAAAC,KAAiBJ,YAAjB,GACAG,EAAAC,KAAiBH,kBAAjB,GACAE,EAAAC,KAAiBF,sBAAjB,GAEAC,EAAAC,KAAQC,sBAAqB,GAC7BF,EAAAC,KAAQE,cAAR,GASAH,EAAAC,KAAOG,QAAO,KACV,IAAIH,KAAKC,mBAKT,OAAO,IAAIG,SAAQ,CAACC,EAASC,KACzB,MAAMC,EAAe,KACjBP,KAAKE,OAAOM,aAAa,qBAAsB,QAC/CH,GAAAA,EAGEI,EAAiBC,IACnBV,KAAKW,SACLL,EACI,IAAIM,EAAmB,eAAgB,yBAAyBZ,KAAKL,iBAAiBe,EAAWG,UAAW,CACxGC,MAAOJ,EAAWK,QACtB,EAIRf,KAAKC,oBAAqB,EAE1B,MAAMe,EAA2BC,SAASC,cAAclB,KAAKJ,MAI7D,GAHAI,KAAKE,OAASc,EAAgBE,cAAc,eAAelB,KAAKL,SAG5DK,KAAKE,QAAUF,KAAKE,OAAOiB,aAAa,sBACxCd,QADJ,CAGO,GAAIL,KAAKE,OAKZ,OAFAF,KAAKE,OAAOkB,iBAAiB,OAAQb,QACrCP,KAAKE,OAAOkB,iBAAiB,QAASX,GAK1CT,KAAKE,OAASe,SAASI,cAAc,UACrCC,OAAOC,OAAOvB,KAAKE,OAAQF,KAAKH,YAChCyB,OAAOC,OAAOvB,KAAKE,OAAOsB,QAASxB,KAAKF,gBAExCE,KAAKE,OAAOP,IAAMK,KAAKL,IACvBK,KAAKE,OAAOuB,OAAQ,EAEpBzB,KAAKE,OAAOkB,iBAAiB,OAAQb,GACrCP,KAAKE,OAAOkB,iBAAiB,QAASX,GAEtCO,EAAgBU,YAAY1B,KAAKE,OAbjC,CAauC,GAC3C,IAGJH,EAAAC,KAAOW,UAAS,IACLX,KAAKE,OAAOyB,YAAc3B,KAAKE,OAAOyB,WAAWC,YAAY5B,KAAKE,UA5DzEF,KAAKL,IAAMA,EACXK,KAAKJ,KAAOA,EACZI,KAAKH,WAAaA,EAClBG,KAAKF,eAAiBA,CAC1B"}