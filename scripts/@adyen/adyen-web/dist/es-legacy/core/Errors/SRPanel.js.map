{"version":3,"file":"SRPanel.js","sources":["../../../../src/core/Errors/SRPanel.tsx"],"sourcesContent":["import { h } from 'preact';\nimport './SRPanel.scss';\nimport { AriaAttributes, SRPanelProps } from './types';\nimport BaseElement from '../../components/internal/BaseElement/BaseElement';\nimport { SRMessages, SRMessagesRef } from './SRMessages';\nimport type { ICore } from '../types';\n\n/**\n * A panel meant to hold messages that will be read out by ScreenReaders on an aria-live=\"polite\" basis\n * Expects a string or string array of message to add to the panel to be read out\n * For testing purposes can be made visible\n */\nexport class SRPanel extends BaseElement<SRPanelProps> {\n    public static type = 'srPanel';\n\n    public static defaultProps: Partial<SRPanelProps> = {\n        enabled: true,\n        node: 'body',\n        showPanel: false,\n        id: 'ariaLiveSRPanel',\n        ariaAttributes: {\n            'aria-relevant': 'all',\n            'aria-live': 'polite',\n            'aria-atomic': 'true'\n        }\n    };\n\n    private readonly srPanelContainer = null;\n\n    private readonly id;\n    private readonly showPanel;\n    private readonly _enabled: boolean;\n    private readonly _moveFocus: boolean;\n\n    private componentRef: SRMessagesRef;\n\n    constructor(checkout: ICore, props?: SRPanelProps) {\n        super(checkout, props);\n\n        this.id = this.props.id;\n        this.showPanel = process.env.NODE_ENV !== 'production' ? this.props.showPanel : false;\n        this._enabled = false;\n        this._moveFocus = this.props.moveFocus ?? true;\n\n        if (this.props.enabled) {\n            this._enabled = true;\n\n            const panelParent = document.querySelector(this.props.node);\n\n            if (panelParent) {\n                const preExistingSRPanel = document.getElementById(this.id);\n                if (preExistingSRPanel) {\n                    panelParent.removeChild(preExistingSRPanel);\n                }\n\n                this.srPanelContainer = document.createElement('div');\n                this.srPanelContainer.className = 'sr-panel-holder';\n                this.srPanelContainer.id = this.id;\n\n                panelParent.appendChild(this.srPanelContainer);\n\n                this.mount(this.srPanelContainer);\n            } else {\n                throw new Error('Component could not mount. Root node was not found.');\n            }\n        }\n    }\n\n    public setComponentRef = ref => {\n        this.componentRef = ref;\n    };\n\n    public get enabled() {\n        return this._enabled;\n    }\n\n    public get moveFocus() {\n        return this._moveFocus;\n    }\n\n    public setAriaProps(ariaAttributes: AriaAttributes): void {\n        const firstPanel = document.querySelector('[class^=\"adyen-checkout-sr-panel\"]');\n        for (const [key, value] of Object.entries(ariaAttributes)) {\n            firstPanel.setAttribute(key, value);\n        }\n        this.props = { ...this.props, ariaAttributes: { ...this.props.ariaAttributes, ...ariaAttributes } };\n    }\n\n    // A method we can expose to allow comps to set messages in this panel\n    public setMessages = (messages: string[] | string): void => {\n        if (!this.props.enabled) return;\n\n        let panelMessages = null;\n        if (messages) {\n            // Ensure panelMessages is an array\n            panelMessages = Array.isArray(messages) ? messages : [messages];\n        }\n\n        this.componentRef.setMessages(panelMessages);\n    };\n\n    render() {\n        if (!this.props.enabled) return null;\n        return (\n            <div\n                className={this.showPanel ? 'adyen-checkout-sr-panel' : 'adyen-checkout-sr-panel--sr-only'}\n                role={'log'}\n                {...this.props.ariaAttributes}\n                {...(process.env.NODE_ENV !== 'production' && { 'data-testid': this.id })}\n            >\n                <SRMessages setComponentRef={this.setComponentRef} />\n            </div>\n        );\n    }\n}\n"],"names":["SRPanel","BaseElement","enabled","this","_enabled","moveFocus","_moveFocus","setAriaProps","ariaAttributes","firstPanel","document","querySelector","key","value","Object","entries","setAttribute","props","_object_spread_props","_object_spread","render","h","div","className","showPanel","role","SRMessages","setComponentRef","constructor","checkout","_this_props_moveFocus","super","_define_property","srPanelContainer","id","componentRef","ref","setMessages","messages","panelMessages","Array","isArray","panelParent","node","Error","preExistingSRPanel","getElementById","removeChild","createElement","appendChild","mount","type","defaultProps"],"mappings":"q+BAYO,MAAMA,UAAgBC,EA4DzB,WAAWC,GACP,OAAOC,KAAKC,QAChB,CAEA,aAAWC,GACP,OAAOF,KAAKG,UAChB,CAEOC,YAAAA,CAAaC,GAChB,MAAMC,EAAaC,SAASC,cAAc,sCAC1C,IAAK,MAAOC,EAAKC,KAAUC,OAAOC,QAAQP,GACtCC,EAAWO,aAAaJ,EAAKC,GAEjCV,KAAKc,MAAQC,EAAKC,EAAA,CAAA,EAAAhB,KAAKc,OAAK,CAAET,eAAgBW,KAAKhB,KAAKc,MAAMT,eAAmBA,IACrF,CAeAY,MAAAA,GACI,OAAKjB,KAAKc,MAAMf,QAEZmB,EAACC,MAAAA,EAAAA,CACGC,UAAWpB,KAAKqB,UAAY,0BAA4B,mCACxDC,KAAM,OACFtB,KAAKc,MAAMT,gBACV,GAELa,EAACK,EAAAA,CAAWC,gBAAiBxB,KAAKwB,mBARV,IAWpC,CA7EAC,WAAAA,CAAYC,EAAiBZ,GAMP,IAAAa,EAElB,GAPAC,MAAMF,EAAUZ,GAVpBe,EAAA7B,KAAiB8B,mBAAmB,MAEpCD,EAAiBE,KAAAA,UAAjB,GACAF,EAAiBR,KAAAA,iBAAjB,GACAQ,EAAiB5B,KAAAA,gBAAjB,GACA4B,EAAiB1B,KAAAA,kBAAjB,GAEA0B,EAAQG,KAAAA,oBAAR,GAkCAH,EAAOL,KAAAA,mBAAkBS,IACrBjC,KAAKgC,aAAeC,CAAAA,IAoBxBJ,EAAA7B,KAAOkC,eAAeC,IAClB,IAAKnC,KAAKc,MAAMf,QAAS,OAEzB,IAAIqC,EAAgB,KAChBD,IAEAC,EAAgBC,MAAMC,QAAQH,GAAYA,EAAW,CAACA,IAG1DnC,KAAKgC,aAAaE,YAAYE,EAAAA,IA3D9BpC,KAAK+B,GAAK/B,KAAKc,MAAMiB,GACrB/B,KAAKqB,WAA2E,EAChFrB,KAAKC,UAAW,EAChBD,KAAKG,WAAa,QAAAwB,EAAA3B,KAAKc,MAAMZ,iBAAX,IAAAyB,GAAAA,EAEd3B,KAAKc,MAAMf,QAAS,CACpBC,KAAKC,UAAW,EAEhB,MAAMsC,EAAchC,SAASC,cAAcR,KAAKc,MAAM0B,MAEtD,IAAID,EAcA,MAAM,IAAIE,MAAM,uDAdH,CACb,MAAMC,EAAqBnC,SAASoC,eAAe3C,KAAK+B,IACpDW,GACAH,EAAYK,YAAYF,GAG5B1C,KAAK8B,iBAAmBvB,SAASsC,cAAc,OAC/C7C,KAAK8B,iBAAiBV,UAAY,kBAClCpB,KAAK8B,iBAAiBC,GAAK/B,KAAK+B,GAEhCQ,EAAYO,YAAY9C,KAAK8B,kBAE7B9B,KAAK+C,MAAM/C,KAAK8B,kBAIxB,CACJ,EArDAD,EADShC,EACKmD,OAAO,WAErBnB,EAHShC,EAGKoD,eAAsC,CAChDlD,SAAS,EACTyC,KAAM,OACNnB,WAAW,EACXU,GAAI,kBACJ1B,eAAgB,CACZ,gBAAiB,MACjB,YAAa,SACb,cAAe"}