{"version":3,"file":"RiskModule.js","sources":["../../../../src/core/RiskModule/RiskModule.tsx"],"sourcesContent":["import { h } from 'preact';\nimport BaseElement from '../../components/internal/BaseElement/BaseElement';\nimport DeviceFingerprint from './components/DeviceFingerprint';\nimport base64 from '../../utils/base64';\nimport { RISK_DATA_VERSION, DEVICE_FINGERPRINT } from './constants';\nimport { BaseElementProps } from '../../components/internal/BaseElement/types';\nimport type { ICore } from '../types';\n\nexport interface RiskModuleOptions {\n    enabled: boolean;\n    onComplete?: (data) => void;\n    onError?: (error) => void;\n    node?: string;\n}\n\ninterface RiskModuleProps extends BaseElementProps {\n    risk: RiskModuleOptions;\n    loadingContext: string;\n}\n\nexport type RiskData = string | boolean;\n\nexport default class RiskElement extends BaseElement<RiskModuleProps> {\n    public static type = 'risk';\n    public static defaultProps = {\n        risk: {\n            enabled: true,\n            onComplete: () => {},\n            onError: () => {},\n            node: 'body'\n        }\n    };\n\n    private nodeRiskContainer = null;\n\n    constructor(checkout: ICore, props?) {\n        super(checkout, props);\n\n        // Populate state with null values\n        const riskElements = {\n            [DEVICE_FINGERPRINT]: null\n        };\n\n        this.setState({ data: riskElements });\n\n        if (this.props.risk.enabled === true) {\n            if (document.querySelector(this.props.risk.node)) {\n                this.nodeRiskContainer = document.createElement('div');\n                document.querySelector(this.props.risk.node).appendChild(this.nodeRiskContainer);\n                this.mount(this.nodeRiskContainer);\n            } else {\n                this.onError({ message: 'RiskModule node was not found' });\n            }\n        }\n    }\n\n    formatProps(props) {\n        return {\n            ...props,\n            risk: {\n                ...RiskElement.defaultProps.risk,\n                ...props.risk\n            }\n        };\n    }\n\n    public onComplete = result => {\n        const data = { ...this.state.data, [result.type]: result.value, persistentCookie: result.persistentCookie, components: result.components };\n        this.setState({ data, isValid: true });\n        this.props.risk.onComplete(this.data);\n        this.cleanUp();\n    };\n\n    public onError = error => {\n        this.props.risk.onError(error);\n        this.cleanUp();\n    };\n\n    get isValid() {\n        return this.state.isValid;\n    }\n\n    get data(): any {\n        if (this.isValid) {\n            const dataObj = { version: RISK_DATA_VERSION, ...this.state.data };\n            return base64.encode(JSON.stringify(dataObj));\n        }\n\n        return false;\n    }\n\n    public get enabled() {\n        return this.props.risk.enabled;\n    }\n\n    public cleanUp = () => {\n        if (this.nodeRiskContainer && this.nodeRiskContainer.parentNode) this.nodeRiskContainer.parentNode.removeChild(this.nodeRiskContainer);\n    };\n\n    componentWillUnmount() {\n        this.cleanUp();\n    }\n\n    render() {\n        return <DeviceFingerprint {...this.props} loadingContext={this.props.loadingContext} onComplete={this.onComplete} onError={this.onError} />;\n    }\n}\n"],"names":["RiskElement","BaseElement","formatProps","props","_object_spread_props","risk","_object_spread","defaultProps","isValid","this","state","data","dataObj","version","RISK_DATA_VERSION","base64","encode","JSON","stringify","enabled","componentWillUnmount","cleanUp","render","h","DeviceFingerprint","loadingContext","onComplete","onError","constructor","checkout","super","_define_property","nodeRiskContainer","result","type","value","persistentCookie","components","setState","error","parentNode","removeChild","riskElements","DEVICE_FINGERPRINT","document","querySelector","node","createElement","appendChild","mount","message"],"mappings":"2mCAsBe,MAAMA,UAAoBC,EAkCrCC,WAAAA,CAAYC,GACR,OAAOC,EACAD,EAAAA,CAAAA,EAAAA,GAAAA,CACHE,KAAMC,KACCN,EAAYO,aAAaF,KACzBF,EAAME,OAGrB,CAcA,WAAIG,GACA,OAAOC,KAAKC,MAAMF,OACtB,CAEA,QAAIG,GACA,GAAIF,KAAKD,QAAS,CACd,MAAMI,EAAUN,EAAA,CAAEO,QAASC,GAAsBL,KAAKC,MAAMC,MAC5D,OAAOI,EAAOC,OAAOC,KAAKC,UAAUN,GACxC,CAEA,OAAO,CACX,CAEA,WAAWO,GACP,OAAOV,KAAKN,MAAME,KAAKc,OAC3B,CAMAC,oBAAAA,GACIX,KAAKY,SACT,CAEAC,MAAAA,GACI,OAAOC,EAACC,EAAAA,EAAAA,EAAAA,GAAsBf,KAAKN,OAAK,CAAEsB,eAAgBhB,KAAKN,MAAMsB,eAAgBC,WAAYjB,KAAKiB,WAAYC,QAASlB,KAAKkB,UACpI,CAtEAC,WAAAA,CAAYC,EAAiB1B,GACzB2B,MAAMD,EAAU1B,GAHpB4B,EAAAtB,KAAQuB,oBAAoB,MAiC5BD,EAAAtB,KAAOiB,cAAaO,IAChB,MAAMtB,EAAOP,EAAKE,EAAA,CAAA,EAAAG,KAAKC,MAAMC,MAAI,CAAE,CAACsB,EAAOC,MAAOD,EAAOE,MAAOC,iBAAkBH,EAAOG,iBAAkBC,WAAYJ,EAAOI,aAC9H5B,KAAK6B,SAAS,CAAE3B,OAAMH,SAAS,IAC/BC,KAAKN,MAAME,KAAKqB,WAAWjB,KAAKE,MAChCF,KAAKY,SAAO,IAGhBU,EAAAtB,KAAOkB,WAAUY,IACb9B,KAAKN,MAAME,KAAKsB,QAAQY,GACxB9B,KAAKY,SAAO,IAoBhBU,OAAOV,WAAU,KACTZ,KAAKuB,mBAAqBvB,KAAKuB,kBAAkBQ,YAAY/B,KAAKuB,kBAAkBQ,WAAWC,YAAYhC,KAAKuB,kBAAiB,IAzDrI,MAAMU,EAAe,CACjBC,CAACA,GAAqB,MAG1BlC,KAAK6B,SAAS,CAAE3B,KAAM+B,KAEU,IAA5BjC,KAAKN,MAAME,KAAKc,UACZyB,SAASC,cAAcpC,KAAKN,MAAME,KAAKyC,OACvCrC,KAAKuB,kBAAoBY,SAASG,cAAc,OAChDH,SAASC,cAAcpC,KAAKN,MAAME,KAAKyC,MAAME,YAAYvC,KAAKuB,mBAC9DvB,KAAKwC,MAAMxC,KAAKuB,oBAEhBvB,KAAKkB,QAAQ,CAAEuB,QAAS,kCAGpC,EA/BAnB,EADiB/B,EACHkC,OAAO,QACrBH,EAFiB/B,EAEHO,eAAe,CACzBF,KAAM,CACFc,SAAS,EACTO,WAAY,OACZC,QAAS,OACTmB,KAAM"}