{"version":3,"file":"KlarnaPayments.js","sources":["../../../../src/components/Klarna/KlarnaPayments.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport { CoreProvider } from '../../core/Context/CoreProvider';\nimport PayButton from '../internal/PayButton';\nimport { KlarnaContainer } from './components/KlarnaContainer/KlarnaContainer';\nimport { TxVariants } from '../tx-variants';\nimport type { KlarnaAction, KlarnaAdditionalDetailsData, KlarnaComponentRef, KlarnaConfiguration } from './types';\nimport type { ICore } from '../../core/types';\n\nclass KlarnaPayments extends UIElement<KlarnaConfiguration> {\n    public static type = TxVariants.klarna;\n    public static txVariants = [TxVariants.klarna, TxVariants.klarna_account, TxVariants.klarna_paynow, TxVariants.klarna_b2b];\n\n    public componentRef: KlarnaComponentRef;\n\n    protected static defaultProps = {\n        useKlarnaWidget: false\n    };\n\n    constructor(checkout: ICore, props?: KlarnaConfiguration) {\n        super(checkout, props);\n\n        this.onComplete = this.onComplete.bind(this);\n        this.updateWithAction = this.updateWithAction.bind(this);\n        this.submit = this.submit.bind(this);\n        this.onLoaded = this.onLoaded.bind(this);\n    }\n    get isValid() {\n        return true;\n    }\n\n    protected formatData() {\n        return {\n            paymentMethod: {\n                type: this.type,\n                ...(this.props.useKlarnaWidget ? { subtype: 'sdk' } : {})\n            }\n        };\n    }\n\n    public payButton = props => {\n        return <PayButton amount={this.props.amount} onClick={this.submit} {...props} />;\n    };\n\n    public override handleAction(action: KlarnaAction, props = {}): UIElement | null {\n        if (action.type === 'sdk') {\n            this.updateWithAction(action);\n            return;\n        }\n        return super.handleAction(action, props);\n    }\n\n    updateWithAction(action: KlarnaAction): void {\n        if (action.paymentMethodType !== this.type) throw new Error('Invalid Action');\n        this.componentRef.setAction(action);\n    }\n\n    private onLoaded() {\n        // When action/widget is loaded, set the 'drop-in' back to ready\n        this.setElementStatus('ready');\n    }\n\n    public override activate() {\n        this.componentRef.reinitializeWidget();\n    }\n\n    protected onComplete(details: KlarnaAdditionalDetailsData): void {\n        this.handleAdditionalDetails(details);\n    }\n\n    render() {\n        return (\n            <CoreProvider i18n={this.props.i18n} loadingContext={this.props.loadingContext} resources={this.resources}>\n                <KlarnaContainer\n                    {...this.props}\n                    setComponentRef={this.setComponentRef}\n                    displayName={this.displayName}\n                    onComplete={this.onComplete}\n                    onError={this.props.onError}\n                    payButton={this.payButton}\n                    onLoaded={this.onLoaded}\n                    showPayButton={this.props.showPayButton}\n                    onActionHandled={this.onActionHandled}\n                    type={this.props.type}\n                />\n            </CoreProvider>\n        );\n    }\n}\n\nexport default KlarnaPayments;\n"],"names":["KlarnaPayments","UIElement","isValid","formatData","paymentMethod","type","this","props","useKlarnaWidget","subtype","handleAction","action","super","updateWithAction","paymentMethodType","Error","componentRef","setAction","onLoaded","setElementStatus","activate","reinitializeWidget","onComplete","details","handleAdditionalDetails","render","h","CoreProvider","i18n","loadingContext","resources","KlarnaContainer","setComponentRef","displayName","onError","payButton","showPayButton","onActionHandled","constructor","checkout","_define_property","PayButton","amount","onClick","submit","bind","TxVariants","klarna","txVariants","klarna_account","klarna_paynow","klarna_b2b","defaultProps"],"mappings":"ifASA,MAAMA,UAAuBC,EAkBzB,WAAIC,GACA,OAAO,CACX,CAEUC,UAAAA,GACN,MAAO,CACHC,cAAe,CACXC,KAAMC,KAAKD,QACPC,KAAKC,MAAMC,gBAAkB,CAAEC,QAAS,OAAU,CAAA,GAGlE,CAMgBC,YAAAA,CAAaC,EAAsBJ,EAAQ,IACvD,GAAoB,QAAhBI,EAAON,KAIX,OAAOO,MAAMF,aAAaC,EAAQJ,GAH9BD,KAAKO,iBAAiBF,EAI9B,CAEAE,gBAAAA,CAAiBF,GACb,GAAIA,EAAOG,oBAAsBR,KAAKD,KAAM,MAAM,IAAIU,MAAM,kBAC5DT,KAAKU,aAAaC,UAAUN,EAChC,CAEQO,QAAAA,GAEJZ,KAAKa,iBAAiB,QAC1B,CAEgBC,QAAAA,GACZd,KAAKU,aAAaK,oBACtB,CAEUC,UAAAA,CAAWC,GACjBjB,KAAKkB,wBAAwBD,EACjC,CAEAE,MAAAA,GACI,OACIC,EAACC,EAAAA,CAAaC,KAAMtB,KAAKC,MAAMqB,KAAMC,eAAgBvB,KAAKC,MAAMsB,eAAgBC,UAAWxB,KAAKwB,WAC5FJ,EAACK,EAAAA,IACOzB,KAAKC,MACTyB,gBAAiB1B,KAAK0B,gBACtBC,YAAa3B,KAAK2B,YAClBX,WAAYhB,KAAKgB,WACjBY,QAAS5B,KAAKC,MAAM2B,QACpBC,UAAW7B,KAAK6B,UAChBjB,SAAUZ,KAAKY,SACfkB,cAAe9B,KAAKC,MAAM6B,cAC1BC,gBAAiB/B,KAAK+B,gBACtBhC,KAAMC,KAAKC,MAAMF,OAIjC,CApEAiC,WAAAA,CAAYC,EAAiBhC,GACzBK,MAAM2B,EAAUhC,GAPpBiC,EAAAlC,KAAOU,oBAAP,GA2BAwB,EAAOL,KAAAA,aAAY5B,GACRmB,EAACe,EAAAA,CAAUC,OAAQpC,KAAKC,MAAMmC,OAAQC,QAASrC,KAAKsC,UAAYrC,MAnBvED,KAAKgB,WAAahB,KAAKgB,WAAWuB,KAAKvC,MACvCA,KAAKO,iBAAmBP,KAAKO,iBAAiBgC,KAAKvC,MACnDA,KAAKsC,OAAStC,KAAKsC,OAAOC,KAAKvC,MAC/BA,KAAKY,SAAWZ,KAAKY,SAAS2B,KAAKvC,KACvC,EAhBAkC,EADExC,EACYK,OAAOyC,EAAWC,QAChCP,EAFExC,EAEYgD,aAAa,CAACF,EAAWC,OAAQD,EAAWG,eAAgBH,EAAWI,cAAeJ,EAAWK,aAI/GX,EANExC,EAMeoD,eAAe,CAC5B5C,iBAAiB"}