{"version":3,"file":"ClickToPay.js","sources":["../../../../src/components/ClickToPay/ClickToPay.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport { CoreProvider } from '../../core/Context/CoreProvider';\nimport { ClickToPayConfiguration, ClickToPayPaymentData } from './types';\nimport collectBrowserInfo from '../../utils/browserInfo';\nimport { ClickToPayCheckoutPayload, IClickToPayService } from '../internal/ClickToPay/services/types';\nimport { ClickToPayProps } from '../internal/ClickToPay/types';\nimport createClickToPayService from '../internal/ClickToPay/services/create-clicktopay-service';\nimport { CtpState } from '../internal/ClickToPay/services/ClickToPayService';\nimport ClickToPayProvider from '../internal/ClickToPay/context/ClickToPayProvider';\nimport ClickToPayComponent from '../internal/ClickToPay';\nimport AdyenCheckoutError from '../../core/Errors/AdyenCheckoutError';\nimport { TxVariants } from '../tx-variants';\nimport type { ICore } from '../../core/types';\n\nexport class ClickToPayElement extends UIElement<ClickToPayConfiguration> {\n    public static type = TxVariants.clicktopay;\n\n    private readonly clickToPayService: IClickToPayService | null;\n    private readonly ctpConfiguration: ClickToPayProps;\n\n    constructor(checkout: ICore, props?: ClickToPayConfiguration) {\n        super(checkout, props);\n\n        this.ctpConfiguration = {\n            shopperEmail: this.props.shopperEmail,\n            telephoneNumber: this.props.telephoneNumber,\n            merchantDisplayName: this.props.merchantDisplayName,\n            locale: this.props.locale,\n            onReady: this.props.onReady,\n            onTimeout: this.props.onTimeout\n        };\n\n        this.clickToPayService = createClickToPayService(this.props.configuration, this.ctpConfiguration, this.props.environment);\n        this.clickToPayService?.initialize().catch(error => {\n            this.handleError(new AdyenCheckoutError('ERROR', error.toString(), { cause: error }));\n        });\n\n        if (!this.clickToPayService) {\n            console.warn('ClickToPay not initialized - Likely the payment method is not configured or its configuration is missing');\n        }\n    }\n\n    get isValid() {\n        return true;\n    }\n\n    get browserInfo() {\n        return collectBrowserInfo();\n    }\n\n    public formatData(): ClickToPayPaymentData {\n        const { srcScheme, srcCorrelationId, srcTokenReference, srcCheckoutPayload, srcDigitalCardId } = this.state.data;\n        return {\n            paymentMethod: {\n                type: ClickToPayElement.type,\n                ...(srcScheme && { srcScheme }),\n                ...(srcCorrelationId && { srcCorrelationId }),\n                ...(srcTokenReference && { srcTokenReference }),\n                ...(srcCheckoutPayload && { srcCheckoutPayload }),\n                ...(srcDigitalCardId && { srcDigitalCardId })\n            },\n            browserInfo: this.browserInfo,\n            origin: window?.location?.origin\n        };\n    }\n\n    protected formatProps(props: ClickToPayConfiguration) {\n        return {\n            ...props,\n            disableOtpAutoFocus: props.disableOtpAutoFocus || false,\n            shopperEmail: props.shopperEmail || this.core.options?.session?.shopperEmail,\n            telephoneNumber: props.telephoneNumber || this.core.options?.session?.telephoneNumber,\n            locale: props.locale || props.i18n?.locale?.replace('-', '_')\n        };\n    }\n\n    /**\n     * Method used to let the merchant know if the shopper have a valid CtP accoubt\n     *\n     * Resolves Promise if the Shopper has cookies OR has valid CtP account\n     * Rejects Promise if account isn't found or if Login screen is triggered\n     */\n    public override async isAvailable(): Promise<void> {\n        if (!this.clickToPayService) {\n            return Promise.reject();\n        }\n\n        if (this.clickToPayService.shopperAccountFound) {\n            return Promise.resolve();\n        }\n\n        return new Promise((resolve, reject) => {\n            this.clickToPayService.subscribeOnStateChange((state: CtpState) => {\n                if (this.clickToPayService.shopperAccountFound) resolve();\n                if (state === CtpState.NotAvailable || state === CtpState.Login || state === CtpState.Idle) reject();\n            });\n        });\n    }\n\n    private handleClickToPaySubmit = (payload: ClickToPayCheckoutPayload) => {\n        this.setState({ data: { ...payload }, valid: {}, errors: {}, isValid: true });\n        this.submit();\n    };\n\n    render() {\n        return (\n            <CoreProvider i18n={this.props.i18n} loadingContext={this.props.loadingContext} resources={this.resources}>\n                <ClickToPayProvider\n                    isStandaloneComponent={true}\n                    configuration={this.ctpConfiguration}\n                    amount={this.props.amount}\n                    clickToPayService={this.clickToPayService}\n                    setClickToPayRef={this.setComponentRef}\n                    onSetStatus={this.setElementStatus}\n                    onSubmit={this.handleClickToPaySubmit}\n                    onError={this.handleError}\n                >\n                    <ClickToPayComponent />\n                </ClickToPayProvider>\n            </CoreProvider>\n        );\n    }\n}\n\nexport default ClickToPayElement;\n"],"names":["ClickToPayElement","UIElement","isValid","browserInfo","collectBrowserInfo","formatData","srcScheme","srcCorrelationId","srcTokenReference","srcCheckoutPayload","srcDigitalCardId","this","state","data","paymentMethod","type","origin","window","location","formatProps","props","disableOtpAutoFocus","shopperEmail","core","options","session","telephoneNumber","locale","i18n","replace","isAvailable","clickToPayService","shopperAccountFound","Promise","resolve","reject","subscribeOnStateChange","CtpState","NotAvailable","Login","Idle","render","h","CoreProvider","loadingContext","resources","ClickToPayProvider","isStandaloneComponent","configuration","ctpConfiguration","amount","setClickToPayRef","setComponentRef","onSetStatus","setElementStatus","onSubmit","handleClickToPaySubmit","onError","handleError","ClickToPayComponent","constructor","checkout","super","_define_property","payload","setState","valid","errors","submit","merchantDisplayName","onReady","onTimeout","createClickToPayService","environment","initialize","catch","error","AdyenCheckoutError","toString","cause","console","warn","TxVariants","clicktopay"],"mappings":"2uBAeO,MAAMA,UAA0BC,EA4BnC,WAAIC,GACA,OAAO,CACX,CAEA,eAAIC,GACA,OAAOC,GACX,CAEOC,UAAAA,GACH,MAAMC,UAAEA,EAASC,iBAAEA,EAAgBC,kBAAEA,EAAiBC,mBAAEA,EAAkBC,iBAAEA,GAAqBC,KAAKC,MAAMC,KAC5G,MAAO,CACHC,cAAe,CACXC,KAAMf,EAAkBe,QACpBT,GAAa,CAAEA,gBACfC,GAAoB,CAAEA,uBACtBC,GAAqB,CAAEA,wBACvBC,GAAsB,CAAEA,yBACxBC,GAAoB,CAAEA,qBAE9BP,YAAaQ,KAAKR,YAClBa,OAAQC,QAAQC,UAAUF,OAElC,CAEUG,WAAAA,CAAYC,GAClB,MAAO,IACAA,EACHC,oBAAqBD,EAAMC,sBAAuB,EAClDC,aAAcF,EAAME,cAAgBX,KAAKY,KAAKC,SAASC,SAASH,aAChEI,gBAAiBN,EAAMM,iBAAmBf,KAAKY,KAAKC,SAASC,SAASC,gBACtEC,OAAQP,EAAMO,QAAUP,EAAMQ,MAAMD,QAAQE,QAAQ,IAAK,KAEjE,CAQA,iBAAsBC,GAClB,OAAKnB,KAAKoB,kBAINpB,KAAKoB,kBAAkBC,oBAChBC,QAAQC,UAGZ,IAAID,SAAQ,CAACC,EAASC,KACzBxB,KAAKoB,kBAAkBK,wBAAwBxB,IACvCD,KAAKoB,kBAAkBC,qBAAqBE,IAC5CtB,IAAUyB,EAASC,cAAgB1B,IAAUyB,EAASE,OAAS3B,IAAUyB,EAASG,MAAML,GAAAA,GAChG,IAXOF,QAAQE,QAavB,CAOAM,MAAAA,GACI,OACIC,EAACC,EAAAA,CAAaf,KAAMjB,KAAKS,MAAMQ,KAAMgB,eAAgBjC,KAAKS,MAAMwB,eAAgBC,UAAWlC,KAAKkC,WAC5FH,EAACI,EAAAA,CACGC,uBAAuB,EACvBC,cAAerC,KAAKsC,iBACpBC,OAAQvC,KAAKS,MAAM8B,OACnBnB,kBAAmBpB,KAAKoB,kBACxBoB,iBAAkBxC,KAAKyC,gBACvBC,YAAa1C,KAAK2C,iBAClBC,SAAU5C,KAAK6C,uBACfC,QAAS9C,KAAK+C,aAEdhB,EAACiB,EAAAA,OAIjB,CArGAC,WAAAA,CAAYC,EAAiBzC,GACzB0C,MAAMD,EAAUzC,GAJpB2C,EAAApD,KAAiBoB,yBAAjB,GACAgC,EAAApD,KAAiBsC,wBAAjB,GAiFAc,EAAApD,KAAQ6C,0BAA0BQ,IAC9BrD,KAAKsD,SAAS,CAAEpD,KAAM,IAAKmD,GAAWE,MAAO,CAAC,EAAGC,OAAQ,CAAC,EAAGjE,SAAS,IACtES,KAAKyD,QAAM,IA9EXzD,KAAKsC,iBAAmB,CACpB3B,aAAcX,KAAKS,MAAME,aACzBI,gBAAiBf,KAAKS,MAAMM,gBAC5B2C,oBAAqB1D,KAAKS,MAAMiD,oBAChC1C,OAAQhB,KAAKS,MAAMO,OACnB2C,QAAS3D,KAAKS,MAAMkD,QACpBC,UAAW5D,KAAKS,MAAMmD,WAG1B5D,KAAKoB,kBAAoByC,EAAwB7D,KAAKS,MAAM4B,cAAerC,KAAKsC,iBAAkBtC,KAAKS,MAAMqD,aAC7G9D,KAAKoB,mBAAmB2C,aAAaC,OAAMC,IACvCjE,KAAK+C,YAAY,IAAImB,EAAmB,QAASD,EAAME,WAAY,CAAEC,MAAOH,IAAM,IAGjFjE,KAAKoB,mBACNiD,QAAQC,KAAK,2GAErB,EAzBAlB,EADS/D,EACKe,OAAOmE,EAAWC"}