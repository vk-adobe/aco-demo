{"version":3,"file":"utils.js","sources":["../../../../../src/components/internal/UIElement/utils.ts"],"sourcesContent":["import { UIElementStatus } from './types';\nimport { RawPaymentResponse, PaymentResponseData, Order } from '../../../types/global-types';\nimport { IDropin } from '../../Dropin/types';\n\nconst ALLOWED_PROPERTIES = ['action', 'resultCode', 'sessionData', 'order', 'sessionResult', 'donationToken', 'error'];\n\nexport function sanitizeResponse(response: RawPaymentResponse): PaymentResponseData {\n    const removedProperties = [];\n\n    const sanitizedObject = Object.keys(response).reduce((acc, cur) => {\n        if (!ALLOWED_PROPERTIES.includes(cur)) {\n            removedProperties.push(cur);\n        } else {\n            acc[cur] = response[cur];\n        }\n        return acc;\n    }, {});\n\n    if (removedProperties.length) console.warn(`The following properties should not be passed to the client: ${removedProperties.join(', ')}`);\n\n    return sanitizedObject as PaymentResponseData;\n}\n\n/**\n * Remove not relevant properties in the final payment result object\n *\n * @param paymentResponse\n */\nexport function cleanupFinalResult(paymentResponse?: PaymentResponseData): void {\n    if (!paymentResponse) return;\n\n    delete paymentResponse.order;\n    delete paymentResponse.action;\n    if (!paymentResponse.donationToken || paymentResponse.donationToken.length === 0) {\n        delete paymentResponse.donationToken;\n    }\n}\n\nexport function resolveFinalResult(result: PaymentResponseData): [status: UIElementStatus, statusProps?: any] {\n    switch (result.resultCode) {\n        case 'Authorised':\n        case 'Received':\n            return ['success'];\n        case 'Pending':\n            return ['success'];\n        case 'Cancelled':\n        case 'Error':\n        case 'Refused':\n            return ['error'];\n        default:\n    }\n}\n\nexport function verifyPaymentDidNotFail(response: PaymentResponseData): Promise<PaymentResponseData> {\n    if (['Cancelled', 'Error', 'Refused'].includes(response.resultCode)) {\n        return Promise.reject(response);\n    }\n\n    return Promise.resolve(response);\n}\n\nexport function assertIsDropin(element: any): element is IDropin {\n    if (!element) return false;\n\n    const isDropin = typeof element.activePaymentMethod === 'object' && typeof element.closeActivePaymentMethod === 'function';\n    return isDropin;\n}\n\nexport function getRegulatoryDefaults(countryCode: string, isDropin: boolean): Record<string, any> {\n    switch (countryCode) {\n        // Finnish regulations state that no payment method can be open by default\n        case 'FI':\n            return isDropin\n                ? {\n                      openFirstPaymentMethod: false,\n                      openFirstStoredPaymentMethod: false\n                  }\n                : {};\n        default:\n            return {};\n    }\n}\n\nexport function sanitizeOrder(order: Order) {\n    if (!order || !order.orderData || !order.pspReference) return null;\n    return {\n        orderData: order.orderData,\n        pspReference: order.pspReference\n    };\n}\n"],"names":["ALLOWED_PROPERTIES","sanitizeResponse","response","removedProperties","sanitizedObject","Object","keys","reduce","acc","cur","includes","push","length","console","warn","join","cleanupFinalResult","paymentResponse","order","action","donationToken","verifyPaymentDidNotFail","resultCode","Promise","reject","resolve","assertIsDropin","element","activePaymentMethod","closeActivePaymentMethod","getRegulatoryDefaults","countryCode","isDropin","openFirstPaymentMethod","openFirstStoredPaymentMethod","sanitizeOrder","orderData","pspReference"],"mappings":"AAIA,MAAMA,EAAqB,CAAC,SAAU,aAAc,cAAe,QAAS,gBAAiB,gBAAiB,SAEvG,SAASC,EAAiBC,GAC7B,MAAMC,EAAoB,GAEpBC,EAAkBC,OAAOC,KAAKJ,GAAUK,QAAO,CAACC,EAAKC,KAClDT,EAAmBU,SAASD,GAG7BD,EAAIC,GAAOP,EAASO,GAFpBN,EAAkBQ,KAAKF,GAIpBD,IACR,IAIH,OAFIL,EAAkBS,QAAQC,QAAQC,KAAK,gEAAgEX,EAAkBY,KAAK,SAE3HX,CACX,CAOO,SAASY,EAAmBC,GAC1BA,WAEEA,EAAgBC,aAChBD,EAAgBE,OAClBF,EAAgBG,eAA0D,IAAzCH,EAAgBG,cAAcR,eACzDK,EAAgBG,cAE/B,CAiBO,SAASC,EAAwBnB,GACpC,MAAI,CAAC,YAAa,QAAS,WAAWQ,SAASR,EAASoB,YAC7CC,QAAQC,OAAOtB,GAGnBqB,QAAQE,QAAQvB,EAC3B,CAEO,SAASwB,EAAeC,GAC3B,IAAKA,EAAS,OAAO,EAGrB,MADwD,iBAAhCA,EAAQC,qBAAgF,mBAArCD,EAAQE,wBAEvF,CAEO,SAASC,EAAsBC,EAAqBC,GACvD,MAES,OAFDD,GAGOC,EACD,CACIC,wBAAwB,EACxBC,8BAA8B,GAIjC,CAAC,CAEpB,CAEO,SAASC,EAAcjB,GAC1B,OAAKA,GAAUA,EAAMkB,WAAclB,EAAMmB,aAClC,CACHD,UAAWlB,EAAMkB,UACjBC,aAAcnB,EAAMmB,cAHsC,IAKlE"}