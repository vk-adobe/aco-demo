{"version":3,"file":"CountdownA11yReporter.js","sources":["../../../../../src/components/internal/Countdown/CountdownA11yReporter.ts"],"sourcesContent":["import { interpolateElement } from '../../../language/utils';\nimport { SRPanel } from '../../../core/Errors/SRPanel';\nimport Language from '../../../language';\nimport { CountdownTime } from './types';\n\ninterface ICountdownA11yService {\n    srPanel: SRPanel;\n    i18n: Language;\n}\n\nexport class CountdownA11yReporter {\n    protected TRANSLATION_KEY = 'sr.wechatpay.timetopay';\n    protected LONG_TIMEOUT = 180000;\n    protected MID_TIMEOUT = 60000;\n    protected SHORT_TIMEOUT = 30000;\n\n    private readonly srPanel: SRPanel;\n    private readonly i18n: Language;\n    private srInterval: ReturnType<typeof setInterval>;\n    private timeout: number;\n    private timeLeft: CountdownTime;\n\n    constructor(props: ICountdownA11yService) {\n        const { srPanel, i18n } = props;\n\n        this.srPanel = srPanel;\n        this.i18n = i18n;\n        // Force the srPanel to update ariaRelevant\n        this.srPanel.setAriaProps({ 'aria-relevant': 'additions text' });\n    }\n\n    public update(time: CountdownTime): void {\n        const { minutes, seconds } = time;\n        if (minutes === '-' || seconds === '-') return;\n\n        const minutesLeft = typeof minutes === 'string' ? parseInt(minutes, 10) : minutes;\n        const secondsLeft = typeof seconds === 'string' ? parseInt(seconds, 10) : seconds;\n        this.timeLeft = { minutes: minutesLeft, seconds: secondsLeft };\n\n        if (minutesLeft > 5 && this.timeout !== this.LONG_TIMEOUT) {\n            this.timeout = this.LONG_TIMEOUT;\n            this.setInterval(this.timeout);\n        }\n        if (minutesLeft >= 1 && minutesLeft <= 5 && this.timeout !== this.MID_TIMEOUT) {\n            this.timeout = this.MID_TIMEOUT;\n            this.setInterval(this.timeout);\n        }\n        if (minutesLeft < 1 && secondsLeft > 0 && this.timeout !== this.SHORT_TIMEOUT) {\n            this.timeout = this.SHORT_TIMEOUT;\n            this.setInterval(this.timeout);\n        }\n    }\n\n    public tearDown(): void {\n        this.clearInterval();\n        // Reset the srPanel ariaRelevant\n        this.srPanel.setAriaProps({ 'aria-relevant': this.srPanel.constructor['defaultProps'].ariaAttributes['aria-relevant'] });\n        this.srPanel.setMessages(null);\n    }\n\n    private setInterval(timeout): void {\n        this.clearInterval();\n        const setSrMessages = () => {\n            this.srPanel.setMessages(null);\n            this.srPanel.setMessages(this.getSrMessages(this.timeLeft));\n        };\n        // To execute immediately\n        setSrMessages();\n        this.srInterval = setInterval(setSrMessages, timeout);\n    }\n\n    private getSrMessages({ minutes, seconds }): Array<string> {\n        const translation = this.i18n.get(this.TRANSLATION_KEY);\n        const getTimeTranslation = time => (time !== 0 ? translation => `${time} ${translation}` : () => '');\n        const fns = [minutes, seconds].map(getTimeTranslation);\n        return [interpolateElement(translation, fns).join('')];\n    }\n\n    private clearInterval(): void {\n        if (this.srInterval) clearInterval(this.srInterval);\n    }\n}\n"],"names":["CountdownA11yReporter","update","time","minutes","seconds","minutesLeft","parseInt","secondsLeft","this","timeLeft","timeout","LONG_TIMEOUT","setInterval","MID_TIMEOUT","SHORT_TIMEOUT","tearDown","clearInterval","srPanel","setAriaProps","constructor","ariaAttributes","setMessages","setSrMessages","getSrMessages","srInterval","translation","i18n","get","TRANSLATION_KEY","fns","map","interpolateElement","join","props","_define_property"],"mappings":"wLAUO,MAAMA,EAqBFC,MAAAA,CAAOC,GACV,MAAMC,QAAEA,EAAOC,QAAEA,GAAYF,EAC7B,GAAgB,MAAZC,GAA+B,MAAZC,EAAiB,OAExC,MAAMC,EAAiC,iBAAZF,EAAuBG,SAASH,EAAS,IAAMA,EACpEI,EAAiC,iBAAZH,EAAuBE,SAASF,EAAS,IAAMA,EAC1EI,KAAKC,SAAW,CAAEN,QAASE,EAAaD,QAASG,GAE7CF,EAAc,GAAKG,KAAKE,UAAYF,KAAKG,eACzCH,KAAKE,QAAUF,KAAKG,aACpBH,KAAKI,YAAYJ,KAAKE,UAEtBL,GAAe,GAAKA,GAAe,GAAKG,KAAKE,UAAYF,KAAKK,cAC9DL,KAAKE,QAAUF,KAAKK,YACpBL,KAAKI,YAAYJ,KAAKE,UAEtBL,EAAc,GAAKE,EAAc,GAAKC,KAAKE,UAAYF,KAAKM,gBAC5DN,KAAKE,QAAUF,KAAKM,cACpBN,KAAKI,YAAYJ,KAAKE,SAE9B,CAEOK,QAAAA,GACHP,KAAKQ,gBAELR,KAAKS,QAAQC,aAAa,CAAE,gBAAiBV,KAAKS,QAAQE,YAA2B,aAACC,eAAe,mBACrGZ,KAAKS,QAAQI,YAAY,KAC7B,CAEQT,WAAAA,CAAYF,GAChBF,KAAKQ,gBACL,MAAMM,EAAgB,KAClBd,KAAKS,QAAQI,YAAY,MACzBb,KAAKS,QAAQI,YAAYb,KAAKe,cAAcf,KAAKC,UAAQ,EAG7Da,IACAd,KAAKgB,WAAaZ,YAAYU,EAAeZ,EACjD,CAEQa,aAAAA,EAAcpB,QAAEA,EAAOC,QAAEA,IAC7B,MAAMqB,EAAcjB,KAAKkB,KAAKC,IAAInB,KAAKoB,iBAEjCC,EAAM,CAAC1B,EAASC,GAAS0B,KADJ5B,GAAkB,IAATA,EAAauB,GAAe,GAAGvB,KAAQuB,IAAgB,IAAM,KAEjG,MAAO,CAACM,EAAmBN,EAAaI,GAAKG,KAAK,IACtD,CAEQhB,aAAAA,GACAR,KAAKgB,YAAYR,cAAcR,KAAKgB,WAC5C,CA1DAL,WAAAA,CAAYc,GAXZC,EAAA1B,KAAUoB,kBAAkB,0BAC5BM,EAAA1B,KAAUG,eAAe,MACzBuB,EAAA1B,KAAUK,cAAc,KACxBqB,EAAA1B,KAAUM,gBAAgB,KAE1BoB,EAAA1B,KAAiBS,eAAjB,GACAiB,EAAA1B,KAAiBkB,YAAjB,GACAQ,EAAA1B,KAAQgB,kBAAR,GACAU,EAAA1B,KAAQE,eAAR,GACAwB,EAAA1B,KAAQC,gBAAR,GAGI,MAAMQ,QAAEA,EAAOS,KAAEA,GAASO,EAE1BzB,KAAKS,QAAUA,EACfT,KAAKkB,KAAOA,EAEZlB,KAAKS,QAAQC,aAAa,CAAE,gBAAiB,kBACjD"}