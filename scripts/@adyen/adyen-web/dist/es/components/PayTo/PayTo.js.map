{"version":3,"file":"PayTo.js","sources":["../../../../src/components/PayTo/PayTo.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport { CoreProvider } from '../../core/Context/CoreProvider';\nimport Await from '../../components/internal/Await';\nimport SRPanelProvider from '../../core/Errors/SRPanelProvider';\nimport { TxVariants } from '../tx-variants';\nimport { PayToIdentifierEnum } from './components/IdentifierSelector';\nimport PayToComponent from './components/PayToComponent';\nimport { PayToInstructions } from './components/PayToInstructions';\nimport MandateSummary from './components/MandateSummary';\nimport { PayToConfiguration, PayToData } from './types';\nimport PayButton, { payAmountLabel } from '../internal/PayButton';\n\n/*\nAwait Config (previously in its own file)\n */\nconst COUNTDOWN_MINUTES = 15; // min\nconst THROTTLE_TIME = 60000; // ms\nconst THROTTLE_INTERVAL = 10000; // ms\n\nconst config = {\n    COUNTDOWN_MINUTES,\n    THROTTLE_TIME,\n    THROTTLE_INTERVAL,\n    showCountdownTimer: false\n};\n\nconst getAccountIdentifier = (state: PayToData) => {\n    // if it's BSB Input type merge bankAccount with BSB\n    if (state.selectedInput === 'bsb-option') {\n        return `${state.bsb}-${state.bankAccountNumber}`;\n    } else if (state.selectedInput === 'payid-option') {\n        // otherwise use the option in the dropdown\n        switch (state.selectedIdentifier) {\n            case PayToIdentifierEnum.email:\n                return state.email;\n            case PayToIdentifierEnum.abn:\n                return state.abn;\n            case PayToIdentifierEnum.orgid:\n                return state.orgid;\n            case PayToIdentifierEnum.phone:\n                // merge the phone prefix and number - see comment in ticket\n                return `${state.phonePrefix}-${state.phoneNumber}`;\n        }\n    }\n};\n/**\n *\n */\nexport class PayToElement extends UIElement<PayToConfiguration> {\n    public static readonly type = TxVariants.payto;\n\n    protected static defaultProps = {\n        placeholders: {}\n    };\n\n    formatProps(props) {\n        return {\n            ...props,\n            data: {\n                ...props.data,\n                phonePrefix: '+61' // hardcode +61\n            }\n        };\n    }\n\n    /**\n     * Formats the component data output\n     */\n    formatData() {\n        if (this.props.storedPaymentMethodId) {\n            return {\n                paymentMethod: {\n                    type: PayToElement.type,\n                    storedPaymentMethodId: this.props.storedPaymentMethodId\n                }\n            };\n        }\n\n        return {\n            paymentMethod: {\n                type: PayToElement.type,\n                shopperAccountIdentifier: getAccountIdentifier(this.state.data)\n            },\n            shopperName: {\n                firstName: this.state.data.firstName,\n                lastName: this.state.data.lastName\n            }\n        };\n    }\n\n    get isValid(): boolean {\n        if (this.props.storedPaymentMethodId) {\n            return true;\n        }\n\n        return !!this.state.isValid;\n    }\n\n    get displayName() {\n        if (this.props.storedPaymentMethodId && this.props.label) {\n            return this.props.label;\n        }\n        return this.props.name;\n    }\n\n    get additionalInfo() {\n        return this.props.storedPaymentMethodId ? this.props.name : '';\n    }\n\n    render() {\n        // Stored\n        if (this.props.storedPaymentMethodId) {\n            return (\n                <CoreProvider i18n={this.props.i18n} loadingContext={this.props.loadingContext} resources={this.resources}>\n                    {this.props.showPayButton && (\n                        <PayButton\n                            {...this.props}\n                            classNameModifiers={['standalone']}\n                            amount={this.props.amount}\n                            label={payAmountLabel(this.props.i18n, this.props.amount)}\n                            onClick={this.submit}\n                        />\n                    )}\n                </CoreProvider>\n            );\n        }\n        // Await\n        if (this.props.paymentData) {\n            return (\n                <CoreProvider i18n={this.props.i18n} loadingContext={this.props.loadingContext} resources={this.resources}>\n                    <SRPanelProvider srPanel={this.props.modules.srPanel}>\n                        <Await\n                            ref={ref => {\n                                this.componentRef = ref;\n                            }}\n                            amount={this.props.amount}\n                            showAmount={true}\n                            instructions={PayToInstructions}\n                            clientKey={this.props.clientKey}\n                            paymentData={this.props.paymentData}\n                            onError={this.props.onError}\n                            onComplete={this.onComplete}\n                            brandLogo={this.icon}\n                            type={this.constructor['type']}\n                            messageText={this.props.i18n.get('payto.confirmPayment')}\n                            awaitText={this.props.i18n.get('payto.await.waitForConfirmation')}\n                            showCountdownTimer={config.showCountdownTimer}\n                            throttleTime={config.THROTTLE_TIME}\n                            throttleInterval={config.THROTTLE_INTERVAL}\n                            onActionHandled={this.onActionHandled}\n                            endSlot={() =>\n                                !!this.props.mandate && (\n                                    <MandateSummary mandate={this.props.mandate} payee={this.props.payee} currencyCode={this.props.amount.currency} />\n                                )\n                            }\n                        />\n                    </SRPanelProvider>\n                </CoreProvider>\n            );\n        }\n        // Input\n        return (\n            <CoreProvider i18n={this.props.i18n} loadingContext={this.props.loadingContext} resources={this.resources}>\n                <PayToComponent\n                    data={this.props.data}\n                    placeholders={this.props.placeholders}\n                    setComponentRef={this.setComponentRef}\n                    onChange={this.setState}\n                    payButton={this.payButton}\n                    showPayButton={this.props.showPayButton}\n                />\n            </CoreProvider>\n        );\n    }\n}\n\nexport default PayToElement;\n"],"names":["config","getAccountIdentifier","state","selectedInput","bsb","bankAccountNumber","selectedIdentifier","PayToIdentifierEnum","email","abn","orgid","phone","phonePrefix","phoneNumber","PayToElement","UIElement","formatProps","props","data","formatData","this","storedPaymentMethodId","paymentMethod","type","shopperAccountIdentifier","shopperName","firstName","lastName","isValid","displayName","label","name","additionalInfo","render","h","CoreProvider","i18n","loadingContext","resources","showPayButton","PayButton","classNameModifiers","amount","payAmountLabel","onClick","submit","paymentData","SRPanelProvider","srPanel","modules","Await","ref","componentRef","showAmount","instructions","PayToInstructions","clientKey","onError","onComplete","brandLogo","icon","constructor","messageText","get","awaitText","showCountdownTimer","throttleTime","throttleInterval","onActionHandled","endSlot","mandate","MandateSummary","payee","currencyCode","currency","PayToComponent","placeholders","setComponentRef","onChange","setState","payButton","_define_property","TxVariants","payto","defaultProps"],"mappings":"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"}